<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

    <meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="referrer" content="never">
	
    
    <meta property="og:site_name" content="亿观的博客">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://yiguan1573.gitee.io//img/01.jpg">
    <meta property="twitter:image" content="https://yiguan1573.gitee.io//img/01.jpg" />
    

    
    <meta name="title" content="2、后端(扫书项目)" />
    <meta property="og:title" content="2、后端(扫书项目)" />
    <meta property="twitter:title" content="2、后端(扫书项目)" />
    

    
    <meta name="description" content="">
    <meta property="og:description" content="" />
    <meta property="twitter:description" content="" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>2、后端(扫书项目)-yiguan1573</title>

    <link rel="canonical" href="/post/822%E6%89%AB%E4%B9%A6%E9%A1%B9%E7%9B%AE-%E5%90%8E%E7%AB%AF/">

    <link rel="stylesheet" href="/css/iDisqus.min.css"/>
	
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="/css/syntax.css">
    
    
    <link rel="stylesheet" href="/css/zanshang.css">
    
    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    
    

    
    
    <script src="/js/jquery.min.js"></script>
    
    
    <script src="/js/bootstrap.min.js"></script>
    
    
    <script src="/js/hux-blog.min.js"></script>

    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/docco.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
    

</head>



<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">亿观的博客</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">主页</a>
                    </li>
                    
                        
                        <li>
                            <a href="/categories/%E5%AD%A6%E4%B9%A0">学习</a>
                        </li>
                        
                    
                    
		    
                        <li><a href="/#">图书</a></li>
                    
                        <li><a href="/#">关于</a></li>
                    

                    
		    <li>
                        <a href="/search">搜索 <img src="/img/search.png" height="15" style="cursor: pointer;" alt="Search"></a>
		    </li>
                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('http://ww1.sinaimg.cn/large/006QQPIfly1gh0wuilf8mj31hc0u0kh8.jpg')
    }
</style>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/%E9%A1%B9%E7%9B%AE" title="项目">
                            项目
                        </a>
                        
                    </div>
                    <h1>2、后端(扫书项目)</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by 
                        
                                 &#34;亿观&#34;
                         
                        on 
                        Sunday, January 24, 2021
                        
                        
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                <header>
                    <h2></h2>
                </header>
                <nav id="TableOfContents">
  <ul>
    <li><a href="#实际开发中不使用外键">实际开发中不使用外键</a></li>
    <li><a href="#mybatis-plus查询为空">mybatis-plus查询为空</a></li>
    <li><a href="#点赞收藏等数据的数据库设计">点赞收藏等数据的数据库设计</a></li>
    <li><a href="#随机查询">随机查询</a></li>
    <li><a href="#mybatis-plus倒叙插叙">mybatis-plus倒叙插叙</a></li>
  </ul>
</nav>
                
                <h1 id="警告establishing-ssl-connection-without-servers-identity-verification-is-not-recommended">警告：Establishing SSL connection without server’s identity verification is not recommended</h1>
<ul>
<li>SpringBoot启动时报红</li>
</ul>
<pre><code>Mon Jun 04 00:53:48 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification

翻译：
请注意:不建议在没有服务器身份验证的情况下建立SSL连接。根据MySQL 5.5.45+、5.6.26+和5.7.6+的要求，如果不设置显式选项，则必须建立默认的SSL连接。您需要通过设置useSSL=false显式地禁用SSL，或者设置useSSL=true并为服务器证书验证提供信任存储
</code></pre><ul>
<li><strong>解决办法：jdbc:mysql://127.0.0.1:3306/test?characterEncoding=utf-8&amp;useSSL=false</strong></li>
</ul>
<h1 id="数据库插入警告">数据库插入警告</h1>
<pre><code>### Error updating database.  Cause: com.mysql.jdbc.MysqlDataTruncation: Data truncation: Out of range value for column 'id' at row 1
### The error may exist in com/yiguan/novel/mapper/UserMapper.java (best guess)
### The error may involve com.yiguan.novel.mapper.UserMapper.insert-Inline
### The error occurred while setting parameters
### SQL: INSERT INTO novel  ( id, username, password )  VALUES  ( ?, ?, ? )
### Cause: com.mysql.jdbc.MysqlDataTruncation: Data truncation: Out of range value for column 'id' at row 1
; Data truncation: Out of range value for column 'id' at row 1; nested exception is com.mysql.jdbc.MysqlDataTruncation: Data truncation: Out of range value for column 'id' at row 1] with root cause
</code></pre><ul>
<li><strong>解决办法：将数据库id的类型设置为bigint，根本原因见下</strong></li>
</ul>
<h1 id="插入数据主键为很长的数字">插入数据主键为很长的数字</h1>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gnj0dk3qujj30x003m3yk.jpg" alt="QQ截图20210211023831.png"></p>
<ul>
<li><strong>问题分析：新创建一个数据库表，然后手动在数据库表中添加数据时，字段的id值是正常的。但是只要一经过mybatisPlus操作添加数据到数据库就会出现这种问题。那么可能就是生成代码时出了问题</strong></li>
<li><strong>解决办法：在bean类中将主键设为自增,但在此之前先将表数据删除 TRUNCATE TABLE tablename</strong></li>
</ul>
<pre><code>@NoArgsConstructor
@ToString
@Data
@TableName(&quot;novel&quot;)
public class User {
    @TableId(value = &quot;id&quot;,type = IdType.AUTO)
    private Long id;
    @TableField(value = &quot;username&quot;)
    private String userName;
    @TableField(value = &quot;password&quot;)
    private String password;
    @TableField(value = &quot;image&quot;)
    private String image;
    @TableField(value = &quot;token&quot;)
    private String token;

    public User(String userName, String password) {
        this.userName = userName;
        this.password = password;
    }
}
</code></pre><h1 id="mybatis-plus开启事务">mybatis-plus开启事务</h1>
<p><a href="https://blog.csdn.net/zk86547462/article/details/108903063">参考博客</a></p>
<h1 id="jwt生成解析token">JWT生成解析token</h1>
<ul>
<li>JwtUtils类</li>
</ul>
<pre><code>package com.yiguan.novel.utils;

import com.auth0.jwt.JWT;
import com.auth0.jwt.JWTVerifier;
import com.auth0.jwt.algorithms.Algorithm;
import com.auth0.jwt.interfaces.DecodedJWT;

import java.io.UnsupportedEncodingException;
import java.util.Calendar;
import java.util.Date;
import java.util.HashMap;
import java.util.Map;

public class JwtUtil {
    //密钥
    public static final String SECRET = &quot;sdjhakdhajdklsl;o653632&quot;;
    //过期时间:天
    public static final int EXPIRE = 10;

    /**
     * 生成Token
     * @param userId
     * @param userName
     * @return
     * @throws Exception
     */
    public static String createToken(Long userId, String userName) throws Exception {
        Calendar nowTime = Calendar.getInstance();
        nowTime.add(Calendar.DATE, EXPIRE);
        Date expireDate = nowTime.getTime();

        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
        map.put(&quot;alg&quot;, &quot;HS256&quot;);
        map.put(&quot;typ&quot;, &quot;JWT&quot;);

        String token = JWT.create()
                .withHeader(map)//头
                .withClaim(&quot;userId&quot;, userId)
                .withClaim(&quot;userName&quot;, userName)
                .withSubject(&quot;novelToken&quot;)//主题
                .withIssuedAt(new Date())//签名时间
                .withExpiresAt(expireDate)//过期时间
                .sign(Algorithm.HMAC256(SECRET));//签名
        return token;
    }

    /**
     * 验证Token
     * @param token
     * @return
     * @throws Exception
     */
    public static boolean verifyToken(String token)throws Exception{
        JWTVerifier verifier = JWT.require(Algorithm.HMAC256(SECRET)).build();
        DecodedJWT jwt = null;
        try {
            jwt = verifier.verify(token);
            return false;
        }catch (Exception e){
//            throw new RuntimeException(&quot;凭证已过期，请重新登录&quot;);
            return true;
        }
    }

    /**
     * 解析Token
     * @param token
     * @return
     */
    public static DecodedJWT parseToken(String token){
        JWTVerifier verifier = null;
        try {
            verifier = JWT.require(Algorithm.HMAC256(SECRET)).build();
        } catch (UnsupportedEncodingException e) {
            e.printStackTrace();
        }
        DecodedJWT jwt = verifier.verify(token);
        return jwt;
    }
}

</code></pre><ul>
<li>测试类（userId为Long类型，所以最后用asLong解析）</li>
</ul>
<pre><code>    @Test
    public void asda(){
        String token = &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJub3ZlbFRva2VuIiwidXNlck5hbWUiOiLkur_op4IiLCJleHAiOjE2MTM5MDU0ODEsInVzZXJJZCI6MSwiaWF0IjoxNjEzMDQxNDgxfQ.Tyfeghm6upeIh7GbrbEJcaNZMkVR4jMxbfIv4YVREAM&quot;;
        System.out.println(JwtUtil.parseToken(token).getClaim(&quot;userId&quot;).asLong());
    }
</code></pre><h1 id="图片上传显示">图片上传显示</h1>
<ul>
<li>
<p><strong>参考</strong></p>
</li>
<li>
<p><a href="https://blog.csdn.net/qq_37345604/article/details/89378187">SpringBoot图片上传和访问路径映射</a></p>
</li>
<li>
<p><a href="https://blog.csdn.net/qq_36657751/article/details/110957359?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-11.control&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-11.control">SpringBoot+Vue+ElementUI实现前后端分离上传文件</a></p>
</li>
<li>
<p><a href="https://blog.csdn.net/qiuxinfa123/article/details/105916131/?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-2&amp;spm=1001.2101.3001.4242">前后端分离，文件上传下载(springBoot+vue+elementUI)</a></p>
</li>
<li>
<p>前端</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">template</span>&gt;
	&lt;<span style="color:#f92672">el-upload</span>
	  <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;avatar-uploader&#34;</span>
	  <span style="color:#a6e22e">action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://localhost:8888/updateImg&#34;</span>
		<span style="color:#a6e22e">ref</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;upload&#34;</span>
		<span style="color:#a6e22e">:data</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;param&#34;</span>
		<span style="color:#a6e22e">:auto-upload</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;false&#34;</span>
	  <span style="color:#a6e22e">:show-file-list</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;false&#34;</span>
		<span style="color:#a6e22e">:on-change</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;changeFile&#34;</span>
		<span style="color:#a6e22e">:on-success</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;handle_success&#34;</span>
		<span style="color:#a6e22e">:on-error</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;handle_error&#34;</span>
		<span style="color:#a6e22e">:on-exceed</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;uploadExceed&#34;</span> 
		<span style="color:#a6e22e">:limit</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1&#34;</span>
		<span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;file&#34;</span>
	  &gt;
	  &lt;<span style="color:#f92672">img</span> <span style="color:#a6e22e">v-if</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;imageUrl&#34;</span> <span style="color:#a6e22e">:src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;imageUrl&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;avatar&#34;</span>&gt;
	  &lt;<span style="color:#f92672">i</span> <span style="color:#a6e22e">v-else</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;el-icon-plus avatar-uploader-icon&#34;</span>&gt;&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">slot</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;tip&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;el-upload__tip&#34;</span>&gt;只能上传jpg/png文件，且不超过2M&lt;/<span style="color:#f92672">div</span>&gt;&lt;/<span style="color:#f92672">i</span>&gt;
		
	&lt;/<span style="color:#f92672">el-upload</span>&gt;
&lt;/<span style="color:#f92672">template</span>&gt;

&lt;<span style="color:#f92672">script</span>&gt;
	<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> {
		<span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;uploadImg&#39;</span>,
		<span style="color:#a6e22e">data</span>() {
			<span style="color:#66d9ef">return</span> {
				<span style="color:#a6e22e">imageUrl</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>,
				<span style="color:#a6e22e">imageBaseUrl</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>,
				<span style="color:#a6e22e">param</span><span style="color:#f92672">:</span> {
					<span style="color:#a6e22e">userName</span><span style="color:#f92672">:</span> window.<span style="color:#a6e22e">localStorage</span>.<span style="color:#a6e22e">getItem</span>(<span style="color:#e6db74">&#34;userName&#34;</span>),
					<span style="color:#a6e22e">previousUrl</span><span style="color:#f92672">:</span> window.<span style="color:#a6e22e">localStorage</span>.<span style="color:#a6e22e">getItem</span>(<span style="color:#e6db74">&#34;userImg&#34;</span>)
				}
			}
		},
		<span style="color:#a6e22e">methods</span><span style="color:#f92672">:</span> {
			<span style="color:#a6e22e">uploadExceed</span>(<span style="color:#a6e22e">files</span>, <span style="color:#a6e22e">fileList</span>) {
				<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">$set</span>(<span style="color:#a6e22e">fileList</span>[<span style="color:#ae81ff">0</span>], <span style="color:#e6db74">&#39;raw&#39;</span>, <span style="color:#a6e22e">files</span>[<span style="color:#ae81ff">0</span>]);
				<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">$set</span>(<span style="color:#a6e22e">fileList</span>[<span style="color:#ae81ff">0</span>], <span style="color:#e6db74">&#39;name&#39;</span>, <span style="color:#a6e22e">files</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">name</span>);
				<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">$refs</span>[<span style="color:#e6db74">&#39;upload&#39;</span>].<span style="color:#a6e22e">clearFiles</span>();<span style="color:#75715e">//清除文件
</span><span style="color:#75715e"></span>				<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">$refs</span>[<span style="color:#e6db74">&#39;upload&#39;</span>].<span style="color:#a6e22e">handleStart</span>(<span style="color:#a6e22e">files</span>[<span style="color:#ae81ff">0</span>]);<span style="color:#75715e">//选择文件后的赋值方法
</span><span style="color:#75715e"></span>			},
			<span style="color:#a6e22e">changeFile</span>(<span style="color:#a6e22e">file</span>, <span style="color:#a6e22e">fileList</span>) {
				<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">isIMAGE</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">raw</span>.<span style="color:#a6e22e">type</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;image/jpeg&#39;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">raw</span>.<span style="color:#a6e22e">type</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;image/png&#39;</span>);
				<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">isLt2M</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">size</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">1024</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">1024</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span>;
				<span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">isIMAGE</span>) {
					<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">$message</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;上传的文件格式错误!&#39;</span>);
					<span style="color:#66d9ef">return</span>;
				}
				<span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">isLt2M</span>) {
					<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">$message</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;上传图片大小不能超过 2MB!&#39;</span>);
					<span style="color:#66d9ef">return</span>;
				}
				<span style="color:#75715e">// setTimeout(() =&gt; {
</span><span style="color:#75715e"></span>				<span style="color:#75715e">// 			this.$emit(&#39;file&#39;,file)
</span><span style="color:#75715e"></span>				<span style="color:#75715e">// 		}, 500)
</span><span style="color:#75715e"></span>				<span style="color:#75715e">// this.$emit(&#39;click&#39;,file)
</span><span style="color:#75715e"></span>				
				
				
				<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">This</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>;
				<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">reader</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">FileReader</span>();
				<span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">readAsDataURL</span>(<span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">raw</span>);
				<span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">e</span>){
						<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">result</span>; <span style="color:#75715e">//base64编码
</span><span style="color:#75715e"></span>						<span style="color:#a6e22e">This</span>.<span style="color:#a6e22e">imageBaseUrl</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">result</span>;
						<span style="color:#a6e22e">This</span>.<span style="color:#a6e22e">imageUrl</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">result</span>;
				}
				
				<span style="color:#a6e22e">setTimeout</span>(() =&gt; {
							<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">$emit</span>(<span style="color:#e6db74">&#39;showImg&#39;</span>,<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">imageUrl</span>)
						}, <span style="color:#ae81ff">500</span>)
			},
			<span style="color:#75715e">//上传成功的钩子，res为后端返回的值
</span><span style="color:#75715e"></span>			<span style="color:#a6e22e">handle_success</span>(<span style="color:#a6e22e">res</span>){
				<span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>){
					window.<span style="color:#a6e22e">localStorage</span>.<span style="color:#a6e22e">setItem</span>(<span style="color:#e6db74">&#34;userImg&#34;</span>,<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">url</span>)
					<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">$store</span>.<span style="color:#a6e22e">commit</span>(<span style="color:#e6db74">&#39;updataImg&#39;</span>)
						<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">$notify</span>({
							<span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;头像更换成功&#39;</span>,
							<span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;success&#39;</span>,
							<span style="color:#a6e22e">offset</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">100</span>
						})	
					}<span style="color:#66d9ef">else</span>{
						<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">$notify</span>.<span style="color:#a6e22e">error</span>({
							<span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;头像更换失败&#39;</span>,
							<span style="color:#a6e22e">message</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;请稍后重试&#39;</span>,
							<span style="color:#a6e22e">offset</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">100</span>
						})
					}	
			},
			<span style="color:#75715e">//上传失败的钩子
</span><span style="color:#75715e"></span>			<span style="color:#a6e22e">handle_error</span>(<span style="color:#a6e22e">err</span>){
				<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">$notify</span>.<span style="color:#a6e22e">error</span>({
					<span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;头像更换失败&#39;</span>,
					<span style="color:#a6e22e">message</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;请稍后重试&#39;</span>,
					<span style="color:#a6e22e">offset</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">100</span>
				})
			}
		}
	}
&lt;/<span style="color:#f92672">script</span>&gt;   
</code></pre></div><ul>
<li>后端</li>
</ul>
<pre><code>//用户头像上传
@RestController
public class ImgUploadController {

    @Autowired
    UserService userService;
    @Autowired
    PreReadUploadConfig uploadConfig;



    @Transactional
    @CrossOrigin
    @PostMapping(&quot;/updateImg&quot;)
    public Map&lt;String,Object&gt; ImgUpload(@RequestParam(&quot;file&quot;) MultipartFile headerImg, @RequestParam(&quot;userName&quot;) String userName,@RequestParam(&quot;previousUrl&quot;) String previousUrl){
        Map&lt;String,Object&gt; map = new HashMap&lt;&gt;();
        if (headerImg.isEmpty()) {
            map.put(&quot;status&quot;, 400);
            return map;
        }

        //重命名
        String fileName = headerImg.getOriginalFilename();
        fileName = FileUtil.renameToUUID(fileName);
        if (fileName == null) {
            map.put(&quot;status&quot;, 400);
            return map;
        }
        //文件上传
        try {
            FileUtil.uploadFiles(headerImg.getBytes(), uploadConfig.getUploadPath(), fileName);//uploadConfig.getUploadPath()可在yml文件中设置
        } catch (Exception e) {
            map.put(&quot;status&quot;, 400);
            return map;
        }

        String url = &quot;/static/&quot; + fileName;

        //更新image路径
        UpdateWrapper&lt;User&gt; userUpdateWrapper = new UpdateWrapper&lt;&gt;();
        userUpdateWrapper
                .set(&quot;image&quot;,url)
                .eq(&quot;username&quot;, userName);
        userService.update(userUpdateWrapper);

        //删除之前的图片
        if(!previousUrl.equals(&quot;null&quot;)){//注意previousUrl为字符串的null
        boolean isDelete = FileUtil.deleteImg(uploadConfig.getUploadPath(),previousUrl.substring(previousUrl.lastIndexOf(&quot;/&quot;) + 1));
        }

        map.put(&quot;status&quot;,200);
        map.put(&quot;url&quot;,url);

        return map;
    }

}


public class FileUtil {
    /**
     * 图片上传
     *
     * @param file
     * @param filePath
     * @param fileName
     * @throws Exception
     */
    public static void uploadFiles(byte[] file, String filePath, String fileName) throws Exception {
        File targetFile = new File(filePath);
        if (!targetFile.exists()) {
            targetFile.mkdirs();
        }
        FileOutputStream out = new FileOutputStream(filePath + fileName);
        out.write(file);
        out.flush();
        out.close();
    }

    /**
     * 重命名
     *
     * @param fileName
     * @return
     */
    public static String renameToUUID(String fileName) {
        //lastIndexOf() 得到该字符最后一次出现的位置，substring截取字符串，得到文件后缀名
        // 去掉uuid的‘-’，最后得到uuid+fileName
        return UUID.randomUUID().toString().replace(&quot;-&quot;, &quot;&quot;) + &quot;.&quot; + fileName.substring(fileName.lastIndexOf(&quot;.&quot;) + 1);
    }

    /**
     * 删除图片
     * @param filePath
     * @param fileName
     * @return
     */
    public static boolean deleteImg(String filePath,String fileName){
        File file =new File(filePath + fileName);
        if(file.delete()){
            return true;
        }else{
            return false;
        }
    }
}
</code></pre><h2 id="实际开发中不使用外键">实际开发中不使用外键</h2>
<ul>
<li><a href="https://blog.csdn.net/yxz8102/article/details/107303975?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.control&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.control">为什么实际开发中不使用外键</a></li>
</ul>
<h2 id="mybatis-plus查询为空">mybatis-plus查询为空</h2>
<ul>
<li>执行以下语句，查询结果为空，且其他配置无错</li>
</ul>
<pre><code>QueryWrapper&lt;Novel&gt; queryWrapper = new QueryWrapper&lt;&gt;();
queryWrapper.eq(&quot;novel_name&quot;,&quot;情与血&quot;);
Novel user2 = novelService.getOne(queryWrapper);
System.out.println(user2);
</code></pre><ul>
<li>去除bean的属性的下划线，如下</li>
</ul>
<pre><code>novel_name =&gt; novelName
</code></pre><h2 id="点赞收藏等数据的数据库设计">点赞收藏等数据的数据库设计</h2>
<ul>
<li><a href="https://blog.csdn.net/u010098331/article/details/51446102?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3.control&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3.control">点赞数据库设计</a></li>
</ul>
<h2 id="随机查询">随机查询</h2>
<pre><code>SELECT * FROM novel ORDER BY RAND() LIMIT 0,6
</code></pre><h2 id="mybatis-plus倒叙插叙">mybatis-plus倒叙插叙</h2>
<pre><code>orderBy(boolean condition, boolean isAsc, R... columns)
</code></pre><ul>
<li>例: orderBy(true, true, &ldquo;id&rdquo;, &ldquo;name&rdquo;)&mdash;&gt;order by id ASC,name ASC</li>
</ul>


                

                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/post/819shiro%E5%85%B6%E4%BB%96/" data-toggle="tooltip" data-placement="top" title="2、Shiro其他(Shiro)">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/post/617spring-boot2/" data-toggle="tooltip" data-placement="top" title="17、Spring Boot2(SpringBoot)">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>

                
<div id="disqus-comment"></div>



            </div>
            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">标签</a></h5>
                    <div class="tags">
                        
                        
                        
                        <a href="/tags/activemq" title="activemq">
                            activemq
                        </a>
                        
                        
                        
                        <a href="/tags/ajax" title="ajax">
                            ajax
                        </a>
                        
                        
                        
                        <a href="/tags/cookie" title="cookie">
                            cookie
                        </a>
                        
                        
                        
                        <a href="/tags/datax" title="datax">
                            datax
                        </a>
                        
                        
                        
                        <a href="/tags/docker" title="docker">
                            docker
                        </a>
                        
                        
                        
                        <a href="/tags/filter" title="filter">
                            filter
                        </a>
                        
                        
                        
                        <a href="/tags/hadoop" title="hadoop">
                            hadoop
                        </a>
                        
                        
                        
                        <a href="/tags/hbase" title="hbase">
                            hbase
                        </a>
                        
                        
                        
                        <a href="/tags/hive" title="hive">
                            hive
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/java" title="java">
                            java
                        </a>
                        
                        
                        
                        <a href="/tags/javascript" title="javascript">
                            javascript
                        </a>
                        
                        
                        
                        <a href="/tags/javaweb" title="javaweb">
                            javaweb
                        </a>
                        
                        
                        
                        <a href="/tags/jdbc" title="jdbc">
                            jdbc
                        </a>
                        
                        
                        
                        <a href="/tags/jquery" title="jquery">
                            jquery
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/jsp" title="jsp">
                            jsp
                        </a>
                        
                        
                        
                        <a href="/tags/juc" title="juc">
                            juc
                        </a>
                        
                        
                        
                        <a href="/tags/jwt" title="jwt">
                            jwt
                        </a>
                        
                        
                        
                        <a href="/tags/kafka" title="kafka">
                            kafka
                        </a>
                        
                        
                        
                        <a href="/tags/linux" title="linux">
                            linux
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/maven" title="maven">
                            maven
                        </a>
                        
                        
                        
                        <a href="/tags/minio" title="minio">
                            minio
                        </a>
                        
                        
                        
                        <a href="/tags/mongodb" title="mongodb">
                            mongodb
                        </a>
                        
                        
                        
                        <a href="/tags/mybatis" title="mybatis">
                            mybatis
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/mysql" title="mysql">
                            mysql
                        </a>
                        
                        
                        
                        <a href="/tags/nginx" title="nginx">
                            nginx
                        </a>
                        
                        
                        
                        <a href="/tags/react" title="react">
                            react
                        </a>
                        
                        
                        
                        <a href="/tags/redis" title="redis">
                            redis
                        </a>
                        
                        
                        
                        <a href="/tags/scala" title="scala">
                            scala
                        </a>
                        
                        
                        
                        <a href="/tags/servlet" title="servlet">
                            servlet
                        </a>
                        
                        
                        
                        <a href="/tags/session" title="session">
                            session
                        </a>
                        
                        
                        
                        <a href="/tags/shiro" title="shiro">
                            shiro
                        </a>
                        
                        
                        
                        <a href="/tags/spark" title="spark">
                            spark
                        </a>
                        
                        
                        
                        <a href="/tags/spring" title="spring">
                            spring
                        </a>
                        
                        
                        
                        <a href="/tags/springboot" title="springboot">
                            springboot
                        </a>
                        
                        
                        
                        <a href="/tags/springcloud" title="springcloud">
                            springcloud
                        </a>
                        
                        
                        
                        <a href="/tags/springmvc" title="springmvc">
                            springmvc
                        </a>
                        
                        
                        
                        <a href="/tags/springsecurity" title="springsecurity">
                            springsecurity
                        </a>
                        
                        
                        
                        <a href="/tags/tomcat" title="tomcat">
                            tomcat
                        </a>
                        
                        
                        
                        <a href="/tags/vue" title="vue">
                            vue
                        </a>
                        
                        
                        
                        <a href="/tags/xml" title="xml">
                            xml
                        </a>
                        
                        
                        
                        <a href="/tags/zookeeper" title="zookeeper">
                            zookeeper
                        </a>
                        
                        
                        
                        <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95" title="数据结构与算法">
                            数据结构与算法
                        </a>
                        
                        
                        
                        <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F" title="设计模式">
                            设计模式
                        </a>
                        
                        
                        
                        <a href="/tags/%E9%A1%B9%E7%9B%AE" title="项目">
                            项目
                        </a>
                        
                        
                    </div>
                </section>
                

                
                
                <section>
                    <hr>
                    <h5>朋友</h5>
                    <ul class="list-inline">
                        
                        <li><a target="_blank" href=""></a></li>
                        
                    </ul>
                </section>
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                 
                   
                    
                    <li>
                        <a href="mailto:1424197205@qq.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    

                    

		    
                    
                    <li>
                        <a target="_blank" href="#">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-wechat fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    <li>
                        <a target="_blank" href="https://github.com/yiguan1573">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    
                    
                    
                    
                    
            
                </ul>
		<p class="copyright text-muted">
                    Copyright &copy; 亿观的博客 2022
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






</body>
</html>
