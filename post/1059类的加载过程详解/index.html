<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="referrer" content="never">

    
    <meta property="og:site_name" content="亿观的博客">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://yiguan1573.github.io//img/01.jpg">
    <meta property="twitter:image" content="https://yiguan1573.github.io//img/01.jpg" />
    

    
    <meta name="title" content="19、类的加载过程详解（JVM）" />
    <meta property="og:title" content="19、类的加载过程详解（JVM）" />
    <meta property="twitter:title" content="19、类的加载过程详解（JVM）" />
    

    
    <meta name="description" content="">
    <meta property="og:description" content="" />
    <meta property="twitter:description" content="" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>19、类的加载过程详解（JVM） | yiguan1573</title>

    <link rel="canonical" href="/post/1059%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B%E8%AF%A6%E8%A7%A3/">

    
    
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hugo-theme-cleanwhite.min.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link href="https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome@5.15.1/css/all.css" rel="stylesheet" type="text/css">

    
    

    
    <script src="/js/jquery.min.js"></script>

    
    <script src="/js/bootstrap.min.js"></script>

    
    <script src="/js/hux-blog.min.js"></script>

    
    

</head>




<nav class="navbar navbar-default navbar-custom navbar-fixed-top">

    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">亿观的博客</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">首页</a>
                    </li>
                    
                        
                        <li>
                            <a href="/categories/%E5%AD%A6%E4%B9%A0">学习</a>
                        </li>
                        
                    
                    
		    
                        <li><a href="/top/archive/">档案</a></li>
                    
                        <li><a href="/top/about/">关于</a></li>
                    

                    
		    <li>
                        <a href="/search"><i class="fa fa-search"></i></a>
		    </li>
                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/img/03.JPG')
    }
</style>

<header class="intro-header" >

    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/jvm" title="JVM">
                            JVM
                        </a>
                        
                    </div>
                    <h1>19、类的加载过程详解（JVM）</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        
                            Posted by 
                            
                                亿观
                             
                            on 
                            Saturday, September 3, 2022
                            
                                <span id="/post/1059%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B%E8%AF%A6%E8%A7%A3/" class="leancloud_visitors meta_data_item" data-flag-title="">
    <span class="post-meta-item-icon">
      <span class="octicon octicon-eye"></span> 
    </span>
    <i class="fa fa-eye"></i>
    <span class="old-visitors-count" style="display: none;"></span>
    <span class="leancloud-visitors-count"></span>
</span>



<script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>

<script>
	AV.initialize("", "");
</script>

<script type="text/javascript">
function showTime(Counter) {
    var query = new AV.Query(Counter);
    var entries = [];
    var $visitors = $(".leancloud_visitors");

    $visitors.each(function() {
        entries.push($(this).attr("id").trim());
    });

    query.containedIn('url', entries);
    query.find()
        .done(function(results) {
            var COUNT_CONTAINER_REF = '.leancloud-visitors-count';
            var OLD_COUNT_CONTAINER_REF = '.old-visitors-count';

            
            
            
            

            for (var i = 0; i < results.length; i++) {
                var item = results[i];
                var url = item.get('url');
                var time = item.get('time');
                var element = document.getElementById(url);

                $(element).find(COUNT_CONTAINER_REF).text(time);
            }
            for (var i = 0; i < entries.length; i++) {
                var url = entries[i];
                var element = document.getElementById(url);
                var countSpan = $(element).find(COUNT_CONTAINER_REF);
                if (countSpan.text() == '') {
                    var oldCountSpan = $(element).find(OLD_COUNT_CONTAINER_REF).text();
                    if(oldCountSpan!=''){
                        countSpan.text(0+parseInt(oldCountSpan));
                    }else{
                        countSpan.text(0);          
                    }
                }
            }
        })
        .fail(function(object, error) {
            console.log("Error: " + error.code + " " + error.message);
        });
}

function addCount(Counter) {
    var $visitors = $(".leancloud_visitors");
    var url = $visitors.attr('id').trim();
    var title = $visitors.attr('data-flag-title').trim();
    var query = new AV.Query(Counter);

    query.equalTo("url", url);
    query.find({
        success: function(results) {
            if (results.length > 0) {
                var counter = results[0];
                counter.fetchWhenSave(true);
                counter.increment("time");
                counter.save(null, {
                    success: function(counter) {
                        var $element = $(document.getElementById(url));
                        $element.find('.leancloud-visitors-count').text(counter.get('time'));
                    },
                    error: function(counter, error) {
                        console.log('Failed to save Visitor num, with error message: ' + error.message);
                    }
                });
            } else {
                var newcounter = new Counter();
                 
                var acl = new AV.ACL();
                acl.setPublicReadAccess(true);
                acl.setPublicWriteAccess(true);
                newcounter.setACL(acl);
                 
                newcounter.set("title", title);
                newcounter.set("url", url);
                var OLD_COUNT_CONTAINER_REF = '.old-visitors-count';
                var $element = $(document.getElementById(url));
                var oldCountSpan = $element.find(OLD_COUNT_CONTAINER_REF).text();
                if(oldCountSpan!=''){
                    newcounter.set("time", parseInt(oldCountSpan)+1);
                }else{
 	                    newcounter.set("time",  1);
                }
                newcounter.save(null, {
                    success: function(newcounter) {
                        var $element = $(document.getElementById(url));
                        $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
                    },
                    error: function(newcounter, error) {
                        console.log('Failed to create');
                    }
                });
            }
        },
        error: function(error) {
            console.log('Error:' + error.code + " " + error.message);
        }
    });
}
$(function() {
    var Counter = AV.Object.extend("Counter");
    
    
    if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
    } else {
        showTime(Counter);
    }
});
</script>

                            
                            
                            
                            
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                <h2 id="概述">概述</h2>
<p><strong>在 Java 中数据类型分为基本数据类型和引用数据类型。<strong>基本数据类型由虚拟机预先定义，引用数据类型则需要进行类的加载。</strong></strong></p>
<p><strong>按照 Java 虚拟机规范，从 Class 文件到加载到内存中的类，到类卸载出内存位置，它的整个生命周期包括如下7个阶段：</strong></p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67lgxp46gj30ve0d7jw4.jpg" alt="image-20210117155419246.png">

</p>
<p><strong>其中，验证、准备、解析3个部分统称为链接(Linking)，就可以划分为5个阶段</strong></p>
<p><strong>从程序中类的使用过程看：</strong></p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67lhk4spxj30ok0j6afb.jpg" alt="image-20210117160050106.png">

</p>
<h2 id="过程一loading加载阶段">过程一：Loading(加载)阶段</h2>
<p><strong>类的加载是广义的加载，这里的是狭义的加载。</strong></p>
<h3 id="加载完成的操作">加载完成的操作</h3>
<p><strong><strong>加载的理解：</strong></strong></p>
<p><strong><strong>所谓加载，简而言之就是将 Java 类的字节码文件加载到机器内存中，并在内存中构建出 Java 类的原型 &ndash; 类模板对象。</strong> 所谓类模板对象，其实就是 Java 类在 JVM 内存中的一个快照，JVM 将从字节码文件中解析出的常量池、类字段、类方法等信息存储到模板中，这样 JVM 在运行期便能通过类模板而获取 Java 类中的任意信息（反射），能够对 Java 类的成员变量进行遍历，也能进行 Java 方法的调用。</strong></p>
<p><strong>反射的机制即基于这一基础。如果 JVM 没有将 Java 类的声明信息存储起来，则 JVM 在运行期也无法反射。</strong></p>
<p><strong><strong>加载完成的操作：</strong></strong></p>
<p><strong><strong>加载阶段，简言之，查找并加载类的二进制数据，生成 Class 的实例。</strong></strong></p>
<p><strong>在加载类时，Java 虚拟机必须完成以下3件事情：</strong></p>
<ul>
<li><strong>通过类的全名，获取类的二进制数据流</strong></li>
<li><strong>解析类的二进制数据流为</strong>方法区<strong>内的数据结构(Java 类模型)</strong></li>
<li><strong>创建 java.lang.Class 类的实例（在堆中），表示该类型。作为方法区这个类的各种数据的访问入口</strong></li>
</ul>
<h3 id="二进制流的获取方式">二进制流的获取方式</h3>
<p><strong>对于类的二进制数据流，虚拟机可以通过多种途径产生或获得。</strong>(只要所读取的字节码符合 JVM 规范即可)****</p>
<ul>
<li><strong>虚拟机可能通过文件系统读入一个 Class 后缀的文件</strong>(最常见)****</li>
<li><strong>读入 jar、zip 等归档数据包，提取类文件</strong></li>
<li><strong>事先存放在数据库中的类的二进制数据</strong></li>
<li><strong>使用类似于 HTTP 之类的协议通过网络进行加载</strong></li>
<li><strong>在运行时生成一段 Class 的二进制信息等</strong></li>
</ul>
<p><strong>在获取到类的二进制信息后，Java 虚拟机就会处理这些数据，并最终转为一个 java.lang.Class 的实例。</strong></p>
<p><strong>如果输入数据不是 ClassFile 的结构，则会抛出 ClassFormatError。</strong></p>
<h3 id="类模型与class实例的位置">类模型与Class实例的位置</h3>
<p><strong><strong>1、类模型的位置</strong></strong></p>
<p><strong>加载的类在 JVM 中创建相应的类结构，类结构会存储在方法区(JDK 1.8之前：永久代；JDK 1.8之后：元空间)。</strong></p>
<p><strong><strong>2、Class实例的位置</strong></strong></p>
<p><strong>将 .class 文件加载至元空间后，会在堆中创建一个 java.lang.Class 对象，用来封装类位于方法区内的数据结构，该 Class 对象是在加载类的过程中创建的，每个类都对应有一个 Class 类型的对象。</strong></p>
<p><strong><strong>3、图示</strong></strong></p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67lk7ypzuj30hy0i9mzs.jpg" alt="image-20210117162554601.png">

</p>
<p><strong>外部可以通过访问代表 Order 类的 Class 对象来获取 Order 的类数据结构。</strong></p>
<p><strong><strong>4、再说明</strong></strong></p>
<p><strong>Class 类的构造方法是私有的，只有 JVM 能够创建。</strong></p>
<p><strong>java.lang.Class 实例是访问类型元数据的接口，也是实现反射的关键数据、入口。通过 Class 类提供的接口，可以获得目标类所关联的 .class 文件中具体的数据结构：方法、字段等信息。</strong></p>
<p><strong>（理解Class文件之后再看反射就很清楚了。）</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#ff79c6">package</span> _10<span style="color:#ff79c6">;</span>

<span style="color:#ff79c6">import</span> java.lang.reflect.Method<span style="color:#ff79c6">;</span>
<span style="color:#ff79c6">import</span> java.lang.reflect.Modifier<span style="color:#ff79c6">;</span>

<span style="color:#6272a4">/**
</span><span style="color:#6272a4"> *  过程一：加载阶段
</span><span style="color:#6272a4"> *
</span><span style="color:#6272a4"> *  通过Class类，获得了java.lang.String类的所有方法信息，并打印方法访问标识符、描述符
</span><span style="color:#6272a4"> */</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">_18_LoadingTest</span> <span style="color:#ff79c6">{</span>
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">main</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span> args<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
        <span style="color:#ff79c6">try</span> <span style="color:#ff79c6">{</span>
            Class clazz <span style="color:#ff79c6">=</span> Class<span style="color:#ff79c6">.</span><span style="color:#50fa7b">forName</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;java.lang.String&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
            <span style="color:#6272a4">//获取当前运行时类声明的所有方法
</span><span style="color:#6272a4"></span>            Method<span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span> ms <span style="color:#ff79c6">=</span> clazz<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getDeclaredMethods</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
            <span style="color:#ff79c6">for</span> <span style="color:#ff79c6">(</span>Method m <span style="color:#ff79c6">:</span> ms<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
                <span style="color:#6272a4">//获取方法的修饰符
</span><span style="color:#6272a4"></span>                String mod <span style="color:#ff79c6">=</span> Modifier<span style="color:#ff79c6">.</span><span style="color:#50fa7b">toString</span><span style="color:#ff79c6">(</span>m<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getModifiers</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
                System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">print</span><span style="color:#ff79c6">(</span>mod <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34; &#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
                <span style="color:#6272a4">//获取方法的返回值类型
</span><span style="color:#6272a4"></span>                String returnType <span style="color:#ff79c6">=</span> m<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getReturnType</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">getSimpleName</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
                System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">print</span><span style="color:#ff79c6">(</span>returnType <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34; &#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
                <span style="color:#6272a4">//获取方法名
</span><span style="color:#6272a4"></span>                System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">print</span><span style="color:#ff79c6">(</span>m<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getName</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;(&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
                <span style="color:#6272a4">//获取方法的参数列表
</span><span style="color:#6272a4"></span>                Class<span style="color:#ff79c6">&lt;</span><span style="color:#ff79c6">?</span><span style="color:#ff79c6">&gt;</span><span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span> ps <span style="color:#ff79c6">=</span> m<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getParameterTypes</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
                <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>ps<span style="color:#ff79c6">.</span><span style="color:#50fa7b">length</span> <span style="color:#ff79c6">=</span><span style="color:#ff79c6">=</span> 0<span style="color:#ff79c6">)</span> System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">print</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;)&#39;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
                <span style="color:#ff79c6">for</span> <span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span> i <span style="color:#ff79c6">=</span> 0<span style="color:#ff79c6">;</span> i <span style="color:#ff79c6">&lt;</span> ps<span style="color:#ff79c6">.</span><span style="color:#50fa7b">length</span><span style="color:#ff79c6">;</span> i<span style="color:#ff79c6">+</span><span style="color:#ff79c6">+</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
                    <span style="color:#8be9fd">char</span> end <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span>i <span style="color:#ff79c6">=</span><span style="color:#ff79c6">=</span> ps<span style="color:#ff79c6">.</span><span style="color:#50fa7b">length</span> <span style="color:#ff79c6">-</span> 1<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">?</span> <span style="color:#f1fa8c">&#39;)&#39;</span> <span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;,&#39;</span><span style="color:#ff79c6">;</span>
                    <span style="color:#6272a4">//获取参数的类型
</span><span style="color:#6272a4"></span>                    System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">print</span><span style="color:#ff79c6">(</span>ps<span style="color:#ff79c6">[</span>i<span style="color:#ff79c6">]</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">getSimpleName</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">+</span> end<span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
                <span style="color:#ff79c6">}</span>
                System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
            <span style="color:#ff79c6">}</span>
        <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">catch</span> <span style="color:#ff79c6">(</span>ClassNotFoundException e<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
            e<span style="color:#ff79c6">.</span><span style="color:#50fa7b">printStackTrace</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
        <span style="color:#ff79c6">}</span>

    <span style="color:#ff79c6">}</span>
<span style="color:#ff79c6">}</span>
</code></pre></div><p><strong>运行输出结果（String类的所有方法）</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">equals</span><span style="color:#ff79c6">(</span>Object<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">toString</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">hashCode</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">compareTo</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">volatile</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">compareTo</span><span style="color:#ff79c6">(</span>Object<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">indexOf</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">indexOf</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">indexOf</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">indexOf</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">indexOf</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">indexOf</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span>String<span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> String <span style="color:#50fa7b">valueOf</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> String <span style="color:#50fa7b">valueOf</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">long</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> String <span style="color:#50fa7b">valueOf</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">float</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> String <span style="color:#50fa7b">valueOf</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">boolean</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> String <span style="color:#50fa7b">valueOf</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> String <span style="color:#50fa7b">valueOf</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> String <span style="color:#50fa7b">valueOf</span><span style="color:#ff79c6">(</span>Object<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> String <span style="color:#50fa7b">valueOf</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> String <span style="color:#50fa7b">valueOf</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">double</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">char</span> <span style="color:#50fa7b">charAt</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">checkBounds</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">byte</span><span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">codePointAt</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">codePointBefore</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">codePointCount</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">compareToIgnoreCase</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">concat</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">contains</span><span style="color:#ff79c6">(</span>CharSequence<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">contentEquals</span><span style="color:#ff79c6">(</span>CharSequence<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">contentEquals</span><span style="color:#ff79c6">(</span>StringBuffer<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> String <span style="color:#50fa7b">copyValueOf</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> String <span style="color:#50fa7b">copyValueOf</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">endsWith</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">equalsIgnoreCase</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">transient</span> String <span style="color:#50fa7b">format</span><span style="color:#ff79c6">(</span>Locale<span style="color:#ff79c6">,</span>String<span style="color:#ff79c6">,</span>Object<span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">transient</span> String <span style="color:#50fa7b">format</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">,</span>Object<span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">getBytes</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">byte</span><span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">byte</span><span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span> <span style="color:#50fa7b">getBytes</span><span style="color:#ff79c6">(</span>Charset<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">byte</span><span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span> <span style="color:#50fa7b">getBytes</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">byte</span><span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span> <span style="color:#50fa7b">getBytes</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">getChars</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
 <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">getChars</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">indexOfSupplementary</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">native</span> String <span style="color:#50fa7b">intern</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">isEmpty</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">transient</span> String <span style="color:#50fa7b">join</span><span style="color:#ff79c6">(</span>CharSequence<span style="color:#ff79c6">,</span>CharSequence<span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> String <span style="color:#50fa7b">join</span><span style="color:#ff79c6">(</span>CharSequence<span style="color:#ff79c6">,</span>Iterable<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">lastIndexOf</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">lastIndexOf</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">lastIndexOf</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span>String<span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">lastIndexOf</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">lastIndexOf</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">lastIndexOf</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">lastIndexOfSupplementary</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">length</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">matches</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">nonSyncContentEquals</span><span style="color:#ff79c6">(</span>AbstractStringBuilder<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">offsetByCodePoints</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">regionMatches</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span>String<span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">regionMatches</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">boolean</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span>String<span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">replace</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">replace</span><span style="color:#ff79c6">(</span>CharSequence<span style="color:#ff79c6">,</span>CharSequence<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">replaceAll</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">,</span>String<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">replaceFirst</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">,</span>String<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> String<span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span> <span style="color:#50fa7b">split</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> String<span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span> <span style="color:#50fa7b">split</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">startsWith</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">startsWith</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> CharSequence <span style="color:#50fa7b">subSequence</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">substring</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">substring</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">,</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">char</span><span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span> <span style="color:#50fa7b">toCharArray</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">toLowerCase</span><span style="color:#ff79c6">(</span>Locale<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">toLowerCase</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">toUpperCase</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">toUpperCase</span><span style="color:#ff79c6">(</span>Locale<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">trim</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span>
</code></pre></div><p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67lm2mercj30gs0dfgnf.jpg" alt="image-20210117165721204.png">

</p>
<p><strong>没有创建String实例，只要String类加载到了内存中就可以通过反射获取到该类的信息。</strong></p>
<h3 id="数组类型的加载">数组类型的加载</h3>
<p><strong>创建数组类的情况稍微有些特殊，因为 <strong>数组类本身并不是由类加载器负责创建</strong> ，而是由 JVM 在运行时根据需要而直接创建的，但数组的元素类型仍然需要依靠类加载器去创建。创建数组类(下述简称 A)的过程：</strong></p>
<ol>
<li><strong>如果数组的元素类型是引用类型，那么就遵循定义的加载过程递归加载和创建数组 A 的元素类型。（引用类型数组比如String[]，要加载String类。如果是int[]则不需要类加载，JVM直接创建即可，因为基本数据类型由虚拟机预先定义）</strong></li>
<li><strong>JVM 使用指定的元素类型和数组唯独来创建新的数组类。</strong></li>
</ol>
<p><strong>如果数组的元素类型是引用类型，数组类的可访问性就由元素类型的可访问性决定。否则数组类的可访问性将被缺省定义为 public。</strong></p>
<h2 id="过程二linking链接阶段">过程二：Linking(链接)阶段</h2>
<h3 id="环节1链接阶段之verification验证">环节1：链接阶段之Verification(验证)</h3>
<p><strong>当类加载到系统后，就开始链接操作，验证是链接操作的第一步。</strong></p>
<p><strong><strong>它的目的是保证加载的字节码是合法、合理并符合规范的</strong> 。</strong></p>
<p><strong>验证的步骤比较复杂，实际要验证的项目也很繁多，大体上 Java 虚拟机需要做以下检查，如图所示。</strong></p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67lngmyeuj30j30h7443.jpg" alt="image-20210117170545243.png">

</p>
<p><strong><strong>整体说明：</strong></strong></p>
<p><strong>验证的内容则涵盖了类数据信息的格式验证、语义检查、字节码验证，以及符号引用验证等。</strong></p>
<ul>
<li><strong>其中 <strong>格式验证会和加载阶段一起执行</strong> （只是归结的时候归结到链接这里）。验证通过之后，类加载器才会成功将类的二进制数据信息加载到方法区中。</strong></li>
<li><strong><strong>格式验证之外的验证操作将会在方法区中进行</strong> 。（即上图中“语义检查”、“字节码验证”、“符号引用验证”是加载后在方法区中进行）</strong></li>
</ul>
<p><strong>链接阶段的验证虽然拖慢了加载速度，但是它避免了在字节码运行时还需要进行各种检查。（磨刀不误砍柴工）</strong></p>
<p><strong><strong>具体说明：</strong></strong></p>
<p><strong>1、 <strong>格式验证</strong> ：是否以魔数 0xCAFEBABE 开头，主版本和副版本号是否在当前 Java 虚拟机的支持范围内，数据中每一个项是否都拥有正确的长度等。</strong></p>
<p><strong>2、Java 虚拟机会进行字节码的 <strong>语义检查</strong> ，但凡在语义上不符合规范的，虚拟机也不会给予验证通过。比如：</strong></p>
<ul>
<li><strong>是否所有的类都有父类的存在(在 Java 里，除了 Object 外，其他类都应该有父类)</strong></li>
<li><strong>是否一些被定义为 final 的方法或者类被重写或继承了</strong></li>
<li><strong>非抽象类是否实现了所有抽象方法或者接口方法</strong></li>
<li><strong>是否存在不兼容的方法(比如方法的签名除了返回值不同，其他都一样，这种方法会让虚拟机无从下手调度；absract 情况下的方法，就不能是final 的了)</strong></li>
</ul>
<p><strong>3、Java 虚拟机还会进行 <strong>字节码验证</strong> ，字节码验证也是 <strong>验证过程中最为复杂的一个过程</strong> 。它试图通过对字节码流的分析，判断字节码是否可以被正确地执行。比如：</strong></p>
<ul>
<li><strong>在字节码的执行过程中，是否会跳转到一条不存在的指令</strong></li>
<li><strong>函数的调用是否传递了正确类型的参数</strong></li>
<li><strong>变量的赋值是不是给了正确的数据类型等</strong></li>
</ul>
<p><strong>栈映射帧(StackMapTable)就是在这个阶段，用于检测在特定的字节码处，其局部变量表和操作数栈是否有着正确的数据类型。但遗憾的是，100%准确地判断一段字节码是否可以被安全执行是无法实现的，因此，该过程只是尽可能地检查出可以预知的明显的问题。如果在这个阶段无法通过检查，虚拟机也不会正确装载这个类。但是，如果通过了这个阶段的检查，也不能说明这个类是完全没有问题的。</strong></p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67lp10wt1j30zz0b37ca.jpg" alt="image-20210117173145164.png">

</p>
<p><strong><strong>在前面3次检查中，已经排除了文件格式错误、语义错误以及字节码的不正确性。但是依然不能确保类是没有问题的。</strong></strong></p>
<p><strong>4、校验器还将进行 <strong>符号引用的验证</strong> 。Class 文件在其常量池会通过字符串记录自己将要使用的其他类或者方法。因此，在验证阶段， <strong>虚拟机就会检查这些类或者方法确实是存在的</strong> ，并且当前类有权限访问这些数据，如果一个需要使用类无法在系统中找到，则会抛出 NoClassDefFoundError，如果一个方法无法被找到，则会抛出 NoSuchMethdError。（开发中一般是jar版本不对或jar冲突导致的这两种Error）</strong></p>
<p><strong>此阶段在解析环节才会执行。（只是归结到链接阶段）</strong></p>
<h3 id="环节2链接阶段之preparation准备">环节2：链接阶段之Preparation(准备)</h3>
<p><strong><strong>准备阶段(Preparation)，简言之，为类的静态变量分配内存，并将其初始化为默认值。</strong></strong></p>
<p><strong>当一个类验证通过时，虚拟机就会进入准备阶段。在这个阶段，虚拟机就会为这个类分配相应的内存空间，并设置默认初始值。</strong></p>
<p><strong>Java 虚拟机为各类型变量默认的初始值如表所示：</strong></p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67lpuglhbj30qw0cmq4w.jpg" alt="image-20210117174400636.png">

</p>
<p><strong>注意：Java 并不支持 boolean 类型，对于 boolean 类型，内部实现是 int，由于 int 的默认值是0，故对应的，boolean 的默认值就是 false，boolean为true就是1。</strong></p>
<p><strong>1、<strong>这里不包含基本数据类型的字段用 static final（这是常量，不是变量） 修饰的情况，因为 final 在编译的时候就会分配了，准备阶段会显式赋值。</strong></strong></p>
<p><strong>2、注意这里不会为实例变量分配初始化，类变量会分配在方法区中，而实例变量是会随着对象一起分配到 Java 堆中。</strong></p>
<p><strong>3、在这个阶段不会像初始化阶段中那样会有初始化或者代码被执行。</strong></p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67lrcobk6j31dc0noe26.jpg" alt="image-20210117190330377.png">

</p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67lrjie50j31d107cq9o.jpg" alt="image-20210117220744594.png">

</p>
<h3 id="环节3链接阶段之resolution解析">环节3：链接阶段之Resolution(解析)</h3>
<p><strong>在准备阶段完成后，就进入了解析阶段。</strong></p>
<p><strong><strong>解析阶段(Resolution)，简言之，将类、接口、字段和方法的符号引用转为直接引用。</strong></strong></p>
<p><strong><strong>1、具体描述：</strong></strong></p>
<p><strong>符号引用就是一些字面量的引用，和虚拟机的内部数据结构和内存布局无关。比较容理解的就是在 Class 类文件中，通过常量池进行了大量的符号引用。但是在程序实际运行时，只有符号引用是不够的，比如当如下 println() 方法被调用时，系统需要明确知道该方法的位置。</strong></p>
<p><strong>举例：输出操作 System.out.println() 对应的字节码：</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">invokevirtual #24 <span style="color:#ff79c6">&lt;</span>java<span style="color:#ff79c6">/</span>io<span style="color:#ff79c6">/</span>PrintStream<span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">&gt;</span>
</code></pre></div><p><strong>#24是符号引用，指向的是println()方法，而println()方法在内存中的真实地址就是符号引用转直接引用（直接引用就是内存中的地址）。</strong></p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67lsrn31yj30vk0dr0wm.jpg" alt="image-20210117221312986.png">

</p>
<p><strong>以方法为例，Java 虚拟机为每个类都准备了一张方法表，将其所有的方法都列在表中，当需要调用一个类的方法的时候，只要知道这个方法在方法表中的偏移量就可以直接调用该方法。<strong>通过解析操作，符号引用就可以转变为目标方法在类中方法表中的位置，从而使得方法被成功调用。</strong></strong></p>
<p><strong>打个比方：查了地图要去某个地方，在地图上显示要先做1号线，然后在某个站点转2号线才能到达，这就是符号引用。而直接引用是真正去坐车去那个地方，必须去到固定站点，找到对应的列车，才能坐到目的地。</strong></p>
<p><strong><strong>2、小结</strong></strong></p>
<p><strong>所谓解析就是将符号引用转为直接引用，也就是得到类、字段、方法在内存中的指针或者偏移量。因此，可以说，如果直接引用存在，那么可以肯定系统中存在该类、方法或者字段。但只存在符号引用，不能确定系统中一定存在该结构。</strong></p>
<p><strong>不过 Java 虚拟机规范并没有明确要求解析阶段一定要按照顺序执行。在 HotSpot VM 中，加载、验证、准备和初始化会按照顺序有条不紊地执行，但 <strong>链接阶段中的解析操作往往会伴随着 JVM 在执行完初始化之后再执行</strong> 。</strong></p>
<p><strong><strong>3、字符串的复习</strong></strong></p>
<p><strong>最后，再来看一下 CONSTANT_String 的解析。由于字符串在程序开发中有着重要的作用，因此，读者有必要了解一下 String 在 Java 虚拟机中的处理。 <strong>当在 Java 代码中直接使用字符串常量时，就会在类中出现 CONSTANT_String</strong> ，它表示字符串常量，并且会引用一个 CONSTANT_UTF8 的常量项。 <strong>在 Java 虚拟机内部运行中的常量池，会维护一张字符串拘留表(intern)（字符串常量池），它会保存所有出现过的字符串常量，并且没有重复项</strong> 。只要以 CONSTANT_String 形式出现的字符串也都会在这张表中。使用 String.intern() 方法可以得到一个字符串在拘留表中的引用，因为该表中没有重复项，所以任何字面相同的字符串的 String.intern() 方法返回总是相等的。</strong></p>
<h2 id="过程三initialization初始化阶段">过程三：Initialization(初始化)阶段</h2>
<p><strong><strong>初始化阶段，简言之，为类的静态变量赋予正确的初始值。</strong></strong></p>
<p><strong><strong>1、具体描述</strong></strong></p>
<p><strong>类的初始化是类装载的最后一个阶段。如果前面的步骤都没有问题，那么表示类可以顺利装载到系统中。此时，类才会开始执行 Java 字节码。(即： <strong>到了初始化阶段，才真正开始执行类中定义的 Java 程序代码</strong> 。)</strong></p>
<p><strong><strong>初始化阶段的重要工作是执行类的初始化方法：() 方法。</strong> （初始化方法是()并不是构造方法）</strong></p>
<ul>
<li><strong>该方法仅能由 Java 编译器生成并由 JVM 调用，程序开发者无法自定义一个同名的方法，更无法直接在 Java 程序中调用该方法，虽然该方法也是由字节码指令所组成。</strong></li>
<li><strong>它是由类静态成员的赋值语句以及 static 语句块合并产生的。</strong></li>
</ul>
<p><strong><strong>2、说明</strong></strong></p>
<p><strong>2.1、在加载一个类之前，虚拟机总是会试图加载该类的父类，因此父类的()总是在子类()之前被调用.也就是说，父类的 static 块优先级高于子类.</strong></p>
<p><strong>2.2、Java 编译器并不会为所有的类都产生()初始化方法。哪些类在编译为字节码后，字节码文件中将不会包含 () 方法？</strong></p>
<ul>
<li><strong>一个类中并没有声明任何的类变量（静态变量），也没有静态代码块时</strong></li>
<li><strong>一个类中声明类变量，但是没有明确使用类变量的初始化语句以及静态代码块来执行初始化操作时</strong></li>
<li><strong>一个类中包含 static final 修饰的基本数据类型的字段，这些类字段初始化语句采用编译时常量表达式</strong></li>
</ul>
<p><strong>例子1</strong></p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67lv110uwj31400f6woy.jpg" alt="image-20210121081901019.png">

</p>
<p><strong>例子2：继承上一个例子的_20_InitializationTest1</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#ff79c6">package</span> _10<span style="color:#ff79c6">;</span>

<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">_21_SubInitialization</span> <span style="color:#8be9fd;font-style:italic">extends</span> _20_InitializationTest1 <span style="color:#ff79c6">{</span>
    <span style="color:#8be9fd;font-style:italic">static</span><span style="color:#ff79c6">{</span>
        number <span style="color:#ff79c6">=</span> 4<span style="color:#ff79c6">;</span><span style="color:#6272a4">//number属性必须提前已经加载：一定会先加载父类。
</span><span style="color:#6272a4"></span>        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;son static{}&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>

    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">main</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span> args<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span>number<span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>
<span style="color:#ff79c6">}</span>

输出结果
father <span style="color:#8be9fd;font-style:italic">static</span><span style="color:#ff79c6">{</span><span style="color:#ff79c6">}</span>
son <span style="color:#8be9fd;font-style:italic">static</span><span style="color:#ff79c6">{</span><span style="color:#ff79c6">}</span>
4
</code></pre></div><p><strong>例子3：</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#ff79c6">package</span> _10<span style="color:#ff79c6">;</span>

<span style="color:#6272a4">/**
</span><span style="color:#6272a4"> * 哪些场景下，java编译器就不会生成&lt;clinit&gt;()方法
</span><span style="color:#6272a4"> */</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">_22_InitializationTest2</span> <span style="color:#ff79c6">{</span>
    <span style="color:#6272a4">//场景1：对应非静态的字段，不管是否进行了显式赋值，都不会生成&lt;clinit&gt;()方法
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> num <span style="color:#ff79c6">=</span> 1<span style="color:#ff79c6">;</span>
    <span style="color:#6272a4">//场景2：静态的字段，没有显式的赋值，不会生成&lt;clinit&gt;()方法
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">int</span> num1<span style="color:#ff79c6">;</span>
    <span style="color:#6272a4">//场景3：比如对于声明为static final的基本数据类型的字段，不管是否进行了显式赋值，都不会生成&lt;clinit&gt;()方法
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> <span style="color:#8be9fd">int</span> num2 <span style="color:#ff79c6">=</span> 1<span style="color:#ff79c6">;</span>
<span style="color:#ff79c6">}</span>
</code></pre></div><p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67ly0ha6uj30xs0kh48a.jpg" alt="image-20210122075154221.png">

</p>
<p><strong>去掉final，对比</strong></p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67lyi4bbcj312t07sq9l.jpg" alt="image-20210122075656136.png">

</p>
<p><strong>总结</strong></p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67lyqharlj30zm08u0zb.jpg" alt="image-20210122081239460.png">

</p>
<h3 id="static与final的搭配问题">static与final的搭配问题</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#ff79c6">package</span> _10<span style="color:#ff79c6">;</span>

<span style="color:#ff79c6">import</span> java.util.Random<span style="color:#ff79c6">;</span>

<span style="color:#6272a4">/**
</span><span style="color:#6272a4"> * 说明：使用static + final修饰的字段的显式赋值的操作，到底是在哪个阶段进行的赋值？
</span><span style="color:#6272a4"> * 情况1：在链接阶段的准备环节赋值
</span><span style="color:#6272a4"> * 情况2：在初始化阶段&lt;clinit&gt;()中赋值
</span><span style="color:#6272a4"> *
</span><span style="color:#6272a4"> * 结论：
</span><span style="color:#6272a4"> * 在链接阶段的准备环节赋值的情况：
</span><span style="color:#6272a4"> * 1. 对于基本数据类型的字段来说，如果使用static final修饰，则显式赋值(直接赋值常量，而非调用方法）通常是在链接阶段的准备环节进行
</span><span style="color:#6272a4"> * 2. 对于String来说，如果使用字面量的方式赋值，使用static final修饰的话，则显式赋值通常是在链接阶段的准备环节进行
</span><span style="color:#6272a4"> *
</span><span style="color:#6272a4"> * 在初始化阶段&lt;clinit&gt;()中赋值的情况：
</span><span style="color:#6272a4"> * 排除上述的在准备环节赋值的情况之外的情况。（并不是只是根据final来区分）
</span><span style="color:#6272a4"> * （上述说的还有一点不够准确，比如：public static final int NUM1 = new Random().nextInt(10);）
</span><span style="color:#6272a4"> *
</span><span style="color:#6272a4"> * 最终结论：使用static + final修饰，且显示赋值中不涉及到方法或构造器调用的基本数据类型或String类型的显式赋值，是在链接阶段的准备环节进行；
</span><span style="color:#6272a4"> * 除此之外都在初始化阶段进行，这很适合跟面试官对线。
</span><span style="color:#6272a4"> */</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">_23_InitializationTest3</span> <span style="color:#ff79c6">{</span>
    <span style="color:#6272a4">//在初始化阶段&lt;clinit&gt;()中赋值
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">int</span> a <span style="color:#ff79c6">=</span> 1<span style="color:#ff79c6">;</span>
    <span style="color:#6272a4">//在链接阶段的准备环节赋值
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> <span style="color:#8be9fd">int</span> INT_CONSTANT <span style="color:#ff79c6">=</span> 10<span style="color:#ff79c6">;</span>

    <span style="color:#6272a4">//在初始化阶段&lt;clinit&gt;()中赋值
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> Integer INTEGER_CONSTANT1 <span style="color:#ff79c6">=</span> Integer<span style="color:#ff79c6">.</span><span style="color:#50fa7b">valueOf</span><span style="color:#ff79c6">(</span>100<span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
    <span style="color:#6272a4">//在初始化阶段&lt;clinit&gt;()中赋值
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> Integer INTEGER_CONSTANT2 <span style="color:#ff79c6">=</span> Integer<span style="color:#ff79c6">.</span><span style="color:#50fa7b">valueOf</span><span style="color:#ff79c6">(</span>1000<span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>

    <span style="color:#6272a4">//在链接阶段的准备环节赋值（字面量的方式声明）
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> String s0 <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;helloworld0&#34;</span><span style="color:#ff79c6">;</span>
    <span style="color:#6272a4">//在初始化阶段&lt;clinit&gt;()中赋值（new对象的方式声明）
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> String s1 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> String<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;helloworld1&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>

    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> String s2 <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;helloworld2&#34;</span><span style="color:#ff79c6">;</span>

    <span style="color:#6272a4">//在初始化阶段&lt;clinit&gt;()中赋值（编译之后NUM1无法确定，必须执行代码）
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> <span style="color:#8be9fd">int</span> NUM1 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Random<span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">nextInt</span><span style="color:#ff79c6">(</span>10<span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
<span style="color:#ff79c6">}</span>
</code></pre></div><p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67m0s2dmcj31g00oz1kx.jpg" alt="image-20210123184014122.png">

</p>
<h3 id="clinit的线程安全性"><code>&lt;clinit&gt;</code>()的线程安全性</h3>
<p><strong>对于() 方法的调用，也就是类的初始化，虚拟机会在内部确保其多线程环境中的安全性。</strong></p>
<p><strong>虚拟机会保证一个类的  () 方法在多线程环境中被正确地加锁、同步，如果多个线程同时去初始化一个类，那么只会有一个线程去执行这个类的 () 方法，其他线程都需要阻塞等待，直到活动线程执行 () 方法完毕。</strong></p>
<p><strong>正是因为 <strong>函数 () 带锁线程安全的</strong> ，因此，如果一个在类的 () 方法中有耗时很长的操作，就可能造成多个线程阻塞，引发死锁。并且这种死锁是很难发现的，因为看起来它们并没有可用的锁信息（没有synchronized关键词，是隐式的锁）。</strong></p>
<p><strong>如果之前的线程成功加载了类，则等在队列中的线程就没有机会再执行 () 方法了。那么，当需要使用这个类时，虚拟机会直接返回给它已经准备好的信息。</strong></p>
<h3 id="类的初始化情况主动使用-vs-被动使用">类的初始化情况：主动使用 vs 被动使用</h3>
<p><strong>Java 程序对类的使用分为两种：主动使用 和 被动使用。主动使用会调用()方法，被动使用不会调用，即主动使用才会有初始化。</strong></p>
<h4 id="主动使用">主动使用</h4>
<p><strong>Class 只有在必须要首次使用的时候才会被装载，Java 虚拟机不会无条件地装载 Class 类型。Java 虚拟机规定，一个类或接口在初次使用前，必须要进行初始化。这里指的&quot;使用&rdquo;，是指主动使用，主动使用只有下列几种情况：(即：如果出现如下的情况，则会对类进行初始化操作。而初始化操作之前的加载、验证、准备都已经完成。)</strong></p>
<ol>
<li><strong>当创建一个类的实例时，比如使用 new 关键字，或者通过反射、克隆、反序列化</strong></li>
<li><strong>当调用类的静态方法时，即当使用了字节码 invokestatic 指令</strong></li>
<li><strong>当使用类、接口的静态字段时(final 修饰特殊考虑)，比如，使用 getstatic 或者 putsttic 指令。(对应访问变量、赋值变量操作)</strong></li>
<li><strong>当使用 java.lang.reflect 包中的方法反射类的方法时。比如：Class.forname(&ldquo;com.atguigu.java.Test&rdquo;)</strong></li>
<li><strong>当初始化子类时，如果发现其父类还没有进行过初始化，则需要先触发其父类的初始化</strong></li>
<li><strong>如果一个接口定义了 default 方法，那么直接实现或者间接实现该接口的类的初始化，该接口要在其之前被初始化</strong></li>
<li><strong>当虚拟机启动时，用户需要指定一个要执行的主类(包含 main() 方法的那个类)，虚拟机会先初始化这个主类</strong></li>
<li><strong>当初次调用 MethodHandle 实例时，初始化该 MethodHandle 指向的方法所在的类。(涉及解析 REF_getStatic、REF_putStatic、REF_invokeStatic 方法句柄对应的类)</strong></li>
</ol>
<p><strong><strong>针对上述第5点，补充说明：</strong></strong></p>
<p><strong>当 Java 虚拟机初始化一个类时，要求它的所有父类都已经被初始化，但是这条规则并不适用于接口</strong></p>
<ul>
<li><strong>在初始化一个类时，并不会先初始化它所实现的接口</strong></li>
<li><strong>在初始化一个接口时，并不会先初始化它的父接口</strong></li>
</ul>
<p><strong>因此，一个父接口并不会因为它的子接口或者实现类的初始化而初始化，只有当程序首次使用特定接口的静态字段时，才会导致该接口的初始化。</strong></p>
<p><strong><strong>针对上述第7点，说明：</strong></strong></p>
<p><strong>JVM 启动的时候通过引导类加载器加载一个初始类。这个类在调用 public static void main(String[]) 方法之前被链接和初始化。这个方法的执行将依次导致所需的类的加载、链接和初始化。</strong></p>
<p><strong>例子1</strong></p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67m4yj16nj31ec0ixtrl.jpg" alt="image-20210124100811384 (1).png">

</p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67m54jh7pj311709hwkq.jpg" alt="image-20210124101400618.png">

</p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67m59flcnj310q1crwy4.jpg" alt="image-20210124101845825.png">

</p>
<p><strong>例子2：</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">
<span style="color:#ff79c6">package</span> _11<span style="color:#ff79c6">;</span>

<span style="color:#ff79c6">import</span> org.junit.Test<span style="color:#ff79c6">;</span>

<span style="color:#ff79c6">import</span> java.util.Random<span style="color:#ff79c6">;</span>

<span style="color:#6272a4">/**
</span><span style="color:#6272a4"> * 3. 当使用类、接口的静态字段时(final修饰特殊考虑)，比如，使用getstatic或者putstatic指令。（对应访问变量、赋值变量操作）
</span><span style="color:#6272a4"> *
</span><span style="color:#6272a4"> */</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">_26_ActiveUse2</span> <span style="color:#ff79c6">{</span>

    @Test
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">test1</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">{</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span>User<span style="color:#ff79c6">.</span><span style="color:#50fa7b">num</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span> <span style="color:#6272a4">// 会初始化
</span><span style="color:#6272a4"></span><span style="color:#6272a4">//        System.out.println(User.num1); // 不会初始化
</span><span style="color:#6272a4"></span><span style="color:#6272a4">//        System.out.println(User.num2); // 会初始化
</span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">}</span>
<span style="color:#ff79c6">}</span>

<span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">User</span><span style="color:#ff79c6">{</span>
    <span style="color:#8be9fd;font-style:italic">static</span><span style="color:#ff79c6">{</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;User类的初始化过程&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>

    <span style="color:#6272a4">// 初始化阶段那赋值
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">int</span> num <span style="color:#ff79c6">=</span> 1<span style="color:#ff79c6">;</span>
    <span style="color:#6272a4">// 准备阶段就赋值好了
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> <span style="color:#8be9fd">int</span> num1 <span style="color:#ff79c6">=</span> 1<span style="color:#ff79c6">;</span>
    <span style="color:#6272a4">// 初始化阶段才赋值
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> <span style="color:#8be9fd">int</span> num2 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Random<span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">nextInt</span><span style="color:#ff79c6">(</span>10<span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
<span style="color:#ff79c6">}</span>
</code></pre></div><p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67m61edhcj30ki0aun17.jpg" alt="image-20210124105930250.png">

</p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67m6j04i1j30kl0bq785.jpg" alt="image-20210124110024454.png">

</p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67m6pbj58j30le0cltcz.jpg" alt="image-20210124110040369.png">

</p>
<p><strong>例子3：</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#ff79c6">package</span> _11<span style="color:#ff79c6">;</span>

<span style="color:#ff79c6">import</span> org.junit.Test<span style="color:#ff79c6">;</span>

<span style="color:#ff79c6">import</span> java.util.Random<span style="color:#ff79c6">;</span>

<span style="color:#6272a4">/**
</span><span style="color:#6272a4"> * 3. 当使用类、接口的静态字段时(final修饰特殊考虑)，比如，使用getstatic或者putstatic指令。（对应访问变量、赋值变量操作）
</span><span style="color:#6272a4"> *
</span><span style="color:#6272a4"> */</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">_27_ActiveUse3</span> <span style="color:#ff79c6">{</span>

    @Test
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">test1</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">{</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span>CompareA<span style="color:#ff79c6">.</span><span style="color:#50fa7b">NUM1</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
<span style="color:#6272a4">//        System.out.println(CompareA.NUM2);
</span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">}</span>
<span style="color:#ff79c6">}</span>

<span style="color:#8be9fd;font-style:italic">interface</span> <span style="color:#50fa7b">CompareA</span><span style="color:#ff79c6">{</span>

    <span style="color:#6272a4">// 接口不能执行静态代码块，但静态变量使用代码的方式赋值会在clinit执行
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> Thread t <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Thread<span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">{</span>
        <span style="color:#ff79c6">{</span>
            <span style="color:#6272a4">// 这句话输出了就说明接口初始化了
</span><span style="color:#6272a4"></span>            System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;CompareA的初始化&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
        <span style="color:#ff79c6">}</span>
    <span style="color:#ff79c6">}</span><span style="color:#ff79c6">;</span>

    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> <span style="color:#8be9fd">int</span> NUM1 <span style="color:#ff79c6">=</span> 1<span style="color:#ff79c6">;</span>
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> <span style="color:#8be9fd">int</span> NUM2 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Random<span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">nextInt</span><span style="color:#ff79c6">(</span>10<span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>

<span style="color:#ff79c6">}</span>
</code></pre></div><p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67m87wqotj316u0ie135.jpg" alt="image-20210124110945723.png">

</p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67m8flhanj30kq0a641i.jpg" alt="image-20210124111054386.png">

</p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67m8kflxyj30l00bjn0p.jpg" alt="image-20210124111110655.png">

</p>
<p><strong>例子4：</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#ff79c6">package</span> _11<span style="color:#ff79c6">;</span>

<span style="color:#ff79c6">import</span> org.junit.Test<span style="color:#ff79c6">;</span>

<span style="color:#ff79c6">import</span> java.util.Random<span style="color:#ff79c6">;</span>

<span style="color:#6272a4">/**
</span><span style="color:#6272a4"> * 4. 当使用java.lang.reflect包中的方法反射类的方法时。比如：Class.forName(&#34;com.atguigu.java.Test&#34;)
</span><span style="color:#6272a4"> * 5. 当初始化子类时，如果发现其父类还没有进行过初始化，则需要先触发其父类的初始化。
</span><span style="color:#6272a4"> * 6. 如果一个接口定义了default方法，那么直接实现或者间接实现该接口的类的初始化，该接口要在其之前被初始化。
</span><span style="color:#6272a4"> * 7. 当虚拟机启动时，用户需要指定一个要执行的主类（包含main()方法的那个类），虚拟机会先初始化这个主类。
</span><span style="color:#6272a4"> * 8. 当初次调用 MethodHandle 实例时，初始化该 MethodHandle 指向的方法所在的类。（涉及解析REF_getStatic、REF_putStatic、REF_invokeStatic方法句柄对应的类） -- 这点不举例
</span><span style="color:#6272a4"> *
</span><span style="color:#6272a4"> * 针对5，补充说明：
</span><span style="color:#6272a4"> * 当Java虚拟机初始化一个类时，要求它的所有父类都已经被初始化，但是这条规则并不适用于接口。
</span><span style="color:#6272a4"> *   &gt; 在初始化一个类时，并不会先初始化它所实现的接口
</span><span style="color:#6272a4"> *   &gt; 在初始化一个接口时，并不会先初始化它的父接口
</span><span style="color:#6272a4"> * 因此，一个父接口并不会因为它的子接口或者实现类的初始化而初始化。只有当程序首次使用特定接口的静态字段时，才会导致该接口的初始化。
</span><span style="color:#6272a4"> *
</span><span style="color:#6272a4"> */</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">_28_ActiveUse4</span> <span style="color:#ff79c6">{</span>

    <span style="color:#8be9fd;font-style:italic">static</span><span style="color:#ff79c6">{</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;ActiveUse3的初始化过程&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>

    <span style="color:#6272a4">// 4. 当使用java.lang.reflect包中的方法反射类的方法时。比如：Class.forName(&#34;com.atguigu.java.Test&#34;)
</span><span style="color:#6272a4"></span>    @Test
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">test1</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
        <span style="color:#ff79c6">try</span> <span style="color:#ff79c6">{</span>
            Class clazz <span style="color:#ff79c6">=</span> Class<span style="color:#ff79c6">.</span><span style="color:#50fa7b">forName</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;_11.Order&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
        <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">catch</span> <span style="color:#ff79c6">(</span>ClassNotFoundException e<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
            e<span style="color:#ff79c6">.</span><span style="color:#50fa7b">printStackTrace</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
        <span style="color:#ff79c6">}</span>
    <span style="color:#ff79c6">}</span>

    <span style="color:#6272a4">/**
</span><span style="color:#6272a4">     * 5. 当初始化子类时，如果发现其父类还没有进行过初始化，则需要先触发其父类的初始化。
</span><span style="color:#6272a4">     * -XX:+TraceClassLoading
</span><span style="color:#6272a4">     * 在初始化一个类时，并不会先初始化它所实现的接口（没有default修饰的方法的接口）
</span><span style="color:#6272a4">      */</span>
    @Test
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">test2</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span>Son<span style="color:#ff79c6">.</span><span style="color:#50fa7b">num</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>

    <span style="color:#6272a4">// 6. 如果一个接口定义了default方法，那么直接实现或者间接实现该接口的类的初始化，该接口要在其之前被初始化。
</span><span style="color:#6272a4"></span>    @Test
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">test4</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span>Son2<span style="color:#ff79c6">.</span><span style="color:#50fa7b">num</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>

    <span style="color:#6272a4">// 需要执行代码来赋值的会触发初始化
</span><span style="color:#6272a4"></span>    @Test
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">test3</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">{</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span>CompareC<span style="color:#ff79c6">.</span><span style="color:#50fa7b">NUM1</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>

    <span style="color:#6272a4">// 7. 当虚拟机启动时，用户需要指定一个要执行的主类（包含main()方法的那个类），虚拟机会先初始化这个主类。
</span><span style="color:#6272a4"></span>    <span style="color:#6272a4">// 调用main方法需要先加载当前类_28_ActiveUse4，即会触发_28_ActiveUse4的初始化
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">main</span><span style="color:#ff79c6">(</span>String<span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span> args<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;hello&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>
<span style="color:#ff79c6">}</span>

<span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">Father</span> <span style="color:#ff79c6">{</span>
    <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#ff79c6">{</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Father类的初始化过程&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>
<span style="color:#ff79c6">}</span>

<span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">Son</span> <span style="color:#8be9fd;font-style:italic">extends</span> Father <span style="color:#8be9fd;font-style:italic">implements</span> CompareB <span style="color:#ff79c6">{</span>
    <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#ff79c6">{</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Son类的初始化过程&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>

    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">int</span> num <span style="color:#ff79c6">=</span> 1<span style="color:#ff79c6">;</span>
<span style="color:#ff79c6">}</span>

<span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">Son2</span> <span style="color:#8be9fd;font-style:italic">extends</span> Father <span style="color:#8be9fd;font-style:italic">implements</span> CompareB2<span style="color:#ff79c6">{</span>
    <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#ff79c6">{</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Son2类的初始化过程&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>

    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">int</span> num <span style="color:#ff79c6">=</span> 1<span style="color:#ff79c6">;</span>
<span style="color:#ff79c6">}</span>

<span style="color:#8be9fd;font-style:italic">interface</span> <span style="color:#50fa7b">CompareB</span> <span style="color:#ff79c6">{</span>
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> Thread t <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Thread<span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
        <span style="color:#ff79c6">{</span>
            System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;CompareB的初始化&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
        <span style="color:#ff79c6">}</span>
    <span style="color:#ff79c6">}</span><span style="color:#ff79c6">;</span>

<span style="color:#ff79c6">}</span>

<span style="color:#8be9fd;font-style:italic">interface</span> <span style="color:#50fa7b">CompareB2</span> <span style="color:#ff79c6">{</span>
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> Thread t <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Thread<span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
        <span style="color:#ff79c6">{</span>
            System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;CompareB的初始化&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
        <span style="color:#ff79c6">}</span>
    <span style="color:#ff79c6">}</span><span style="color:#ff79c6">;</span>

    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#ff79c6">default</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">method1</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">{</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;你好！&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>
<span style="color:#ff79c6">}</span>

<span style="color:#8be9fd;font-style:italic">interface</span> <span style="color:#50fa7b">CompareC</span> <span style="color:#8be9fd;font-style:italic">extends</span> CompareB <span style="color:#ff79c6">{</span>
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> Thread t <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Thread<span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
        <span style="color:#ff79c6">{</span>
            System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;CompareC的初始化&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
        <span style="color:#ff79c6">}</span>
    <span style="color:#ff79c6">}</span><span style="color:#ff79c6">;</span>

    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> <span style="color:#8be9fd">int</span> NUM1 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Random<span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">nextInt</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
<span style="color:#ff79c6">}</span>
</code></pre></div><p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67mbh6rj0j311i0lqk0k.jpg" alt="image-20210124131605335 (1).png">

</p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67mbr45urj30w90h67bf.jpg" alt="image-20210124133150288 (1).png">

</p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67mcb00wwj31170fddmw.jpg" alt="image-20210124132626619.png">

</p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h67mbxy8bxj30y40axwkl.jpg" alt="image-20210124133609216.png">

</p>
<h4 id="被动使用">被动使用</h4>
<p><strong>除了以上的情况属于主动使用，其他的情况均属于被动使用。 <strong>被动使用不会引起类的初始化</strong> 。</strong></p>
<p><strong>也就是说： <strong>并不是在代码中出现的类，就一定会被加载或者初始化。如果不符合主动使用的条件，类就不会初始化</strong> 。</strong></p>
<ol>
<li><strong>当访问一个静态字段时，只有真正声明这个字段的类才会被初始化</strong>
<ul>
<li><strong>当通过子类引用父类的静态变量，不会导致子类初始化（但子类是有加载阶段的）</strong></li>
</ul>
</li>
<li><strong>通过数组定义类引用，不会触发此类的初始化</strong></li>
<li><strong>引用变量不会触发此类或接口的初始化。因为常量在链接阶段就已经被显式赋值了</strong></li>
<li><strong>调用 ClassLoader 类的 loadClass() 方法加载一个类，并不是对类的主动使用，不会导致类的初始化</strong></li>
</ol>
<p><strong>如果针对代码，设置参数 -XX:+TraceClassLoading，可以追踪类的加载信息并打印出来</strong></p>
<p><strong>例子1：</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#ff79c6">package</span> _11<span style="color:#ff79c6">;</span>

<span style="color:#ff79c6">import</span> org.junit.Test<span style="color:#ff79c6">;</span>

<span style="color:#6272a4">/**
</span><span style="color:#6272a4"> * 关于类的被动使用，即不会进行类的初始化操作，即不会调用&lt;clinit&gt;()
</span><span style="color:#6272a4"> *
</span><span style="color:#6272a4"> * 1. 当访问一个静态字段时，只有真正声明这个字段的类才会被初始化。
</span><span style="color:#6272a4"> *     &gt; 当通过子类引用父类的静态变量，不会导致子类初始化
</span><span style="color:#6272a4"> * 2. 通过数组定义类引用，不会触发此类的初始化
</span><span style="color:#6272a4"> *
</span><span style="color:#6272a4"> * 说明：没有初始化的类，不意味着没有加载！
</span><span style="color:#6272a4"> */</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">_29_PassiveUse1</span> <span style="color:#ff79c6">{</span>

    <span style="color:#6272a4">// 当通过子类引用父类的静态变量，不会导致子类初始化
</span><span style="color:#6272a4"></span>    @Test
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">test1</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">{</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span>Child<span style="color:#ff79c6">.</span><span style="color:#50fa7b">num</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>

    <span style="color:#6272a4">// 通过数组定义类引用，不会触发此类的初始化
</span><span style="color:#6272a4"></span>    @Test
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">test2</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">{</span>
        Parent<span style="color:#ff79c6">[</span><span style="color:#ff79c6">]</span> parents <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Parent<span style="color:#ff79c6">[</span>10<span style="color:#ff79c6">]</span><span style="color:#ff79c6">;</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span>parents<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getClass</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span>parents<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getClass</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">getSuperclass</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>

<span style="color:#6272a4">//        parents[0] = new Parent(); // new才会初始化
</span><span style="color:#6272a4"></span><span style="color:#6272a4">//        parents[1] = new Parent(); // 再new也不会再次初始化，初始化方法只会执行一次
</span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">}</span>
<span style="color:#ff79c6">}</span>

<span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">Parent</span><span style="color:#ff79c6">{</span>
    <span style="color:#8be9fd;font-style:italic">static</span><span style="color:#ff79c6">{</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Parent的初始化过程&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>

    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">int</span> num <span style="color:#ff79c6">=</span> 1<span style="color:#ff79c6">;</span>
<span style="color:#ff79c6">}</span>

<span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">Child</span> <span style="color:#8be9fd;font-style:italic">extends</span> Parent<span style="color:#ff79c6">{</span>
    <span style="color:#8be9fd;font-style:italic">static</span><span style="color:#ff79c6">{</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Child的初始化过程&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>
<span style="color:#ff79c6">}</span>
</code></pre></div><p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h68mintxspj30jx0b1tbx.jpg" alt="image-20210124134053921.png">

</p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h68miu89x6j30qa03xdi9.jpg" alt="image-20210124134156883.png">

</p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h68mizq4xvj30o20gs7aq.jpg" alt="image-20210124134339839.png">

</p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h68mj579ckj30t40hvwmb.jpg" alt="image-20210124134433965.png">

</p>
<p><strong>例子2：</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#ff79c6">package</span> _11<span style="color:#ff79c6">;</span>

<span style="color:#ff79c6">import</span> org.junit.Test<span style="color:#ff79c6">;</span>

<span style="color:#ff79c6">import</span> java.util.Random<span style="color:#ff79c6">;</span>

<span style="color:#6272a4">/**
</span><span style="color:#6272a4"> *  3. 引用常量不会触发此类或接口的初始化。因为常量在链接阶段就已经被显式赋值了。
</span><span style="color:#6272a4"> *  4. 调用ClassLoader类的loadClass()方法加载一个类，并不是对类的主动使用，不会导致类的初始化。
</span><span style="color:#6272a4"> */</span>
<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">_30_PassiveUse2</span> <span style="color:#ff79c6">{</span>

    <span style="color:#6272a4">// 3. 引用常量不会触发此类或接口的初始化。因为常量在链接阶段就已经被显式赋值了。（类）
</span><span style="color:#6272a4"></span>    @Test
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">test1</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">{</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span>Person<span style="color:#ff79c6">.</span><span style="color:#50fa7b">NUM</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span> <span style="color:#6272a4">// 引用常量不会触发此类或接口的初始化。
</span><span style="color:#6272a4"></span>        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;----------------------------------&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span>Person<span style="color:#ff79c6">.</span><span style="color:#50fa7b">NUM1</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span> <span style="color:#6272a4">// 引用常量不会触发此类或接口的初始化，但是赋值需要执行代码就需要初始化
</span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">}</span>

    <span style="color:#6272a4">// 3. 引用常量不会触发此类或接口的初始化。因为常量在链接阶段就已经被显式赋值了。（接口）
</span><span style="color:#6272a4"></span>    @Test
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">test2</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">{</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span>SerialA<span style="color:#ff79c6">.</span><span style="color:#50fa7b">ID</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;----------------------------------&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span>SerialA<span style="color:#ff79c6">.</span><span style="color:#50fa7b">ID1</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>

    <span style="color:#6272a4">// 4. 调用ClassLoader类的loadClass()方法加载一个类，并不是对类的主动使用，不会导致类的初始化。
</span><span style="color:#6272a4"></span>    @Test
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">test3</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">{</span>
        <span style="color:#ff79c6">try</span> <span style="color:#ff79c6">{</span>
            <span style="color:#6272a4">// 有两种方式加载类
</span><span style="color:#6272a4"></span><span style="color:#6272a4">//            Class clazz = Class.forName(&#34;_11.Person&#34;);
</span><span style="color:#6272a4"></span>            Class clazz <span style="color:#ff79c6">=</span> ClassLoader<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getSystemClassLoader</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">loadClass</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;_11.Person&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
        <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">catch</span> <span style="color:#ff79c6">(</span>ClassNotFoundException e<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
            e<span style="color:#ff79c6">.</span><span style="color:#50fa7b">printStackTrace</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
        <span style="color:#ff79c6">}</span>
    <span style="color:#ff79c6">}</span>

<span style="color:#ff79c6">}</span>

<span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">Person</span><span style="color:#ff79c6">{</span>
    <span style="color:#8be9fd;font-style:italic">static</span><span style="color:#ff79c6">{</span>
        System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Person类的初始化&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>
    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> <span style="color:#8be9fd">int</span> NUM <span style="color:#ff79c6">=</span> 1<span style="color:#ff79c6">;</span><span style="color:#6272a4">//在链接过程的准备环节就被赋值为1了。
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> <span style="color:#8be9fd">int</span> NUM1 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Random<span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">nextInt</span><span style="color:#ff79c6">(</span>10<span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span><span style="color:#6272a4">//此时的赋值操作需要在&lt;clinit&gt;()中执行
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">}</span>

<span style="color:#8be9fd;font-style:italic">interface</span> <span style="color:#50fa7b">SerialA</span><span style="color:#ff79c6">{</span>
    <span style="color:#6272a4">// 接口字段默认是public static final
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> Thread t <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Thread<span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
        <span style="color:#ff79c6">{</span>
            System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">out</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">println</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;SerialA的初始化&#34;</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span>
        <span style="color:#ff79c6">}</span>
    <span style="color:#ff79c6">}</span><span style="color:#ff79c6">;</span>

    <span style="color:#8be9fd">int</span> ID <span style="color:#ff79c6">=</span> 1<span style="color:#ff79c6">;</span>
    <span style="color:#8be9fd">int</span> ID1 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Random<span style="color:#ff79c6">(</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">nextInt</span><span style="color:#ff79c6">(</span>10<span style="color:#ff79c6">)</span><span style="color:#ff79c6">;</span><span style="color:#6272a4">//此时的赋值操作需要在&lt;clinit&gt;()中执行
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">}</span>
</code></pre></div><p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h68mk13iiqj310q0feaic.jpg" alt="image-20210124135110574.png">

</p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h68mk75qtqj30wg0fijxm.jpg" alt="image-20210124135134401.png">

</p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h68mkculdrj30xb0gv45l.jpg" alt="image-20210124135332171.png">

</p>
<h2 id="过程四类的using使用">过程四：类的Using(使用)</h2>
<p><strong>链接阶段的验证阶段在加载阶段同时进行，链接阶段的解析阶段在初始化阶段同时进行。</strong></p>
<p><strong>任何一个类型在使用之前都必须经历过完整的加载、链接和初始化3个类加载步骤。一旦一个类型成功经历过这3个步骤之后，便“万事俱备，只欠东风”，就等着开发者使用了。</strong></p>
<p><strong>开发人员可以在程序中访问和调用它的静态类成员信息(比如：静态字段、静态方法)，或者使用 new 关键字为其创建对象实例。</strong></p>
<h2 id="过程五类的unloading卸载">过程五：类的Unloading(卸载)</h2>
<p><strong><strong>一、类、类的加载器、类的实例之间的引用关系</strong></strong></p>
<p><strong>在类加载器的内部实现中，用一个 Java 集合来存放所加载类的引用。另一方面，一个 Class 对象总是会引用它的类加载器，调用 Class 对象的 getClassLoader() 方法，就能获得它的类加载器。由此可见，代表某个类的 Class 实例与其类的加载器之间为双向关联关系。</strong></p>
<p><strong>一个类的实例总是引用代表这个类的 Class 对象。在 Object 类中定义了 getClass() 方法，这个方法返回代表对象所属类的 Class 对象的引用。此外，所有的 Java 类都有一个静态属性 Class，它引用代表这个类的 Class 对象。</strong></p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h68mlvt66aj30p70dfaej.jpg" alt="image-20210124225012483.png">

</p>
<p><strong><strong>二、类的生命周期</strong></strong></p>
<p><strong>当 Sample 类被加载、链接和初始化后，它的生命周期就开始了。当代表 Sample 类的 Class 对象不再被引用，即不可触及时，Class 对象就会结束生命周期，Sample 类在方法区内的数据也会被卸载，从而结束 Sample 类的生命周期。</strong></p>
<p><strong><strong>一个类何时结束生命周期，取决于代表它的 Class 对象何时结束生命周期</strong></strong></p>
<p><strong><strong>三、具体例子</strong></strong></p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h68mmqdj7lj30p70dfadq.jpg" alt="image-20210124225023189.png">

</p>
<p><strong>loader1 变量和 obj 变量间接应用代表 Sample 类的 Class 对象，而 objClass 变量则直接引用它。</strong></p>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h68mn4v4ooj30p70dfq7k.jpg" alt="image-20210124225839805.png">

</p>
<p><strong>如果程序运行过程中，将上图左侧三个引用变量都置为 null，此时 Sample 对象结束生命周期，MyClassLoader 对象结束生命周期，代表 Sample 类的 Class 对象也结束生命周期，Sample 类在方法区内的二进制数据 <strong>被卸载</strong> 。</strong></p>
<p><strong>当再次有需要时，会检查 Sample 类的 Class 对象是否存在， <strong>如果存在会直接使用，不再重新加载</strong> ；如果不存在 Sample 类会被重新加载，在 Java 虚拟机的堆区会生成一个新的代表 Sample 类的 Class 实例(可以通过哈希码查看是否是同一个实例)。</strong></p>
<p><strong><strong>四、类的卸载</strong></strong></p>
<p><strong>（1）启动类加载器加载的类型在整个运行期间是不可能被卸载的(JVM 和 JSL 规范)</strong></p>
<p><strong>（2）被系统类加载器和扩展类加载器加载的类型在运行期间不太可能被卸载，因为系统类加载器实例或者扩展类的实例基本上在整个运行期间总能直接或者间接的访问的到，其达到 unreachable 的可能性极小。（要卸载的类没有使用，但其他类可能会一直访问到）</strong></p>
<p><strong>（3）被开发者自定义的类加载器实例加载的类型只有在很简单的上下文环境中才能被卸载，而且一般还要借助于强制调用虚拟机的垃圾收集功能才可以做到。可以预想，稍微复杂点的应用场景(比如：很多时候用户在开发自定义类加载器实例的时候采用缓存的策略以提高系统性能)，被加载的类型在运行期间也是几乎不太可能被卸载的(至少卸载的时间是不确定的)。</strong></p>
<p><strong>综合以上三点，一个已经加载的类型被卸载的几率很小至少被卸载的时间是不确定的。同时我们可以看的出来，开发者在开发代码时候，不应该对虚拟机的类型卸载做任何假设的前提下，来实现系统中的特定功能。</strong></p>
<h5 id="回顾方法区的垃圾回收">回顾：方法区的垃圾回收</h5>
<p><strong>方法区的垃圾收集主要回收两部分内容：<strong>常量池中废弃的常量</strong>和 <strong>不再使用的类型</strong> 。</strong></p>
<p><strong>HotSpot 虚拟机对常量池的回收策略是很明确的，只要常量池中的常量没有被任何地方引用，就可以被回收。</strong></p>
<p><strong>判定一个常量是否&quot;废弃&quot;还是相对简单，而要判定一个类型是否属于&quot;不再被使用的类&quot;的条件就比较苛刻了。需要同时满足下面三个条件：</strong></p>
<ul>
<li><strong><strong>该类所有的实例都已经被回收。也就是 Java 堆中不存在该类及其任何派生子类的实例</strong> 。（下图的Sample对象）</strong></li>
<li><strong><strong>加载该类的类加载器已经被回收。这个条件除非是经过精心设计的可替换类加载器的场景，如 OSGI、JSP 的重加载等，否则通常是很难达成的</strong> 。（下图的MyClassLoader对象）</strong></li>
<li><em><strong>该类对应的 java.lang.Class 对象没有在任何地方被引用，无法在任何地方通过反射访问该类的方法</strong> 。（下图代表 Sample类的Class对象）</em></li>
</ul>
<p>
  <img src="http://tva1.sinaimg.cn/large/006QQPIfly1h68mlvt66aj30p70dfaej.jpg" alt="image-20210124225012483.png">

</p>
<p><strong>Java 虚拟机被允许对满足上述三个条件的无用类进行回收，这里说的仅仅是&quot;被允许&rdquo;（可能会被回收），而并不是和对象一样，没有引用了就必然会回收</strong></p>


                

                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/post/1058%E5%AD%97%E8%8A%82%E7%A0%81%E6%8C%87%E4%BB%A4%E9%9B%86%E4%B8%8E%E8%A7%A3%E6%9E%90%E4%B8%BE%E4%BE%8B/" data-toggle="tooltip" data-placement="top" title="18、字节码指令集与解析举例（JVM）">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/post/1060%E5%86%8D%E8%B0%88%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E5%99%A8/" data-toggle="tooltip" data-placement="top" title="20、再谈类的加载器（JVM）">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>
                

            </div>

            
            
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
            

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">标签</a></h5>
                    <div class="tags">
                        
                        
                        
                        <a href="/tags/activemq" title="activemq">
                            activemq
                        </a>
                        
                        
                        
                        <a href="/tags/ajax" title="ajax">
                            ajax
                        </a>
                        
                        
                        
                        <a href="/tags/cookie" title="cookie">
                            cookie
                        </a>
                        
                        
                        
                        <a href="/tags/datax" title="datax">
                            datax
                        </a>
                        
                        
                        
                        <a href="/tags/docker" title="docker">
                            docker
                        </a>
                        
                        
                        
                        <a href="/tags/dubbo" title="dubbo">
                            dubbo
                        </a>
                        
                        
                        
                        <a href="/tags/elasticsearch" title="elasticsearch">
                            elasticsearch
                        </a>
                        
                        
                        
                        <a href="/tags/filter" title="filter">
                            filter
                        </a>
                        
                        
                        
                        <a href="/tags/hadoop" title="hadoop">
                            hadoop
                        </a>
                        
                        
                        
                        <a href="/tags/hbase" title="hbase">
                            hbase
                        </a>
                        
                        
                        
                        <a href="/tags/hive" title="hive">
                            hive
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/java" title="java">
                            java
                        </a>
                        
                        
                        
                        <a href="/tags/javascript" title="javascript">
                            javascript
                        </a>
                        
                        
                        
                        <a href="/tags/javaweb" title="javaweb">
                            javaweb
                        </a>
                        
                        
                        
                        <a href="/tags/jdbc" title="jdbc">
                            jdbc
                        </a>
                        
                        
                        
                        <a href="/tags/jquery" title="jquery">
                            jquery
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/jsp" title="jsp">
                            jsp
                        </a>
                        
                        
                        
                        <a href="/tags/juc" title="juc">
                            juc
                        </a>
                        
                        
                        
                        <a href="/tags/jvm" title="jvm">
                            jvm
                        </a>
                        
                        
                        
                        <a href="/tags/jwt" title="jwt">
                            jwt
                        </a>
                        
                        
                        
                        <a href="/tags/kafka" title="kafka">
                            kafka
                        </a>
                        
                        
                        
                        <a href="/tags/linux" title="linux">
                            linux
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/maven" title="maven">
                            maven
                        </a>
                        
                        
                        
                        <a href="/tags/minio" title="minio">
                            minio
                        </a>
                        
                        
                        
                        <a href="/tags/mongodb" title="mongodb">
                            mongodb
                        </a>
                        
                        
                        
                        <a href="/tags/mybatis" title="mybatis">
                            mybatis
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/mysql" title="mysql">
                            mysql
                        </a>
                        
                        
                        
                        <a href="/tags/netty" title="netty">
                            netty
                        </a>
                        
                        
                        
                        <a href="/tags/nginx" title="nginx">
                            nginx
                        </a>
                        
                        
                        
                        <a href="/tags/react" title="react">
                            react
                        </a>
                        
                        
                        
                        <a href="/tags/redis" title="redis">
                            redis
                        </a>
                        
                        
                        
                        <a href="/tags/scala" title="scala">
                            scala
                        </a>
                        
                        
                        
                        <a href="/tags/servlet" title="servlet">
                            servlet
                        </a>
                        
                        
                        
                        <a href="/tags/session" title="session">
                            session
                        </a>
                        
                        
                        
                        <a href="/tags/shiro" title="shiro">
                            shiro
                        </a>
                        
                        
                        
                        <a href="/tags/spark" title="spark">
                            spark
                        </a>
                        
                        
                        
                        <a href="/tags/spring" title="spring">
                            spring
                        </a>
                        
                        
                        
                        <a href="/tags/springboot" title="springboot">
                            springboot
                        </a>
                        
                        
                        
                        <a href="/tags/springcloud" title="springcloud">
                            springcloud
                        </a>
                        
                        
                        
                        <a href="/tags/springmvc" title="springmvc">
                            springmvc
                        </a>
                        
                        
                        
                        <a href="/tags/springsecurity" title="springsecurity">
                            springsecurity
                        </a>
                        
                        
                        
                        <a href="/tags/tomcat" title="tomcat">
                            tomcat
                        </a>
                        
                        
                        
                        <a href="/tags/vue" title="vue">
                            vue
                        </a>
                        
                        
                        
                        <a href="/tags/xml" title="xml">
                            xml
                        </a>
                        
                        
                        
                        <a href="/tags/zookeeper" title="zookeeper">
                            zookeeper
                        </a>
                        
                        
                        
                        <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81" title="分布式锁">
                            分布式锁
                        </a>
                        
                        
                        
                        <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95" title="数据结构与算法">
                            数据结构与算法
                        </a>
                        
                        
                        
                        <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F" title="设计模式">
                            设计模式
                        </a>
                        
                        
                        
                        <a href="/tags/%E9%A1%B9%E7%9B%AE" title="项目">
                            项目
                        </a>
                        
                        
                    </div>
                </section>
                

                
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">                  
                    
                    <li>
                        <a href="mailto:1424197205@qq.com">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		           
                    
                    
                    
                    

		            
                    
                    <li>
                        <a target="_blank" href="/#">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-weixin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		            
                    
                    <li>
                        <a target="_blank" href="https://github.com/yiguan1573">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		            
                    
                    
                    
                    
                    
                    
                    
                    
                    
            
            
            
           
                   <li>
                       <a href='' rel="alternate" type="application/rss+xml" title="亿观的博客" >
                           <span class="fa-stack fa-lg">
                               <i class="fas fa-circle fa-stack-2x"></i>
                               <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
            
             </ul>
		<p class="copyright text-muted">
                    Copyright &copy; 亿观的博客 2022
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function loadAsync(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        loadAsync("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>









<script type="text/javascript">
    function generateCatalog(selector) {

        
        
        
        
            _containerSelector = 'div.post-container'
        

        
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        
        $(selector).html('')

        
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    


    loadAsync("\/js\/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>





</body>
</html>
