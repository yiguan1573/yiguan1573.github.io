<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

    <meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="referrer" content="never">
	
    
    <meta property="og:site_name" content="亿观的博客">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="http://yiguan1573.gitee.io//img/01.jpg">
    <meta property="twitter:image" content="http://yiguan1573.gitee.io//img/01.jpg" />
    

    
    <meta name="title" content="2、SparkCore核心编程（Spark）" />
    <meta property="og:title" content="2、SparkCore核心编程（Spark）" />
    <meta property="twitter:title" content="2、SparkCore核心编程（Spark）" />
    

    
    <meta name="description" content="">
    <meta property="og:description" content="" />
    <meta property="twitter:description" content="" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>2、SparkCore核心编程（Spark）-yiguan1573</title>

    <link rel="canonical" href="/post/942sparkcore%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B/">

    <link rel="stylesheet" href="/css/iDisqus.min.css"/>
	
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="/css/syntax.css">
    
    
    <link rel="stylesheet" href="/css/zanshang.css">
    
    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    
    

    
    
    <script src="/js/jquery.min.js"></script>
    
    
    <script src="/js/bootstrap.min.js"></script>
    
    
    <script src="/js/hux-blog.min.js"></script>

    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/docco.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
    

</head>



<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">亿观的博客</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">主页</a>
                    </li>
                    
                        
                        <li>
                            <a href="/categories/%E5%AD%A6%E4%B9%A0">学习</a>
                        </li>
                        
                    
                    
		    
                        <li><a href="/#">图书</a></li>
                    
                        <li><a href="/#">关于</a></li>
                    

                    
		    <li>
                        <a href="/search">搜索 <img src="/img/search.png" height="15" style="cursor: pointer;" alt="Search"></a>
		    </li>
                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('http://ww1.sinaimg.cn/large/006QQPIfly1gh0wuilf8mj31hc0u0kh8.jpg')
    }
</style>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/spark" title="Spark">
                            Spark
                        </a>
                        
                    </div>
                    <h1>2、SparkCore核心编程（Spark）</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by 
                        
                                 &#34;亿观&#34;
                         
                        on 
                        Friday, December 3, 2021
                        
                        
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                <header>
                    <h2></h2>
                </header>
                <nav id="TableOfContents">
  <ul>
    <li><a href="#rdd">RDD</a>
      <ul>
        <li><a href="#什么是rdd">什么是RDD</a></li>
        <li><a href="#核心属性">核心属性</a></li>
        <li><a href="#执行原理">执行原理</a></li>
        <li><a href="#基础编程">基础编程</a></li>
        <li><a href="#rdd算子介绍">RDD算子介绍</a></li>
        <li><a href="#rdd转换算子">RDD转换算子</a></li>
        <li><a href="#rdd行动算子">RDD行动算子</a></li>
        <li><a href="#序列化">序列化</a></li>
        <li><a href="#rdd依赖关系">RDD依赖关系</a></li>
        <li><a href="#rdd-持久化">RDD 持久化</a></li>
        <li><a href="#rdd分区器">RDD分区器</a></li>
        <li><a href="#rdd-文件读取与保存">RDD 文件读取与保存</a></li>
        <li><a href="#累加器">累加器</a></li>
        <li><a href="#广播变量">广播变量</a></li>
      </ul>
    </li>
    <li><a href="#工程化代码">工程化代码</a></li>
  </ul>
</nav>
                
                <ul>
<li>Spark 计算框架为了能够进行高并发和高吞吐的数据处理，封装了三大数据结构，用于处理不同的应用场景。三大数据结构分别是：
<ul>
<li>RDD : 弹性分布式数据集</li>
<li>累加器：分布式共享只写变量</li>
<li>广播变量：分布式共享只读变量</li>
</ul>
</li>
</ul>
<h2 id="rdd">RDD</h2>
<h3 id="什么是rdd">什么是RDD</h3>
<ul>
<li>
<p>RDD（Resilient Distributed Dataset）叫做弹性分布式数据集，是 Spark 中最基本的数据处理模型。代码中是一个抽象类，它代表一个弹性的、不可变、可分区、里面的元素可并行计算的集合。</p>
</li>
<li>
<p>弹性</p>
<ul>
<li>
<p>存储的弹性：内存与磁盘的自动切换；</p>
</li>
<li>
<p>容错的弹性：数据丢失可以自动恢复；</p>
</li>
<li>
<p>计算的弹性：计算出错重试机制；</p>
</li>
<li>
<p>分片的弹性：可根据需要重新分片。</p>
</li>
</ul>
</li>
<li>
<p>分布式：数据存储在大数据集群不同节点上</p>
</li>
<li>
<p>数据集：RDD 封装了计算逻辑，并不保存数据</p>
</li>
<li>
<p>数据抽象：RDD 是一个抽象类，需要子类具体实现</p>
</li>
<li>
<p>不可变：RDD 封装了计算逻辑，是不可以改变的，想要改变，只能产生新的RDD，在新的RDD 里面封装计算逻辑</p>
</li>
<li>
<p>可分区、并行计算</p>
</li>
</ul>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gx4en266i1j30x60inann.jpg" alt="QQ截图20211206204748.png"></p>
<h3 id="核心属性">核心属性</h3>
<ul>
<li>
<p>分区列表</p>
<p>RDD 数据结构中存在分区列表，用于执行任务时并行计算，是实现分布式计算的重要属性。</p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gx6o2p9nkyj30nv05uwhq.jpg" alt="QQ截图20211208194902.png"></p>
</li>
<li>
<p>分区计算函数</p>
<p>Spark 在计算时，是使用分区函数对每一个分区进行计算</p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gx6o2x3u6lj30ng03y3zk.jpg" alt="QQ截图20211208194914.png"></p>
</li>
<li>
<p>RDD 之间的依赖关系</p>
<p>RDD 是计算模型的封装，当需求中需要将多个计算模型进行组合时，就需要将多个 RDD 建立依赖关系</p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gx6o3487vkj30mi03d3zu.jpg" alt="QQ截图20211208194925.png"></p>
</li>
<li>
<p>分区器（可选）</p>
<p>当数据为 KV 类型数据时，可以通过设定分区器自定义数据的分区</p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gx6o49qjcij30kr01ndgq.jpg" alt="QQ截图20211208195059.png"></p>
</li>
<li>
<p>首选位置（可选）</p>
<p>计算数据时，可以根据计算节点的状态选择不同的节点位置进行计算</p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gx6o4pcxyij30kg02s3zf.jpg" alt="QQ截图20211208195144.png"></p>
</li>
</ul>
<h3 id="执行原理"><strong>执行原理</strong></h3>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gx6o5w4km9j30qu0wx4au.jpg" alt="QQ截图20211208195241.png"></p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gx6o68zbqtj30qt0o5k07.jpg" alt="QQ截图20211208195253.png"></p>
<h3 id="基础编程">基础编程</h3>
<h4 id="rdd创建">RDD创建</h4>
<ul>
<li>
<p><strong>从集合（内存）中创建RDD</strong></p>
<ul>
<li>
<p>从集合中创建 RDD，Spark 主要提供了两个方法：parallelize 和 makeRDD</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> sparkConf <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setMaster<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;local[*]&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setAppName<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;spark&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> sparkContext <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">(</span>sparkConf<span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> rdd1 <span style="color:#66d9ef">=</span> sparkContext<span style="color:#f92672">.</span>parallelize<span style="color:#f92672">(</span>
   <span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span>
<span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> rdd2 <span style="color:#66d9ef">=</span> sparkContext<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span>
   <span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span>
<span style="color:#f92672">)</span>
rdd1<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
rdd2<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
sparkContext<span style="color:#f92672">.</span>stop<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
</code></pre></div></li>
<li>
<p>从底层代码实现来讲，makeRDD 方法其实就是 parallelize 方法</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> makeRDD<span style="color:#f92672">[</span><span style="color:#66d9ef">T</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ClassTag</span><span style="color:#f92672">]</span><span style="color:#f92672">(</span>
 seq<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Seq</span><span style="color:#f92672">[</span><span style="color:#66d9ef">T</span><span style="color:#f92672">]</span><span style="color:#f92672">,</span>
 numSlices<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span> <span style="color:#f92672">=</span> defaultParallelism<span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">T</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> withScope <span style="color:#f92672">{</span>
 parallelize<span style="color:#f92672">(</span>seq<span style="color:#f92672">,</span> numSlices<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>从外部存储（文件）创建RDD</strong></p>
<ul>
<li>
<p>由外部存储系统的数据集创建 RDD 包括：本地的文件系统，所有 Hadoop 支持的数据集，比如 HDFS、HBase 等。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> sparkConf <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setMaster<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;local[*]&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setAppName<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;spark&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> sparkContext <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">(</span>sparkConf<span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> fileRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> sparkContext<span style="color:#f92672">.</span>textFile<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;input&#34;</span><span style="color:#f92672">)</span>
fileRDD<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
sparkContext<span style="color:#f92672">.</span>stop<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
</code></pre></div><p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gx6pg00donj31br0rrqgg.jpg" alt="QQ截图20211208202647.png"></p>
</li>
<li>
<p>获取数据来源的文件</p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gx6pgayp4wj320x0x61kx.jpg" alt="QQ截图20211208203023.png"></p>
</li>
</ul>
</li>
<li>
<p><strong>从其他 RDD创建</strong></p>
<ul>
<li>主要是通过一个 RDD 运算完后，再产生新的 RDD。详情请参考后续章节</li>
</ul>
</li>
<li>
<p><strong>直接创建RDD（new）</strong></p>
<ul>
<li>使用 new 的方式直接构造 RDD，一般由 Spark 框架自身使用。</li>
</ul>
</li>
</ul>
<h4 id="rdd并行度与分区"><strong>RDD并行度与分区</strong></h4>
<ul>
<li>默认情况下，Spark 可以将一个作业切分多个任务后，发送给 Executor 节点并行计算，而能够并行计算的任务数量我们称之为并行度。这个数量可以在构建RDD 时指定。</li>
<li>读取内存数据时，数据可以按照并行度的设定进行数据的分区操作</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">package</span> com.atguigu.bigdata.spark.core.rdd.builder

<span style="color:#66d9ef">import</span> org.apache.spark.rdd.RDD
<span style="color:#66d9ef">import</span> org.apache.spark.<span style="color:#f92672">{</span><span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">}</span>

<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Spark01_RDD_Memory_Par</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">def</span> main<span style="color:#f92672">(</span>args<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Array</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>

        <span style="color:#75715e">// TODO 准备环境
</span><span style="color:#75715e"></span>        
        <span style="color:#66d9ef">val</span> sparkConf <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setMaster<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;local[*]&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setAppName<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;RDD&#34;</span><span style="color:#f92672">)</span>
        sparkConf<span style="color:#f92672">.</span>set<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;spark.default.parallelism&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;5&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> sc <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">(</span>sparkConf<span style="color:#f92672">)</span>

        <span style="color:#75715e">// TODO 创建RDD
</span><span style="color:#75715e"></span>        
        <span style="color:#75715e">// RDD的并行度 &amp; 分区
</span><span style="color:#75715e"></span>        
        <span style="color:#75715e">// makeRDD方法可以传递第二个参数，这个参数表示分区的数量
</span><span style="color:#75715e"></span>        
        <span style="color:#75715e">// 第二个参数可以不传递的，那么makeRDD方法会使用默认值 ： defaultParallelism（默认并行度）
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//     scheduler.conf.getInt(&#34;spark.default.parallelism&#34;, totalCores)
</span><span style="color:#75715e"></span>        
        <span style="color:#75715e">//    spark在默认情况下，从配置对象中获取配置参数：spark.default.parallelism
</span><span style="color:#75715e"></span>        
        <span style="color:#75715e">//    如果获取不到，那么使用totalCores属性，这个属性取值为当前运行环境的最大可用核数
</span><span style="color:#75715e"></span>        
        <span style="color:#75715e">//val rdd = sc.makeRDD(List(1,2,3,4),2)
</span><span style="color:#75715e"></span>        
        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>

        <span style="color:#75715e">// 将处理的数据保存成分区文件
</span><span style="color:#75715e"></span>        
        rdd<span style="color:#f92672">.</span>saveAsTextFile<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;output&#34;</span><span style="color:#f92672">)</span>

        <span style="color:#75715e">// TODO 关闭环境
</span><span style="color:#75715e"></span>        
        sc<span style="color:#f92672">.</span>stop<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p><img src="C:%5CUsers%5C%E5%87%8C%E6%97%BA%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20211209145705561.png" alt="image-20211209145705561"></p>
<ul>
<li>
<p>读取文件数据时，数据是按照Hadoop 文件读取的规则进行切片分区，而切片规则和数据读取的规则有些差异</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#75715e">//minPartitions :最小分区数量
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">//math. min (defaul tParallelism, 2)
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">//默认使用hadoop的分区策略，7/2=3(byte)...1  1/3&gt;0.1  新增一个分区
</span><span style="color:#75715e"></span>  
<span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>textFile<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;datas/1.txt&#34;</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
<span style="color:#75715e">// 将处理的数据保存成分区文件
</span><span style="color:#75715e"></span>  
rdd<span style="color:#f92672">.</span>saveAsTextFile<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;output&#34;</span><span style="color:#f92672">)</span>
</code></pre></div></li>
<li>
<p>数据分区的分配</p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gx7ly5eemgj31c30hu0zt.jpg" alt="QQ截图20211209152108.png"></p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gx7lyq8s2oj31900lvwkw.jpg" alt="QQ截图20211209152123.png"></p>
</li>
</ul>
<h3 id="rdd算子介绍">RDD算子介绍</h3>
<ul>
<li>RDD算子简介</li>
</ul>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gx7mco31qpj31bl0nv7dx.jpg" alt="QQ截图20211209153456.png"></p>
<ul>
<li>RDD 根据数据处理方式的不同将算子整体上分为Value 类型、双 Value 类型和Key-Value类型</li>
</ul>
<h3 id="rdd转换算子">RDD转换算子</h3>
<h4 id="value类型"><strong>Value类型</strong></h4>
<ul>
<li>
<p><strong>map</strong></p>
<ul>
<li>
<p><code>def map[U: ClassTag](f: T =&gt; U): RDD[U]</code></p>
</li>
<li>
<p>将处理的数据逐条进行映射转换，这里的转换可以是类型的转换，也可以是值的转换。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> dataRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> sparkContext<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> dataRDD1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> dataRDD<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span>
    num <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
    num <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>
    <span style="color:#f92672">}</span> 
 <span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> dataRDD2<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> dataRDD1<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span>
    num <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">+</span> num
    <span style="color:#f92672">}</span>
<span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> dataRDD3<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> dataRDD<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">*</span><span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
</code></pre></div></li>
<li>
<p>并行演示</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">package</span> com.atguigu.bigdata.spark.core.rdd.operator.transform
    
<span style="color:#66d9ef">import</span> org.apache.spark.rdd.RDD
<span style="color:#66d9ef">import</span> org.apache.spark.<span style="color:#f92672">{</span><span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">}</span>
    
<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Spark01_RDD_Operator_Transform_Par</span> <span style="color:#f92672">{</span>
    
    <span style="color:#66d9ef">def</span> main<span style="color:#f92672">(</span>args<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Array</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
    
        <span style="color:#66d9ef">val</span> sparkConf <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setMaster<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;local[*]&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setAppName<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Operator&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> sc <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">(</span>sparkConf<span style="color:#f92672">)</span>
    
        <span style="color:#75715e">// TODO 算子 - map
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">// 1. rdd的计算一个分区内的数据是一个一个执行逻辑
</span><span style="color:#75715e"></span>            
        <span style="color:#75715e">//    只有前面一个数据全部的逻辑执行完毕后，才会执行下一个数据。
</span><span style="color:#75715e"></span>            
        <span style="color:#75715e">//    分区内数据的执行是有序的。
</span><span style="color:#75715e"></span>            
        <span style="color:#75715e">// 2. 不同分区数据计算是无序的。
</span><span style="color:#75715e"></span>            
        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
    
        <span style="color:#66d9ef">val</span> mapRDD <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span>
            num <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
                println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &#34;</span> <span style="color:#f92672">+</span> num<span style="color:#f92672">)</span>
                num
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> mapRDD1 <span style="color:#66d9ef">=</span> mapRDD<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span>
            num <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
                println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;######&#34;</span> <span style="color:#f92672">+</span> num<span style="color:#f92672">)</span>
                num
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">)</span>
    
        mapRDD1<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    
        sc<span style="color:#f92672">.</span>stop<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gx7mxiuq6fj30vd0fg788.jpg" alt="QQ截图20211209155546.png"></p>
</li>
</ul>
</li>
<li>
<p><strong>mapPartitions</strong></p>
<ul>
<li>
<p><code>def mapPartitions[U: ClassTag](f: Iterator[T] =&gt; Iterator[U],preservesPartitioning: Boolean = false): RDD[U]</code></p>
</li>
<li>
<p>将待处理的数据以分区为单位发送到计算节点进行处理，这里的处理是指可以进行任意的处理，哪怕是过滤数据。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">package</span> com.atguigu.bigdata.spark.core.rdd.operator.transform
    
<span style="color:#66d9ef">import</span> org.apache.spark.rdd.RDD
<span style="color:#66d9ef">import</span> org.apache.spark.<span style="color:#f92672">{</span><span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">}</span>
    
<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Spark02_RDD_Operator_Transform</span> <span style="color:#f92672">{</span>
    
    <span style="color:#66d9ef">def</span> main<span style="color:#f92672">(</span>args<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Array</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
    
        <span style="color:#66d9ef">val</span> sparkConf <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setMaster<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;local[*]&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setAppName<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Operator&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> sc <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">(</span>sparkConf<span style="color:#f92672">)</span>
    
        <span style="color:#75715e">// TODO 算子 - mapPartitions
</span><span style="color:#75715e"></span>            
        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
    
        <span style="color:#75715e">// mapPartitions : 可以以分区为单位进行数据转换操作
</span><span style="color:#75715e"></span>            
        <span style="color:#75715e">//                 但是会将整个分区的数据加载到内存进行引用
</span><span style="color:#75715e"></span>            
        <span style="color:#75715e">//                 如果处理完的数据是不会被释放掉，存在对象的引用。
</span><span style="color:#75715e"></span>            
        <span style="color:#75715e">//                 在内存较小，数据量较大的场合下，容易出现内存溢出。
</span><span style="color:#75715e"></span>            
        <span style="color:#66d9ef">val</span> mpRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>mapPartitions<span style="color:#f92672">(</span>
            iter <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
                println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#34;</span><span style="color:#f92672">)</span>
                iter<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">)</span>
        mpRDD<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
    
        sc<span style="color:#f92672">.</span>stop<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
    
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>map 和 mapPartitions 的区别</strong></p>
<ul>
<li>数据处理角度：Map 算子是分区内一个数据一个数据的执行，类似于串行操作。而 mapPartitions 算子是以分区为单位进行批处理操作。</li>
<li>功能的角度：Map 算子主要目的将数据源中的数据进行转换和改变。但是不会减少或增多数据。MapPartitions 算子需要传递一个迭代器，返回一个迭代器，没有要求的元素的个数保持不变，所以可以增加或减少数据</li>
<li>性能的角度：Map 算子因为类似于串行操作，所以性能比较低，而是 mapPartitions 算子类似于批处理，所以性能较高。但是 mapPartitions 算子会长时间占用内存，那么这样会导致内存可能不够用，出现内存溢出的错误。所以在内存有限的情况下，不推荐使用。使用 map 操作。</li>
</ul>
</li>
<li>
<p><strong>mapPartitionsWithIndex</strong></p>
<ul>
<li>
<p><code>def mapPartitionsWithIndex[U: ClassTag](f: (Int, Iterator[T]) =&gt; Iterator[U],preservesPartitioning: Boolean = false): RDD[U]</code></p>
</li>
<li>
<p>将待处理的数据以分区为单位发送到计算节点进行处理，这里的处理是指可以进行任意的处理，哪怕是过滤数据，在处理时同时可以获取当前分区索引。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> dataRDD1 <span style="color:#66d9ef">=</span> dataRDD<span style="color:#f92672">.</span>mapPartitionsWithIndex<span style="color:#f92672">(</span>
   <span style="color:#f92672">(</span>index<span style="color:#f92672">,</span> datas<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
      datas<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span>index<span style="color:#f92672">,</span> <span style="color:#66d9ef">_</span><span style="color:#f92672">)</span>
   <span style="color:#f92672">}</span> 
<span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>flatMap</strong></p>
<ul>
<li>
<p><code>def flatMap[U: ClassTag](f: T =&gt; TraversableOnce[U]): RDD[U]</code></p>
</li>
<li>
<p>将处理的数据进行扁平化后再进行映射处理，所以算子也称之为扁平映射</p>
</li>
<li>
<p>案例1</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> dataRDD <span style="color:#66d9ef">=</span> sparkContext<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span>
   <span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span>
<span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#ae81ff">1</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> dataRDD1 <span style="color:#66d9ef">=</span> dataRDD<span style="color:#f92672">.</span>flatMap<span style="color:#f92672">(</span>
   list <span style="color:#66d9ef">=&gt;</span> list
<span style="color:#f92672">)</span>
</code></pre></div></li>
<li>
<p>案例2</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">package</span> com.atguigu.bigdata.spark.core.rdd.operator.transform
    
<span style="color:#66d9ef">import</span> org.apache.spark.rdd.RDD
<span style="color:#66d9ef">import</span> org.apache.spark.<span style="color:#f92672">{</span><span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">}</span>
    
<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Spark04_RDD_Operator_Transform2</span> <span style="color:#f92672">{</span>
    
    <span style="color:#66d9ef">def</span> main<span style="color:#f92672">(</span>args<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Array</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
    
        <span style="color:#66d9ef">val</span> sparkConf <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setMaster<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;local[*]&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setAppName<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Operator&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> sc <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">(</span>sparkConf<span style="color:#f92672">)</span>
    
        <span style="color:#75715e">// TODO 算子 - flatMap
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">4</span><span style="color:#f92672">,</span><span style="color:#ae81ff">5</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
    
        <span style="color:#66d9ef">val</span> flatRDD <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>flatMap<span style="color:#f92672">(</span>
            data <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
                data <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">case</span> list<span style="color:#66d9ef">:</span><span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">_</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=&gt;</span> list
                    <span style="color:#66d9ef">case</span> dat <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">List</span><span style="color:#f92672">(</span>dat<span style="color:#f92672">)</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">)</span>
    
        flatRDD<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
    
        sc<span style="color:#f92672">.</span>stop<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>glom</strong></p>
<ul>
<li>
<p><code>def glom(): RDD[Array[T]]</code></p>
</li>
<li>
<p>将同一个分区的数据直接转换为相同类型的内存数组进行处理，分区不变</p>
</li>
<li>
<p>案例1</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">import</span> org.apache.spark.rdd.RDD
<span style="color:#66d9ef">import</span> org.apache.spark.<span style="color:#f92672">{</span><span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">}</span>
    
<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Spark05_RDD_Operator_Transform</span> <span style="color:#f92672">{</span>
    
    <span style="color:#66d9ef">def</span> main<span style="color:#f92672">(</span>args<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Array</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
    
        <span style="color:#66d9ef">val</span> sparkConf <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setMaster<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;local[*]&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setAppName<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Operator&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> sc <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">(</span>sparkConf<span style="color:#f92672">)</span>
    
        <span style="color:#75715e">// TODO 算子 - glom
</span><span style="color:#75715e"></span>            
        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
    
        <span style="color:#75715e">// List =&gt; Int
</span><span style="color:#75715e"></span>            
        <span style="color:#75715e">// Int =&gt; Array
</span><span style="color:#75715e"></span>            
        <span style="color:#66d9ef">val</span> glomRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Array</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>glom<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    
        glomRDD<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>data<span style="color:#66d9ef">=&gt;</span> println<span style="color:#f92672">(</span>data<span style="color:#f92672">.</span>mkString<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;,&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
    
        sc<span style="color:#f92672">.</span>stop<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
结果<span style="color:#960050;background-color:#1e0010">：</span>
<span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#ae81ff">2</span>
<span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#ae81ff">4</span>
</code></pre></div></li>
<li>
<p>案例2</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">import</span> org.apache.spark.rdd.RDD
<span style="color:#66d9ef">import</span> org.apache.spark.<span style="color:#f92672">{</span><span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">}</span>
    
<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Spark05_RDD_Operator_Transform_Test</span> <span style="color:#f92672">{</span>
    
    <span style="color:#66d9ef">def</span> main<span style="color:#f92672">(</span>args<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Array</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
    
        <span style="color:#66d9ef">val</span> sparkConf <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setMaster<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;local[*]&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setAppName<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Operator&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> sc <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">(</span>sparkConf<span style="color:#f92672">)</span>
    
        <span style="color:#75715e">// TODO 算子 - glom
</span><span style="color:#75715e"></span>            
        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
    
        <span style="color:#75715e">// 【1，2】，【3，4】
</span><span style="color:#75715e"></span>    
        <span style="color:#66d9ef">val</span> glomRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Array</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>glom<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    
        <span style="color:#66d9ef">val</span> maxRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> glomRDD<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span>
            array <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
                array<span style="color:#f92672">.</span>max
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">)</span>
        println<span style="color:#f92672">(</span>maxRDD<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>sum<span style="color:#f92672">)</span>
    
        sc<span style="color:#f92672">.</span>stop<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>groupBy</strong></p>
<ul>
<li>
<p><code>def groupBy[K](f: T =&gt; K)(implicit kt: ClassTag[K]): RDD[(K, Iterable[T])]</code></p>
</li>
<li>
<p>将数据根据指定的规则进行分组, 分区默认不变，但是数据会被打乱重新组合，我们将这样的操作称之为 shuffle。极限情况下，数据可能被分在同一个分区中一个组的数据在一个分区中，但是并不是说一个分区中只有一个组</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">import</span> org.apache.spark.rdd.RDD
<span style="color:#66d9ef">import</span> org.apache.spark.<span style="color:#f92672">{</span><span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">}</span>
    
<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Spark06_RDD_Operator_Transform</span> <span style="color:#f92672">{</span>
    
    <span style="color:#66d9ef">def</span> main<span style="color:#f92672">(</span>args<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Array</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
    
        <span style="color:#66d9ef">val</span> sparkConf <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setMaster<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;local[*]&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setAppName<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Operator&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> sc <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">(</span>sparkConf<span style="color:#f92672">)</span>
    
        <span style="color:#75715e">// TODO 算子 - groupBy
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
    
        <span style="color:#75715e">// groupBy会将数据源中的每一个数据进行分组判断，根据返回的分组key进行分组
</span><span style="color:#75715e"></span>            
        <span style="color:#75715e">// 相同的key值的数据会放置在一个组中
</span><span style="color:#75715e"></span>            
        <span style="color:#66d9ef">def</span> groupFunction<span style="color:#f92672">(</span>num<span style="color:#66d9ef">:</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">{</span>
            num <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span>
        <span style="color:#f92672">}</span>
    
        <span style="color:#66d9ef">val</span> groupRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">Int</span>, <span style="color:#66d9ef">Iterable</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>groupBy<span style="color:#f92672">(</span>groupFunction<span style="color:#f92672">)</span>
    
        groupRDD<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
    
    
        sc<span style="color:#f92672">.</span>stop<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>filter</strong></p>
<ul>
<li>
<p><code>def filter(f: T =&gt; Boolean): RDD[T]</code></p>
</li>
<li>
<p>将数据根据指定的规则进行筛选过滤，符合规则的数据保留，不符合规则的数据丢弃。当数据进行筛选过滤后，分区不变，但是分区内的数据可能不均衡，生产环境下，可能会出现数据倾斜。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> dataRDD <span style="color:#66d9ef">=</span> sparkContext<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span>
   <span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span>
<span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#ae81ff">1</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> dataRDD1 <span style="color:#66d9ef">=</span> dataRDD<span style="color:#f92672">.</span>filter<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">%</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>sample</strong></p>
<ul>
<li>
<p><code>def sample(withReplacement: Boolean,fraction: Double,seed: Long = Utils.random.nextLong): RDD[T]</code></p>
</li>
<li>
<p>根据指定的规则从数据集中抽取数据</p>
</li>
<li>
<p>案例1</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> dataRDD <span style="color:#66d9ef">=</span> sparkContext<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span>
 <span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span>
<span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#ae81ff">1</span><span style="color:#f92672">)</span>
<span style="color:#75715e">// 抽取数据不放回（伯努利算法）
</span><span style="color:#75715e"></span>    
<span style="color:#75715e">// 伯努利算法：又叫 0、1 分布。例如扔硬币，要么正面，要么反面。
</span><span style="color:#75715e"></span>    
<span style="color:#75715e">// 具体实现：根据种子和随机算法算出一个数和第二个参数设置几率比较，小于第二个参数要，大于不要
</span><span style="color:#75715e"></span>    
<span style="color:#75715e">// 第一个参数：抽取的数据是否放回，false：不放回
</span><span style="color:#75715e"></span>    
<span style="color:#75715e">// 第二个参数：抽取的几率，范围在[0,1]之间,0：全不取；1：全取；
</span><span style="color:#75715e"></span>    
<span style="color:#75715e">// 第三个参数：随机数种子
</span><span style="color:#75715e"></span>    
<span style="color:#66d9ef">val</span> dataRDD1 <span style="color:#66d9ef">=</span> dataRDD<span style="color:#f92672">.</span>sample<span style="color:#f92672">(</span><span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">0.5</span><span style="color:#f92672">)</span>
<span style="color:#75715e">// 抽取数据放回（泊松算法）
</span><span style="color:#75715e"></span>    
<span style="color:#75715e">// 第一个参数：抽取的数据是否放回，true：放回；false：不放回
</span><span style="color:#75715e"></span>    
<span style="color:#75715e">// 第二个参数：重复数据的几率，范围大于等于 0.表示每一个元素被期望抽取到的次数
</span><span style="color:#75715e"></span>    
<span style="color:#75715e">// 第三个参数：随机数种子
</span><span style="color:#75715e"></span>    
<span style="color:#66d9ef">val</span> dataRDD2 <span style="color:#66d9ef">=</span> dataRDD<span style="color:#f92672">.</span>sample<span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
</code></pre></div></li>
<li>
<p>案例2</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">import</span> org.apache.spark.<span style="color:#f92672">{</span><span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">}</span>
    
<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Spark08_RDD_Operator_Transform</span> <span style="color:#f92672">{</span>
    
    <span style="color:#66d9ef">def</span> main<span style="color:#f92672">(</span>args<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Array</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
    
        <span style="color:#66d9ef">val</span> sparkConf <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setMaster<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;local[*]&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setAppName<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Operator&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> sc <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">(</span>sparkConf<span style="color:#f92672">)</span>
    
        <span style="color:#75715e">// TODO 算子 - filter
</span><span style="color:#75715e"></span>            
        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">,</span><span style="color:#ae81ff">5</span><span style="color:#f92672">,</span><span style="color:#ae81ff">6</span><span style="color:#f92672">,</span><span style="color:#ae81ff">7</span><span style="color:#f92672">,</span><span style="color:#ae81ff">8</span><span style="color:#f92672">,</span><span style="color:#ae81ff">9</span><span style="color:#f92672">,</span><span style="color:#ae81ff">10</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
    
        <span style="color:#75715e">// sample算子需要传递三个参数
</span><span style="color:#75715e"></span>            
        <span style="color:#75715e">// 1. 第一个参数表示，抽取数据后是否将数据返回 true（放回），false（丢弃）
</span><span style="color:#75715e"></span>            
        <span style="color:#75715e">// 2. 第二个参数表示，如果抽取不放回的场合：数据源中每条数据被抽取的概率，基准值的概念,如果抽取放回的场合：表示数据源中的每条数据被抽取的可能次数
</span><span style="color:#75715e"></span>            
        <span style="color:#75715e">// 3. 第三个参数表示，抽取数据时随机算法的种子,如果不传递第三个参数，那么使用的是当前系统时间
</span><span style="color:#75715e"></span>    
        println<span style="color:#f92672">(</span>rdd<span style="color:#f92672">.</span>sample<span style="color:#f92672">(</span>
            <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span>
            <span style="color:#ae81ff">2</span>
            <span style="color:#75715e">//1
</span><span style="color:#75715e"></span>        <span style="color:#f92672">)</span><span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>mkString<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;,&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
    
        sc<span style="color:#f92672">.</span>stop<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
<li>
<p><strong>作用：均衡分区，消除数据倾斜</strong></p>
</li>
</ul>
</li>
<li>
<p><strong>distinct</strong></p>
<ul>
<li>
<p><code>def distinct()(implicit ord: Ordering[T] = null): RDD[T]</code></p>
<p><code>def distinct(numPartitions: Int)(implicit ord: Ordering[T] = null): RDD[T]</code></p>
</li>
<li>
<p>将数据集中重复的数据去重</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> dataRDD <span style="color:#66d9ef">=</span> sparkContext<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span>
   <span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">,</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span>
<span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#ae81ff">1</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> dataRDD1 <span style="color:#66d9ef">=</span> dataRDD<span style="color:#f92672">.</span>distinct<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> dataRDD2 <span style="color:#66d9ef">=</span> dataRDD<span style="color:#f92672">.</span>distinct<span style="color:#f92672">(</span><span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
</code></pre></div></li>
<li>
<p>原理 <code>map(x =&gt; (x, null)).reduceByKey((x, _) =&gt; x, numPartitions).map(_._1)</code></p>
</li>
</ul>
</li>
<li>
<p><strong>coalesce</strong></p>
<ul>
<li>
<p><code>def coalesce(numPartitions: Int, shuffle: Boolean = false,partitionCoalescer: Option[PartitionCoalescer] = Option.empty) (implicit ord: Ordering[T] = null): RDD[T]</code></p>
</li>
<li>
<p>根据数据量缩减分区，用于大数据集过滤后，提高小数据集的执行效率，当 spark 程序中，存在过多的小任务的时候，可以通过 coalesce 方法，收缩合并分区，减少分区的个数，减小任务调度成本。也可以增加分区</p>
</li>
<li>
<p>案例1，减少分区</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">import</span> org.apache.spark.rdd.RDD
<span style="color:#66d9ef">import</span> org.apache.spark.<span style="color:#f92672">{</span><span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">}</span>
    
<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Spark10_RDD_Operator_Transform</span> <span style="color:#f92672">{</span>
    
    <span style="color:#66d9ef">def</span> main<span style="color:#f92672">(</span>args<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Array</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
    
        <span style="color:#66d9ef">val</span> sparkConf <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setMaster<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;local[*]&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setAppName<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Operator&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> sc <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">(</span>sparkConf<span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">,</span><span style="color:#ae81ff">5</span><span style="color:#f92672">,</span><span style="color:#ae81ff">6</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">)</span>
    
        <span style="color:#75715e">// coalesce方法默认情况下不会将分区的数据打乱重新组合
</span><span style="color:#75715e"></span>            
        <span style="color:#75715e">// 这种情况下的缩减分区可能会导致数据不均衡，出现数据倾斜
</span><span style="color:#75715e"></span>            
        <span style="color:#75715e">// 如果想要让数据均衡，可以进行shuffle处理
</span><span style="color:#75715e"></span>            
        <span style="color:#75715e">//val newRDD: RDD[Int] = rdd.coalesce(2)
</span><span style="color:#75715e"></span>            
        <span style="color:#66d9ef">val</span> newRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>coalesce<span style="color:#f92672">(</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
    
        newRDD<span style="color:#f92672">.</span>saveAsTextFile<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;output&#34;</span><span style="color:#f92672">)</span>
    
        sc<span style="color:#f92672">.</span>stop<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
<li>
<p>案例2，增加分区</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">import</span> org.apache.spark.rdd.RDD
<span style="color:#66d9ef">import</span> org.apache.spark.<span style="color:#f92672">{</span><span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">}</span>
    
<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Spark11_RDD_Operator_Transform</span> <span style="color:#f92672">{</span>
    
    <span style="color:#66d9ef">def</span> main<span style="color:#f92672">(</span>args<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Array</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
    
        <span style="color:#66d9ef">val</span> sparkConf <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setMaster<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;local[*]&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setAppName<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Operator&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> sc <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">(</span>sparkConf<span style="color:#f92672">)</span>
    
        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">,</span><span style="color:#ae81ff">5</span><span style="color:#f92672">,</span><span style="color:#ae81ff">6</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
    
        <span style="color:#75715e">// coalesce算子可以扩大分区的，但是如果不进行shuffle操作，是没有意义，不起作用。
</span><span style="color:#75715e"></span>            
        <span style="color:#75715e">// 所以如果想要实现扩大分区的效果，需要使用shuffle操作
</span><span style="color:#75715e"></span>            
        <span style="color:#75715e">// spark提供了一个简化的操作
</span><span style="color:#75715e"></span>            
        <span style="color:#75715e">// 缩减分区：coalesce，如果想要数据均衡，可以采用shuffle
</span><span style="color:#75715e"></span>            
        <span style="color:#75715e">// 扩大分区：repartition, 底层代码调用的就是coalesce，而且肯定采用shuffle
</span><span style="color:#75715e"></span>            
        <span style="color:#75715e">//val newRDD: RDD[Int] = rdd.coalesce(3, true)
</span><span style="color:#75715e"></span>            
        <span style="color:#66d9ef">val</span> newRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>repartition<span style="color:#f92672">(</span><span style="color:#ae81ff">3</span><span style="color:#f92672">)</span>
    
        newRDD<span style="color:#f92672">.</span>saveAsTextFile<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;output&#34;</span><span style="color:#f92672">)</span>
    
        sc<span style="color:#f92672">.</span>stop<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>sortBy</strong></p>
<ul>
<li>
<p><code>def sortBy[K](f: (T) =&gt; K, ascending: Boolean = true,numPartitions: Int = this.partitions.length)(implicit ord: Ordering[K], ctag: ClassTag[K]): RDD[T]</code></p>
</li>
<li>
<p>该操作用于排序数据。在排序之前，可以将数据通过 f 函数进行处理，之后按照 f 函数处理的结果进行排序，默认为升序排列。排序后新产生的 RDD 的分区数与原 RDD 的分区数一致。中间存在 shuffle 的过程</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#75715e">// TODO 算子 - sortBy
</span><span style="color:#75715e"></span>    
<span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;1&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;11&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;2&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
    
<span style="color:#75715e">// sortBy方法可以根据指定的规则对数据源中的数据进行排序，默认为升序，第二个参数可以改变排序的方式
</span><span style="color:#75715e"></span>    
<span style="color:#75715e">// sortBy默认情况下，不会改变分区。但是中间存在shuffle操作
</span><span style="color:#75715e"></span>    
<span style="color:#66d9ef">val</span> newRDD <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>sortBy<span style="color:#f92672">(</span>t<span style="color:#66d9ef">=&gt;</span>t<span style="color:#f92672">.</span>_1<span style="color:#f92672">.</span>toInt<span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>
    
newRDD<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
</li>
</ul>
<h4 id="双value类型">双Value类型</h4>
<ul>
<li>
<p><strong>intersection</strong></p>
<ul>
<li><code>def intersection(other: RDD[T]): RDD[T]</code></li>
<li>对源 RDD 和参数 RDD 求交集后返回一个新的 RDD</li>
</ul>
</li>
<li>
<p><strong>union</strong></p>
<ul>
<li><code>def union(other: RDD[T]): RDD[T]</code></li>
<li>对源 RDD 和参数 RDD 求并集后返回一个新的 RDD</li>
</ul>
</li>
<li>
<p><strong>subtract</strong></p>
<ul>
<li><code>def subtract(other: RDD[T]): RDD[T]</code></li>
<li>以一个 RDD 元素为主，去除两个 RDD 中重复元素，将其他元素保留下来。求差集</li>
</ul>
</li>
<li>
<p><strong>zip</strong></p>
<ul>
<li><code>def zip[U: ClassTag](other: RDD[U]): RDD[(T, U)]</code></li>
<li>将两个 RDD 中的元素，以键值对的形式进行合并。其中，键值对中的 Key 为第 1 个 RDD中的元素，Value 为第 2 个 RDD 中的相同位置的元素。</li>
</ul>
</li>
<li>
<p>案例1</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">        <span style="color:#75715e">// 交集，并集和差集要求两个数据源数据类型保持一致
</span><span style="color:#75715e"></span>  
        <span style="color:#75715e">// 拉链操作两个数据源的类型可以不一致
</span><span style="color:#75715e"></span>  
        <span style="color:#66d9ef">val</span> rdd1 <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> rdd2 <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">,</span><span style="color:#ae81ff">5</span><span style="color:#f92672">,</span><span style="color:#ae81ff">6</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> rdd7 <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;3&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;4&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;5&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;6&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
  
        <span style="color:#75715e">// 交集 : 【3，4】
</span><span style="color:#75715e"></span>  
        <span style="color:#66d9ef">val</span> rdd3<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd1<span style="color:#f92672">.</span>intersection<span style="color:#f92672">(</span>rdd2<span style="color:#f92672">)</span>
        <span style="color:#75715e">//val rdd8 = rdd1.intersection(rdd7)
</span><span style="color:#75715e"></span>  
        println<span style="color:#f92672">(</span>rdd3<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>mkString<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;,&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
  
        <span style="color:#75715e">// 并集 : 【1，2，3，4，3，4，5，6】
</span><span style="color:#75715e"></span>  
        <span style="color:#66d9ef">val</span> rdd4<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd1<span style="color:#f92672">.</span>union<span style="color:#f92672">(</span>rdd2<span style="color:#f92672">)</span>
        println<span style="color:#f92672">(</span>rdd4<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>mkString<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;,&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
  
        <span style="color:#75715e">// 差集 : 【1，2】
</span><span style="color:#75715e"></span>  
        <span style="color:#66d9ef">val</span> rdd5<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd1<span style="color:#f92672">.</span>subtract<span style="color:#f92672">(</span>rdd2<span style="color:#f92672">)</span>
        println<span style="color:#f92672">(</span>rdd5<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>mkString<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;,&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
  
        <span style="color:#75715e">// 拉链 : 【1-3，2-4，3-5，4-6】
</span><span style="color:#75715e"></span>  
        <span style="color:#66d9ef">val</span> rdd6<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">Int</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd1<span style="color:#f92672">.</span>zip<span style="color:#f92672">(</span>rdd2<span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> rdd8 <span style="color:#66d9ef">=</span> rdd1<span style="color:#f92672">.</span>zip<span style="color:#f92672">(</span>rdd7<span style="color:#f92672">)</span>
        println<span style="color:#f92672">(</span>rdd6<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>mkString<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;,&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
</code></pre></div></li>
<li>
<p>案例2</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">          <span style="color:#75715e">// 拉链操作两个数据源要求分区数量要保持一致
</span><span style="color:#75715e"></span>  
        <span style="color:#75715e">// 拉链操作两个数据源要求分区中数据数量保持一致
</span><span style="color:#75715e"></span>  
        <span style="color:#66d9ef">val</span> rdd1 <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">,</span><span style="color:#ae81ff">5</span><span style="color:#f92672">,</span><span style="color:#ae81ff">6</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> rdd2 <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">,</span><span style="color:#ae81ff">5</span><span style="color:#f92672">,</span><span style="color:#ae81ff">6</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
  
        <span style="color:#66d9ef">val</span> rdd6<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">Int</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd1<span style="color:#f92672">.</span>zip<span style="color:#f92672">(</span>rdd2<span style="color:#f92672">)</span>
        println<span style="color:#f92672">(</span>rdd6<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>mkString<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;,&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
<h4 id="key-value类型">Key-Value类型</h4>
<ul>
<li>
<p><strong>partitionBy</strong></p>
<ul>
<li>
<p><code>def partitionBy(partitioner: Partitioner): RDD[(K, V)]</code></p>
</li>
<li>
<p>将数据按照指定 Partitioner 重新进行分区。Spark 默认的分区器是 HashPartitioner</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">        <span style="color:#75715e">// TODO 算子 - (Key - Value类型)
</span><span style="color:#75715e"></span>    
        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
    
        <span style="color:#66d9ef">val</span> mapRDD<span style="color:#66d9ef">:</span><span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">Int</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span><span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#75715e">// RDD =&gt; PairRDDFunctions
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">// 隐式转换（二次编译）
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">// partitionBy根据指定的分区规则对数据进行重分区
</span><span style="color:#75715e"></span>    
        <span style="color:#66d9ef">val</span> newRDD <span style="color:#66d9ef">=</span> mapRDD<span style="color:#f92672">.</span>partitionBy<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">HashPartitioner</span><span style="color:#f92672">(</span><span style="color:#ae81ff">2</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        newRDD<span style="color:#f92672">.</span>partitionBy<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">HashPartitioner</span><span style="color:#f92672">(</span><span style="color:#ae81ff">2</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
    
        newRDD<span style="color:#f92672">.</span>saveAsTextFile<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;output&#34;</span><span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>reduceByKey</strong></p>
<ul>
<li>
<p><code>def reduceByKey(func: (V, V) =&gt; V): RDD[(K, V)]</code></p>
<p><code>def reduceByKey(func: (V, V) =&gt; V, numPartitions: Int): RDD[(K, V)]</code></p>
</li>
<li>
<p>可以将数据按照相同的 Key 对 Value 进行聚合</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span>
            <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;b&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">4</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">)</span><span style="color:#f92672">)</span>
    
        <span style="color:#75715e">// reduceByKey : 相同的key的数据进行value数据的聚合操作
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">// scala语言中一般的聚合操作都是两两聚合，spark基于scala开发的，所以它的聚合也是两两聚合
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// 【1，2，3】
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">// 【3，3】
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">// 【6】
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">// reduceByKey中如果key的数据只有一个，是不会参与运算的。
</span><span style="color:#75715e"></span>    
        <span style="color:#66d9ef">val</span> reduceRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>reduceByKey<span style="color:#f92672">(</span> <span style="color:#f92672">(</span>x<span style="color:#66d9ef">:</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">,</span> y<span style="color:#66d9ef">:</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
            println<span style="color:#f92672">(</span><span style="color:#e6db74">s&#34;</span><span style="color:#e6db74">x = </span><span style="color:#e6db74">${</span>x<span style="color:#e6db74">}</span><span style="color:#e6db74">, y = </span><span style="color:#e6db74">${</span>y<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">)</span>
            x <span style="color:#f92672">+</span> y
        <span style="color:#f92672">}</span> <span style="color:#f92672">)</span>
    
        reduceRDD<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>groupByKey</strong></p>
<ul>
<li>
<p><code>def groupByKey(): RDD[(K, Iterable[V])]</code></p>
<p><code>def groupByKey(numPartitions: Int): RDD[(K, Iterable[V])]</code></p>
<p><code>def groupByKey(partitioner: Partitioner): RDD[(K, Iterable[V])]</code></p>
</li>
<li>
<p>将数据源的数据根据 key 对 value 进行分组</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span>
            <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;b&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">4</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">)</span><span style="color:#f92672">)</span>
    
        <span style="color:#75715e">// groupByKey : 将数据源中的数据，相同key的数据分在一个组中，形成一个对偶元组
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">//              元组中的第一个元素就是key，
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">//              元组中的第二个元素就是相同key的value的集合
</span><span style="color:#75715e"></span>    
        <span style="color:#66d9ef">val</span> groupRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Iterable</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>groupByKey<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    
        groupRDD<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
    
        <span style="color:#66d9ef">val</span> groupRDD1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Iterable</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>groupBy<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>_1<span style="color:#f92672">)</span>
</code></pre></div></li>
<li>
<p>reduceByKey 和 groupByKey 的区别</p>
<ul>
<li>
<p><strong>从</strong> <strong>shuffle</strong> <strong>的角度</strong>：reduceByKey 和 groupByKey 都存在 shuffle 的操作，但是 reduceByKey可以在 shuffle 前对分区内相同 key 的数据进行预聚合（combine）功能，这样会减少落盘的数据量，而 groupByKey 只是进行分组，不存在数据量减少的问题，reduceByKey 性能比较高。</p>
</li>
<li>
<p><strong>从功能的角度</strong>：reduceByKey 其实包含分组和聚合的功能。GroupByKey 只能分组，不能聚合，所以在分组聚合的场合下，推荐使用 reduceByKey，如果仅仅是分组而不需要聚合。那么还是只能使用 groupByKey</p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gx8vol1iwoj318y0qrni4.jpg" alt="QQ截图20211210173157.png"></p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gx8vtuzgwtj319s0lptpo.jpg" alt="QQ截图20211210174916.png"></p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>aggregateByKey</strong></p>
<ul>
<li>
<p><code>def aggregateByKey[U: ClassTag](zeroValue: U)(seqOp: (U, V) =&gt; U, combOp: (U, U) =&gt; U): RDD[(K, U)]</code></p>
</li>
<li>
<p>将数据根据不同的规则进行分区内计算和分区间计算</p>
</li>
<li>
<p>案例1</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span>
            <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">4</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
        <span style="color:#75715e">// (a,【1,2】), (a, 【3，4】)
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">// (a, 2), (a, 4)
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">// (a, 6)
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">// aggregateByKey存在函数柯里化，有两个参数列表
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">// 第一个参数列表,需要传递一个参数，表示为初始值
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">//       主要用于当碰见第一个key的时候，和value进行分区内计算
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">// 第二个参数列表需要传递2个参数
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">//      第一个参数表示分区内计算规则
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">//      第二个参数表示分区间计算规则
</span><span style="color:#75715e"></span>    
        rdd<span style="color:#f92672">.</span>aggregateByKey<span style="color:#f92672">(</span><span style="color:#ae81ff">0</span><span style="color:#f92672">)</span><span style="color:#f92672">(</span>
            <span style="color:#f92672">(</span>x<span style="color:#f92672">,</span> y<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> math<span style="color:#f92672">.</span>max<span style="color:#f92672">(</span>x<span style="color:#f92672">,</span> y<span style="color:#f92672">)</span><span style="color:#f92672">,</span>
            <span style="color:#f92672">(</span>x<span style="color:#f92672">,</span> y<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> x <span style="color:#f92672">+</span> y
        <span style="color:#f92672">)</span><span style="color:#f92672">.</span>collect<span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
</code></pre></div></li>
<li>
<p>案例2(算平均值)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span>
            <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;b&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span>
            <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;b&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;b&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">5</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">6</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
    
        <span style="color:#75715e">// aggregateByKey最终的返回数据结果应该和初始值的类型保持一致
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">//val aggRDD: RDD[(String, String)] = rdd.aggregateByKey(&#34;&#34;)(_ + _, _ + _)
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">//aggRDD.collect.foreach(println)
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">// 获取相同key的数据的平均值 =&gt; (a, 3),(b, 4)
</span><span style="color:#75715e"></span>    
        <span style="color:#66d9ef">val</span> newRDD <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#f92672">(</span><span style="color:#66d9ef">Int</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>aggregateByKey<span style="color:#f92672">(</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span><span style="color:#f92672">,</span><span style="color:#ae81ff">0</span><span style="color:#f92672">)</span> <span style="color:#f92672">)</span><span style="color:#f92672">(</span>
            <span style="color:#f92672">(</span> t<span style="color:#f92672">,</span> v <span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
                <span style="color:#f92672">(</span>t<span style="color:#f92672">.</span>_1 <span style="color:#f92672">+</span> v<span style="color:#f92672">,</span> t<span style="color:#f92672">.</span>_2 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">)</span>
            <span style="color:#f92672">}</span><span style="color:#f92672">,</span>
            <span style="color:#f92672">(</span>t1<span style="color:#f92672">,</span> t2<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
                <span style="color:#f92672">(</span>t1<span style="color:#f92672">.</span>_1 <span style="color:#f92672">+</span> t2<span style="color:#f92672">.</span>_1<span style="color:#f92672">,</span> t1<span style="color:#f92672">.</span>_2 <span style="color:#f92672">+</span> t2<span style="color:#f92672">.</span>_2<span style="color:#f92672">)</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">)</span>
    
        <span style="color:#66d9ef">val</span> resultRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> newRDD<span style="color:#f92672">.</span>mapValues <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">case</span> <span style="color:#f92672">(</span>num<span style="color:#f92672">,</span> cnt<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
                num <span style="color:#f92672">/</span> cnt
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        resultRDD<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>foldByKey</strong></p>
<ul>
<li>
<p><code>def foldByKey(zeroValue: V)(func: (V, V) =&gt; V): RDD[(K, V)]</code></p>
</li>
<li>
<p>当分区内计算规则和分区间计算规则相同时，aggregateByKey 就可以简化为foldByKey</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#75715e">// 如果聚合计算时，分区内和分区间计算规则相同，spark提供了简化的方法
</span><span style="color:#75715e"></span>    
rdd<span style="color:#f92672">.</span>foldByKey<span style="color:#f92672">(</span><span style="color:#ae81ff">0</span><span style="color:#f92672">)</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">+</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>collect<span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>combineByKey</strong></p>
<ul>
<li>
<p><code>def combineByKey[C]( createCombiner: V =&gt; C, mergeValue: (C, V) =&gt; C,mergeCombiners: (C, C) =&gt; C): RDD[(K, C)]</code></p>
</li>
<li>
<p>最通用的对key-value 型 rdd 进行聚集操作的聚集函数（aggregation function）。类似于aggregate()，combineByKey()允许用户返回值的类型与输入不一致。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span>
            <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;b&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span>
            <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;b&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;b&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">5</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">6</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
    
        <span style="color:#75715e">// combineByKey : 方法需要三个参数
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">// 第一个参数表示：将相同key的第一个数据进行结构的转换，实现操作
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">// 第二个参数表示：分区内的计算规则
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">// 第三个参数表示：分区间的计算规则
</span><span style="color:#75715e"></span>    
        <span style="color:#66d9ef">val</span> newRDD <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#f92672">(</span><span style="color:#66d9ef">Int</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>combineByKey<span style="color:#f92672">(</span>
            v <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">(</span>v<span style="color:#f92672">,</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span>
            <span style="color:#f92672">(</span> t<span style="color:#66d9ef">:</span><span style="color:#f92672">(</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> v <span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
                <span style="color:#f92672">(</span>t<span style="color:#f92672">.</span>_1 <span style="color:#f92672">+</span> v<span style="color:#f92672">,</span> t<span style="color:#f92672">.</span>_2 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">)</span>
            <span style="color:#f92672">}</span><span style="color:#f92672">,</span>
            <span style="color:#f92672">(</span>t1<span style="color:#66d9ef">:</span><span style="color:#f92672">(</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> t2<span style="color:#66d9ef">:</span><span style="color:#f92672">(</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
                <span style="color:#f92672">(</span>t1<span style="color:#f92672">.</span>_1 <span style="color:#f92672">+</span> t2<span style="color:#f92672">.</span>_1<span style="color:#f92672">,</span> t1<span style="color:#f92672">.</span>_2 <span style="color:#f92672">+</span> t2<span style="color:#f92672">.</span>_2<span style="color:#f92672">)</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">)</span>
    
        <span style="color:#66d9ef">val</span> resultRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> newRDD<span style="color:#f92672">.</span>mapValues <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">case</span> <span style="color:#f92672">(</span>num<span style="color:#f92672">,</span> cnt<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
                num <span style="color:#f92672">/</span> cnt
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        resultRDD<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
</code></pre></div></li>
<li>
<p>区别</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span>
            <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;b&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span>
            <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;b&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;b&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">5</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">6</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
    
        <span style="color:#75715e">/*</span><span style="color:#75715e">
</span><span style="color:#75715e">        reduceByKey:
</span><span style="color:#75715e">    
</span><span style="color:#75715e">             combineByKeyWithClassTag[V](
</span><span style="color:#75715e">                 (v: V) =&gt; v, </span><span style="color:#75715e">/</span><span style="color:#75715e">/</span><span style="color:#75715e"> 第一个值不会参与计算
</span><span style="color:#75715e">                 func, </span><span style="color:#75715e">/</span><span style="color:#75715e">/</span><span style="color:#75715e"> 分区内计算规则
</span><span style="color:#75715e">                 func, </span><span style="color:#75715e">/</span><span style="color:#75715e">/</span><span style="color:#75715e"> 分区间计算规则
</span><span style="color:#75715e">                 )
</span><span style="color:#75715e">    
</span><span style="color:#75715e">        aggregateByKey :
</span><span style="color:#75715e">    
</span><span style="color:#75715e">            combineByKeyWithClassTag[U](
</span><span style="color:#75715e">                (v: V) =&gt; cleanedSeqOp(createZero(), v), </span><span style="color:#75715e">/</span><span style="color:#75715e">/</span><span style="color:#75715e"> 初始值和第一个key的value值进行的分区内数据操作
</span><span style="color:#75715e">                cleanedSeqOp, </span><span style="color:#75715e">/</span><span style="color:#75715e">/</span><span style="color:#75715e"> 分区内计算规则
</span><span style="color:#75715e">                combOp,       </span><span style="color:#75715e">/</span><span style="color:#75715e">/</span><span style="color:#75715e"> 分区间计算规则
</span><span style="color:#75715e">                )
</span><span style="color:#75715e">    
</span><span style="color:#75715e">        foldByKey:
</span><span style="color:#75715e">    
</span><span style="color:#75715e">            combineByKeyWithClassTag[V](
</span><span style="color:#75715e">                (v: V) =&gt; cleanedFunc(createZero(), v), </span><span style="color:#75715e">/</span><span style="color:#75715e">/</span><span style="color:#75715e"> 初始值和第一个key的value值进行的分区内数据操作
</span><span style="color:#75715e">                cleanedFunc,  </span><span style="color:#75715e">/</span><span style="color:#75715e">/</span><span style="color:#75715e"> 分区内计算规则
</span><span style="color:#75715e">                cleanedFunc,  </span><span style="color:#75715e">/</span><span style="color:#75715e">/</span><span style="color:#75715e"> 分区间计算规则
</span><span style="color:#75715e">                )
</span><span style="color:#75715e">    
</span><span style="color:#75715e">        combineByKey :
</span><span style="color:#75715e">    
</span><span style="color:#75715e">            combineByKeyWithClassTag(
</span><span style="color:#75715e">                createCombiner,  </span><span style="color:#75715e">/</span><span style="color:#75715e">/</span><span style="color:#75715e"> 相同key的第一条数据进行的处理函数
</span><span style="color:#75715e">                mergeValue,      </span><span style="color:#75715e">/</span><span style="color:#75715e">/</span><span style="color:#75715e"> 表示分区内数据的处理函数
</span><span style="color:#75715e">                mergeCombiners,  </span><span style="color:#75715e">/</span><span style="color:#75715e">/</span><span style="color:#75715e"> 表示分区间数据的处理函数
</span><span style="color:#75715e">                )
</span><span style="color:#75715e">    
</span><span style="color:#75715e">         </span><span style="color:#75715e">*/</span>
    
    
        rdd<span style="color:#f92672">.</span>reduceByKey<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">+</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span> <span style="color:#75715e">// wordcount
</span><span style="color:#75715e"></span>        rdd<span style="color:#f92672">.</span>aggregateByKey<span style="color:#f92672">(</span><span style="color:#ae81ff">0</span><span style="color:#f92672">)</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">+</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">_</span><span style="color:#f92672">+</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span> <span style="color:#75715e">// wordcount
</span><span style="color:#75715e"></span>        rdd<span style="color:#f92672">.</span>foldByKey<span style="color:#f92672">(</span><span style="color:#ae81ff">0</span><span style="color:#f92672">)</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">+</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span> <span style="color:#75715e">// wordcount
</span><span style="color:#75715e"></span>        rdd<span style="color:#f92672">.</span>combineByKey<span style="color:#f92672">(</span>v<span style="color:#66d9ef">=&gt;</span>v<span style="color:#f92672">,</span><span style="color:#f92672">(</span>x<span style="color:#66d9ef">:</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">,</span>y<span style="color:#f92672">)</span><span style="color:#66d9ef">=&gt;</span>x<span style="color:#f92672">+</span>y<span style="color:#f92672">,</span><span style="color:#f92672">(</span>x<span style="color:#66d9ef">:</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">,</span>y<span style="color:#66d9ef">:</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#66d9ef">=&gt;</span>x<span style="color:#f92672">+</span>y<span style="color:#f92672">)</span> <span style="color:#75715e">// wordcount
</span></code></pre></div></li>
</ul>
</li>
<li>
<p><strong>sortByKey</strong></p>
<ul>
<li>
<p><code>def sortByKey(ascending: Boolean = true, numPartitions: Int = self.partitions.length): RDD[(K, V)]</code></p>
</li>
<li>
<p>在一个(K,V)的 RDD 上调用，K 必须实现 Ordered 接口(特质)，返回一个按照 key 进行排序</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> dataRDD1 <span style="color:#66d9ef">=</span> sparkContext<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span><span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;b&#34;</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;c&#34;</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span> 
<span style="color:#66d9ef">val</span> sortRDD1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> dataRDD1<span style="color:#f92672">.</span>sortByKey<span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> sortRDD1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> dataRDD1<span style="color:#f92672">.</span>sortByKey<span style="color:#f92672">(</span><span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>join</strong></p>
<ul>
<li>
<p><code>def join[W](other: RDD[(K, W)]): RDD[(K, (V, W))]</code></p>
</li>
<li>
<p>在类型为(K,V)和(K,W)的 RDD 上调用，返回一个相同 key 对应的所有元素连接在一起的(K,(V,W))的 RDD</p>
</li>
<li>
<p>案例</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">        <span style="color:#66d9ef">val</span> rdd1 <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span>
            <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;b&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;c&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">)</span><span style="color:#f92672">)</span>
    
        <span style="color:#66d9ef">val</span> rdd2 <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span>
            <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">5</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">6</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;c&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">4</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">)</span><span style="color:#f92672">)</span>
    
        <span style="color:#75715e">// join : 两个不同数据源的数据，相同的key的value会连接在一起，形成元组
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">//        如果两个数据源中key没有匹配上，那么数据不会出现在结果中
</span><span style="color:#75715e"></span>    
        <span style="color:#75715e">//        如果两个数据源中key有多个相同的，会依次匹配，可能会出现笛卡尔乘积，数据量会几何性增长，会导致性能降低。
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">val</span> joinRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#f92672">(</span><span style="color:#66d9ef">Int</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd1<span style="color:#f92672">.</span>join<span style="color:#f92672">(</span>rdd2<span style="color:#f92672">)</span>
    
        joinRDD<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
    
<span style="color:#75715e">//结果：
</span><span style="color:#75715e"></span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">5</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">6</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;c&#34;</span><span style="color:#f92672">,</span><span style="color:#f92672">(</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>leftOuterJoin</strong></p>
<ul>
<li>
<p><code>def leftOuterJoin[W](other: RDD[(K, W)]): RDD[(K, (V, Option[W]))]</code></p>
</li>
<li>
<p>类似于 SQL 语句的左外连接</p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxcarllvqpj31p60s41dx.jpg" alt="QQ截图20211213164109.png"></p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxcarvvqkxj31g20ujh5w.jpg" alt="QQ截图20211213164138.png"></p>
</li>
</ul>
</li>
<li>
<p><strong>cogroup</strong></p>
<ul>
<li>
<p><code>def cogroup[W](other: RDD[(K, W)]): RDD[(K, (Iterable[V], Iterable[W]))]</code></p>
</li>
<li>
<p>在类型为(K,V)和(K,W)的 RDD 上调用，返回一个(K,(Iterable<!-- raw HTML omitted -->,Iterable<!-- raw HTML omitted -->))类型的 RDD</p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxcat4a4gxj31vt0tt7tw.jpg" alt="QQ截图20211213163905.png"></p>
</li>
</ul>
</li>
</ul>
<h3 id="rdd行动算子">RDD行动算子</h3>
<h4 id="reduce">reduce</h4>
<ul>
<li>
<p><code>def reduce(f: (T, T) =&gt; T): T</code></p>
</li>
<li>
<p>聚集 RDD 中的所有元素，先聚合分区内数据，再聚合分区间数据</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#75715e">// 所谓的行动算子，其实就是触发作业(Job)执行的方法
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">// 底层代码调用的是环境对象的runJob方法
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">// 底层代码中会创建ActiveJob，并提交执行。
</span><span style="color:#75715e"></span>  
<span style="color:#66d9ef">val</span> rdd<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
  
<span style="color:#75715e">// 聚合数据
</span><span style="color:#75715e"></span>  
<span style="color:#66d9ef">val</span> reduceResult<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span> <span style="color:#f92672">=</span> rdd<span style="color:#f92672">.</span>reduce<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">+</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
<h4 id="collect">collect</h4>
<ul>
<li>
<p><code>def collect(): Array[T]</code></p>
</li>
<li>
<p>在驱动程序中，以数组 Array 的形式返回数据集的所有元素</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> rdd<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
  
<span style="color:#75715e">// 收集数据到 Driver
</span><span style="color:#75715e"></span>  
rdd<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
<h4 id="count">count</h4>
<ul>
<li>
<p><code>def count(): Long</code></p>
</li>
<li>
<p>返回 RDD 中元素的个数</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> rdd<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
  
<span style="color:#75715e">// 返回 RDD 中元素的个数
</span><span style="color:#75715e"></span>  
<span style="color:#66d9ef">val</span> countResult<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Long</span> <span style="color:#f92672">=</span> rdd<span style="color:#f92672">.</span>count<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
<h4 id="first">first</h4>
<ul>
<li>
<p><code>def first(): T</code></p>
</li>
<li>
<p>返回 RDD 中的第一个元素</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> rdd<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
  
<span style="color:#75715e">// 返回 RDD 中元素的个数
</span><span style="color:#75715e"></span>  
<span style="color:#66d9ef">val</span> firstResult<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span> <span style="color:#f92672">=</span> rdd<span style="color:#f92672">.</span>first<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
println<span style="color:#f92672">(</span>firstResult<span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
<h4 id="take">take</h4>
<ul>
<li>
<p><code>def take(num: Int): Array[T]</code></p>
</li>
<li>
<p>返回一个由 RDD 的前 n 个元素组成的数组</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> rdd<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
  
<span style="color:#75715e">// 返回 RDD 中元素的个数
</span><span style="color:#75715e"></span>  
<span style="color:#66d9ef">val</span> takeResult<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Array</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>take<span style="color:#f92672">(</span><span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
println<span style="color:#f92672">(</span>takeResult<span style="color:#f92672">.</span>mkString<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;,&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
<h4 id="takeordered"><strong>takeOrdered</strong></h4>
<ul>
<li>
<p><code>def takeOrdered(num: Int)(implicit ord: Ordering[T]): Array[T]</code></p>
</li>
<li>
<p>返回该 RDD 排序后的前 n 个元素组成的数组</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> rdd<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
  
<span style="color:#75715e">// 返回 RDD 中元素的个数
</span><span style="color:#75715e"></span>  
<span style="color:#66d9ef">val</span> result<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Array</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>takeOrdered<span style="color:#f92672">(</span><span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
  
<span style="color:#75715e">//降序
</span><span style="color:#75715e"></span>  
<span style="color:#66d9ef">val</span> result<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Array</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>takeOrdered<span style="color:#f92672">(</span><span style="color:#ae81ff">2</span><span style="color:#f92672">)</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>int<span style="color:#f92672">.</span>reverse<span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
<h4 id="aggregate">aggregate</h4>
<ul>
<li>
<p><code>def aggregate[U: ClassTag](zeroValue: U)(seqOp: (U, T) =&gt; U, combOp: (U, U) =&gt; U): U</code></p>
</li>
<li>
<p>分区的数据通过初始值和分区内的数据进行聚合，然后再和初始值进行分区间的数据聚合</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
  
        <span style="color:#75715e">//结果：10 + 13 + 17 = 40
</span><span style="color:#75715e"></span>  
        <span style="color:#75715e">// aggregateByKey : 初始值只会参与分区内计算
</span><span style="color:#75715e"></span>  
        <span style="color:#75715e">// aggregate : 初始值会参与分区内计算,并且和参与分区间计算
</span><span style="color:#75715e"></span>  
        <span style="color:#66d9ef">val</span> result <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>aggregate<span style="color:#f92672">(</span><span style="color:#ae81ff">10</span><span style="color:#f92672">)</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">+</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">_</span><span style="color:#f92672">+</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
<h4 id="fold">fold</h4>
<ul>
<li>
<p><code>def fold(zeroValue: T)(op: (T, T) =&gt; T): T</code></p>
</li>
<li>
<p>折叠操作，aggregate 的简化版操作</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> rdd<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> foldResult<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span> <span style="color:#f92672">=</span> rdd<span style="color:#f92672">.</span>fold<span style="color:#f92672">(</span><span style="color:#ae81ff">0</span><span style="color:#f92672">)</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">+</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
<h4 id="countbykey">countByKey</h4>
<ul>
<li>
<p><code>def countByKey(): Map[K, Long]</code></p>
</li>
<li>
<p>统计每种 key 的个数</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> rdd<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">Int</span>, <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;b&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;c&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;c&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
  
<span style="color:#75715e">// 统计每种 key 的个数
</span><span style="color:#75715e"></span>  
<span style="color:#66d9ef">val</span> result<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">collection.Map</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span>, <span style="color:#66d9ef">Long</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>countByKey<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
</code></pre></div><p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxccrt1oq1j31w00ncduv.jpg" alt="QQ截图20211213174722.png"></p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxccs3kkg9j31u90ov4en.jpg" alt="QQ截图20211213174840.png"></p>
</li>
</ul>
<h4 id="wordcount实现方法">WordCount实现方法</h4>
<ul>
<li>
<p><strong>代码如下</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">    <span style="color:#75715e">// groupBy
</span><span style="color:#75715e"></span>  
    <span style="color:#66d9ef">def</span> wordcount1<span style="color:#f92672">(</span>sc <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">SparkContext</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
  
        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello Scala&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Hello Spark&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> words <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>flatMap<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>split<span style="color:#f92672">(</span><span style="color:#e6db74">&#34; &#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> group<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Iterable</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> words<span style="color:#f92672">.</span>groupBy<span style="color:#f92672">(</span>word<span style="color:#66d9ef">=&gt;</span>word<span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> wordCount<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> group<span style="color:#f92672">.</span>mapValues<span style="color:#f92672">(</span>iter<span style="color:#66d9ef">=&gt;</span>iter<span style="color:#f92672">.</span>size<span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
  
    <span style="color:#75715e">// groupByKey
</span><span style="color:#75715e"></span>  
    <span style="color:#66d9ef">def</span> wordcount2<span style="color:#f92672">(</span>sc <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">SparkContext</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello Scala&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Hello Spark&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> words <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>flatMap<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>split<span style="color:#f92672">(</span><span style="color:#e6db74">&#34; &#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> wordOne <span style="color:#66d9ef">=</span> words<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span><span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> group<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Iterable</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> wordOne<span style="color:#f92672">.</span>groupByKey<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> wordCount<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> group<span style="color:#f92672">.</span>mapValues<span style="color:#f92672">(</span>iter<span style="color:#66d9ef">=&gt;</span>iter<span style="color:#f92672">.</span>size<span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
  
    <span style="color:#75715e">// reduceByKey
</span><span style="color:#75715e"></span>  
    <span style="color:#66d9ef">def</span> wordcount3<span style="color:#f92672">(</span>sc <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">SparkContext</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello Scala&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Hello Spark&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> words <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>flatMap<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>split<span style="color:#f92672">(</span><span style="color:#e6db74">&#34; &#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> wordOne <span style="color:#66d9ef">=</span> words<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span><span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> wordCount<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> wordOne<span style="color:#f92672">.</span>reduceByKey<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">+</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
  
    <span style="color:#75715e">// aggregateByKey
</span><span style="color:#75715e"></span>  
    <span style="color:#66d9ef">def</span> wordcount4<span style="color:#f92672">(</span>sc <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">SparkContext</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello Scala&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Hello Spark&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> words <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>flatMap<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>split<span style="color:#f92672">(</span><span style="color:#e6db74">&#34; &#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> wordOne <span style="color:#66d9ef">=</span> words<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span><span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> wordCount<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> wordOne<span style="color:#f92672">.</span>aggregateByKey<span style="color:#f92672">(</span><span style="color:#ae81ff">0</span><span style="color:#f92672">)</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">+</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">_</span><span style="color:#f92672">+</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
  
    <span style="color:#75715e">// foldByKey
</span><span style="color:#75715e"></span>  
    <span style="color:#66d9ef">def</span> wordcount5<span style="color:#f92672">(</span>sc <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">SparkContext</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello Scala&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Hello Spark&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> words <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>flatMap<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>split<span style="color:#f92672">(</span><span style="color:#e6db74">&#34; &#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> wordOne <span style="color:#66d9ef">=</span> words<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span><span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> wordCount<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> wordOne<span style="color:#f92672">.</span>foldByKey<span style="color:#f92672">(</span><span style="color:#ae81ff">0</span><span style="color:#f92672">)</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">+</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
  
    <span style="color:#75715e">// combineByKey
</span><span style="color:#75715e"></span>  
    <span style="color:#66d9ef">def</span> wordcount6<span style="color:#f92672">(</span>sc <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">SparkContext</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello Scala&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Hello Spark&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> words <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>flatMap<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>split<span style="color:#f92672">(</span><span style="color:#e6db74">&#34; &#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> wordOne <span style="color:#66d9ef">=</span> words<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span><span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> wordCount<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> wordOne<span style="color:#f92672">.</span>combineByKey<span style="color:#f92672">(</span>
            v<span style="color:#66d9ef">=&gt;</span>v<span style="color:#f92672">,</span>
            <span style="color:#f92672">(</span>x<span style="color:#66d9ef">:</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">,</span> y<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> x <span style="color:#f92672">+</span> y<span style="color:#f92672">,</span>
            <span style="color:#f92672">(</span>x<span style="color:#66d9ef">:</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">,</span> y<span style="color:#66d9ef">:</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> x <span style="color:#f92672">+</span> y
        <span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
  
    <span style="color:#75715e">// countByKey
</span><span style="color:#75715e"></span>  
    <span style="color:#66d9ef">def</span> wordcount7<span style="color:#f92672">(</span>sc <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">SparkContext</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello Scala&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Hello Spark&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> words <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>flatMap<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>split<span style="color:#f92672">(</span><span style="color:#e6db74">&#34; &#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> wordOne <span style="color:#66d9ef">=</span> words<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span><span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> wordCount<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">collection.Map</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Long</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> wordOne<span style="color:#f92672">.</span>countByKey<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
  
    <span style="color:#75715e">// countByValue
</span><span style="color:#75715e"></span>  
    <span style="color:#66d9ef">def</span> wordcount8<span style="color:#f92672">(</span>sc <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">SparkContext</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello Scala&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Hello Spark&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> words <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>flatMap<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>split<span style="color:#f92672">(</span><span style="color:#e6db74">&#34; &#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> wordCount<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">collection.Map</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Long</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> words<span style="color:#f92672">.</span>countByValue<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
  
    <span style="color:#75715e">// reduce, aggregate, fold
</span><span style="color:#75715e"></span>  
    <span style="color:#66d9ef">def</span> wordcount91011<span style="color:#f92672">(</span>sc <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">SparkContext</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello Scala&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Hello Spark&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> words <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>flatMap<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>split<span style="color:#f92672">(</span><span style="color:#e6db74">&#34; &#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
  
        <span style="color:#75715e">// 【（word, count）,(word, count)】
</span><span style="color:#75715e"></span>          
        <span style="color:#75715e">// word =&gt; Map[(word,1)]
</span><span style="color:#75715e"></span>          
        <span style="color:#66d9ef">val</span> mapWord <span style="color:#66d9ef">=</span> words<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span>
            word <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
                mutable<span style="color:#f92672">.</span><span style="color:#a6e22e">Map</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Long</span><span style="color:#f92672">]</span><span style="color:#f92672">(</span><span style="color:#f92672">(</span>word<span style="color:#f92672">,</span><span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">)</span>
  
       <span style="color:#66d9ef">val</span> wordCount <span style="color:#66d9ef">=</span> mapWord<span style="color:#f92672">.</span>reduce<span style="color:#f92672">(</span>
            <span style="color:#f92672">(</span>map1<span style="color:#f92672">,</span> map2<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
                map2<span style="color:#f92672">.</span>foreach<span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">case</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">,</span> count<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">val</span> newCount <span style="color:#66d9ef">=</span> map1<span style="color:#f92672">.</span>getOrElse<span style="color:#f92672">(</span>word<span style="color:#f92672">,</span> <span style="color:#ae81ff">0L</span><span style="color:#f92672">)</span> <span style="color:#f92672">+</span> count
                        map1<span style="color:#f92672">.</span>update<span style="color:#f92672">(</span>word<span style="color:#f92672">,</span> newCount<span style="color:#f92672">)</span>
                    <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
                map1
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">)</span>
  
        println<span style="color:#f92672">(</span>wordCount<span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
</code></pre></div></li>
</ul>
<h4 id="save相关算子"><strong>save相关算子</strong></h4>
<ul>
<li>
<p><strong>将数据保存到不同格式的文件中</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#75715e">// 保存成 Text 文件
</span><span style="color:#75715e"></span>  
rdd<span style="color:#f92672">.</span>saveAsTextFile<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;output&#34;</span><span style="color:#f92672">)</span>
<span style="color:#75715e">// 序列化成对象保存到文件
</span><span style="color:#75715e"></span>  
rdd<span style="color:#f92672">.</span>saveAsObjectFile<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;output1&#34;</span><span style="color:#f92672">)</span>
<span style="color:#75715e">// 保存成 Sequencefile 文件
</span><span style="color:#75715e"></span>  
rdd<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span><span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>saveAsSequenceFile<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;output2&#34;</span><span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
<h4 id="foreach">foreach</h4>
<ul>
<li>
<p><strong>分布式遍历 RDD 中的每一个元素，调用指定函数</strong></p>
</li>
<li>
<p><strong>算子 ：</strong> Operator（操作）,RDD的方法和Scala集合对象的方法不一样，集合对象的方法都是在同一个节点的内存中完成的。RDD的方法可以将计算逻辑发送到Executor端（分布式节点）执行，为了区分不同的处理效果，所以将RDD的方法称之为算子，RDD的方法外部的操作都是在Driver端执行的，而方法内部的逻辑代码是在Executor端执行。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
  
        <span style="color:#75715e">// foreach 其实是Driver端内存集合的循环遍历方法 1,2,3,4
</span><span style="color:#75715e"></span>  
        rdd<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
        println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;******************&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#75715e">// foreach 其实是Executor端内存数据打印 3,1,2,4
</span><span style="color:#75715e"></span>  
        rdd<span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
        sc<span style="color:#f92672">.</span>stop<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
<h3 id="序列化">序列化</h3>
<ul>
<li>
<p><strong>闭包检查</strong></p>
<ul>
<li>从计算的角度, <strong>算子以外的代码都是在 Driver 端执行, 算子里面的代码都是在 Executor端执行。<strong>那么在 scala 的函数式编程中，就会导致</strong>算子内经常会用到算子外的数据</strong>，这样就形成了闭包的效果，如果使用的算子外的数据无法序列化，就意味着无法传值给 Executor端执行，就会发生错误，所以需要在执行任务计算前，**检测闭包内的对象是否可以进行序列化，这个操作我们称之为闭包检测。**Scala2.12 版本后闭包编译方式发生了改变</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">        <span style="color:#66d9ef">val</span> sparkConf <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setMaster<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;local[*]&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setAppName<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Operator&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> sc <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">(</span>sparkConf<span style="color:#f92672">)</span>
  
        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
  
        <span style="color:#66d9ef">val</span> user <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">User</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
  
        <span style="color:#75715e">// SparkException: Task not serializable
</span><span style="color:#75715e"></span>  
        <span style="color:#75715e">// NotSerializableException: com.atguigu.bigdata.spark.core.rdd.operator.action.Spark07_RDD_Operator_Action$User
</span><span style="color:#75715e"></span>  
        <span style="color:#75715e">// RDD算子中传递的函数是会包含闭包操作，那么就会进行检测功能
</span><span style="color:#75715e"></span>  
        <span style="color:#75715e">// 闭包检测
</span><span style="color:#75715e"></span>  
        rdd<span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>
            num <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
                println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;age = &#34;</span> <span style="color:#f92672">+</span> <span style="color:#f92672">(</span>user<span style="color:#f92672">.</span>age <span style="color:#f92672">+</span> num<span style="color:#f92672">)</span><span style="color:#f92672">)</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">)</span>
  
        sc<span style="color:#f92672">.</span>stop<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
  
    <span style="color:#f92672">}</span>
    <span style="color:#75715e">//class User extends Serializable {
</span><span style="color:#75715e"></span>  
    <span style="color:#75715e">// 样例类在编译时，会自动混入序列化特质（实现可序列化接口）
</span><span style="color:#75715e"></span>  
    <span style="color:#75715e">//case class User() {
</span><span style="color:#75715e"></span>  
    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">var</span> age <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">30</span>
    <span style="color:#f92672">}</span>
</code></pre></div></li>
<li>
<p><strong>序列化方法和属性</strong></p>
<ul>
<li>
<p><strong>从计算的角度, 算子以外的代码都是在 Driver 端执行, 算子里面的代码都是在 Executor端执行</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> sparConf <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setMaster<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;local&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setAppName<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;WordCount&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> sc <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">(</span>sparConf<span style="color:#f92672">)</span>
    
        <span style="color:#66d9ef">val</span> rdd<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">Array</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hello world&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;hello spark&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;hive&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;atguigu&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
    
        <span style="color:#66d9ef">val</span> search <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Search</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;h&#34;</span><span style="color:#f92672">)</span>
    
        <span style="color:#75715e">//search.getMatch1(rdd).collect().foreach(println)
</span><span style="color:#75715e"></span>    
        search<span style="color:#f92672">.</span>getMatch2<span style="color:#f92672">(</span>rdd<span style="color:#f92672">)</span><span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
    
        sc<span style="color:#f92672">.</span>stop<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
    <span style="color:#75715e">// 查询对象
</span><span style="color:#75715e"></span>    
    <span style="color:#75715e">// 类的构造参数其实是类的属性, 构造参数需要进行闭包检测，其实就等同于类进行闭包检测
</span><span style="color:#75715e"></span>    
    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Search</span><span style="color:#f92672">(</span>query<span style="color:#66d9ef">:</span><span style="color:#66d9ef">String</span><span style="color:#f92672">)</span><span style="color:#f92672">{</span>
    
        <span style="color:#66d9ef">def</span> isMatch<span style="color:#f92672">(</span>s<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Boolean</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
            s<span style="color:#f92672">.</span>contains<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span>query<span style="color:#f92672">)</span>
        <span style="color:#f92672">}</span>
    
        <span style="color:#75715e">// 函数序列化案例
</span><span style="color:#75715e"></span>            
        <span style="color:#66d9ef">def</span> getMatch1 <span style="color:#f92672">(</span>rdd<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">{</span>
            rdd<span style="color:#f92672">.</span>filter<span style="color:#f92672">(</span>isMatch<span style="color:#f92672">)</span>
        <span style="color:#f92672">}</span>
    
        <span style="color:#75715e">// 属性序列化案例
</span><span style="color:#75715e"></span>            
        <span style="color:#66d9ef">def</span> getMatch2<span style="color:#f92672">(</span>rdd<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">val</span> s <span style="color:#66d9ef">=</span> query
            rdd<span style="color:#f92672">.</span>filter<span style="color:#f92672">(</span>x <span style="color:#66d9ef">=&gt;</span> x<span style="color:#f92672">.</span>contains<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>Kryo 序列化框架</strong></p>
<ul>
<li>
<p>参考地址: <a href="https://github.com/EsotericSoftware/kryo">https://github.com/EsotericSoftware/kryo</a></p>
</li>
<li>
<p>Java 的序列化能够序列化任何的类。但是比较重（字节多），序列化后，对象的提交也比较大。Spark 出于性能的考虑，Spark2.0 开始支持另外一种 Kryo 序列化机制。Kryo 速度是 Serializable 的 10 倍。当 RDD 在 Shuffle 数据的时候，简单数据类型、数组和字符串类型已经在 Spark 内部使用 Kryo 来序列化。</p>
</li>
<li>
<p>注意：即使使用 Kryo 序列化，也要继承 Serializable 接口。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">serializable_Kryo</span> <span style="color:#f92672">{</span>
 <span style="color:#66d9ef">def</span> main<span style="color:#f92672">(</span>args<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Array</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
 <span style="color:#66d9ef">val</span> conf<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">SparkConf</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
 <span style="color:#f92672">.</span>setAppName<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;SerDemo&#34;</span><span style="color:#f92672">)</span>
 <span style="color:#f92672">.</span>setMaster<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;local[*]&#34;</span><span style="color:#f92672">)</span>
 <span style="color:#75715e">// 替换默认的序列化机制
</span><span style="color:#75715e"></span> <span style="color:#f92672">.</span>set<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;spark.serializer&#34;</span><span style="color:#f92672">,</span> 
<span style="color:#e6db74">&#34;org.apache.spark.serializer.KryoSerializer&#34;</span><span style="color:#f92672">)</span>
 <span style="color:#75715e">// 注册需要使用 kryo 序列化的自定义类
</span><span style="color:#75715e"></span> <span style="color:#f92672">.</span>registerKryoClasses<span style="color:#f92672">(</span><span style="color:#a6e22e">Array</span><span style="color:#f92672">(</span>classOf<span style="color:#f92672">[</span><span style="color:#66d9ef">Searcher</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
 <span style="color:#66d9ef">val</span> sc <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">(</span>conf<span style="color:#f92672">)</span>
 <span style="color:#66d9ef">val</span> rdd<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">Array</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hello world&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;hello atguigu&#34;</span><span style="color:#f92672">,</span> 
<span style="color:#e6db74">&#34;atguigu&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;hahah&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
 <span style="color:#66d9ef">val</span> searcher <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Searcher</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hello&#34;</span><span style="color:#f92672">)</span>
 <span style="color:#66d9ef">val</span> result<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> searcher<span style="color:#f92672">.</span>getMatchedRDD1<span style="color:#f92672">(</span>rdd<span style="color:#f92672">)</span>
 result<span style="color:#f92672">.</span>collect<span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
 <span style="color:#f92672">}</span> <span style="color:#f92672">}</span>
<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Searcher</span><span style="color:#f92672">(</span><span style="color:#66d9ef">val</span> query<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
 <span style="color:#66d9ef">def</span> isMatch<span style="color:#f92672">(</span>s<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">{</span>
 s<span style="color:#f92672">.</span>contains<span style="color:#f92672">(</span>query<span style="color:#f92672">)</span>
 <span style="color:#f92672">}</span>
 <span style="color:#66d9ef">def</span> getMatchedRDD1<span style="color:#f92672">(</span>rdd<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">{</span>
 rdd<span style="color:#f92672">.</span>filter<span style="color:#f92672">(</span>isMatch<span style="color:#f92672">)</span> 
 <span style="color:#f92672">}</span>
 <span style="color:#66d9ef">def</span> getMatchedRDD2<span style="color:#f92672">(</span>rdd<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">{</span>
 <span style="color:#66d9ef">val</span> q <span style="color:#66d9ef">=</span> query
 rdd<span style="color:#f92672">.</span>filter<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>contains<span style="color:#f92672">(</span>q<span style="color:#f92672">)</span><span style="color:#f92672">)</span>
 <span style="color:#f92672">}</span> <span style="color:#f92672">}</span>
</code></pre></div></li>
</ul>
</li>
</ul>
<h3 id="rdd依赖关系">RDD依赖关系</h3>
<ul>
<li>
<p><strong>RDD血缘关系</strong></p>
<p>​	<img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxl9lf0hxaj30zv0gvaka.jpg" alt="QQ截图20211221105218.png"></p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxl9p0kyklj315p0f549f.jpg" alt="QQ截图20211221105546.png"></p>
<ul>
<li>RDD 只支持粗粒度转换，即在大量记录上执行的单个操作。将创建 RDD 的一系列 Lineage（血统）记录下来，以便恢复丢失的分区。RDD 的 Lineage 会记录 RDD 的元数据信息和转换行为，<strong>当该 RDD 的部分分区数据丢失时，它可以根据这些信息来重新运算和恢复丢失的数据分区。</strong></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> fileRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>textFile<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;input/1.txt&#34;</span><span style="color:#f92672">)</span>
<span style="color:#75715e">//打印血缘关系
</span><span style="color:#75715e"></span>  
println<span style="color:#f92672">(</span>fileRDD<span style="color:#f92672">.</span>toDebugString<span style="color:#f92672">)</span>
println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;----------------------&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> wordRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> fileRDD<span style="color:#f92672">.</span>flatMap<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>split<span style="color:#f92672">(</span><span style="color:#e6db74">&#34; &#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
println<span style="color:#f92672">(</span>wordRDD<span style="color:#f92672">.</span>toDebugString<span style="color:#f92672">)</span>
println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;----------------------&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> mapRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> wordRDD<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span><span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
println<span style="color:#f92672">(</span>mapRDD<span style="color:#f92672">.</span>toDebugString<span style="color:#f92672">)</span>
println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;----------------------&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> resultRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> mapRDD<span style="color:#f92672">.</span>reduceByKey<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">+</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span>
println<span style="color:#f92672">(</span>resultRDD<span style="color:#f92672">.</span>toDebugString<span style="color:#f92672">)</span>
resultRDD<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
</code></pre></div><p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxl9vajybij31f60cn7gr.jpg" alt="QQ截图20211221110146.png"></p>
</li>
<li>
<p><strong>RDD</strong> <strong>依赖关系</strong></p>
<ul>
<li>
<p>这里所谓的依赖关系，其实就是两个相邻 RDD 之间的关系</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> sc<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">SparkContext</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">(</span>conf<span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> fileRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>textFile<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;input/1.txt&#34;</span><span style="color:#f92672">)</span>
println<span style="color:#f92672">(</span>fileRDD<span style="color:#f92672">.</span>dependencies<span style="color:#f92672">)</span>
println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;----------------------&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> wordRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> fileRDD<span style="color:#f92672">.</span>flatMap<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>split<span style="color:#f92672">(</span><span style="color:#e6db74">&#34; &#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
println<span style="color:#f92672">(</span>wordRDD<span style="color:#f92672">.</span>dependencies<span style="color:#f92672">)</span>
println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;----------------------&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> mapRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> wordRDD<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span><span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
println<span style="color:#f92672">(</span>mapRDD<span style="color:#f92672">.</span>dependencies<span style="color:#f92672">)</span>
println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;----------------------&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> resultRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> mapRDD<span style="color:#f92672">.</span>reduceByKey<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">+</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span>
println<span style="color:#f92672">(</span>resultRDD<span style="color:#f92672">.</span>dependencies<span style="color:#f92672">)</span>
resultRDD<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
</code></pre></div><p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxl9xuef2nj310x08wgqu.jpg" alt="QQ截图20211221110415.png"></p>
</li>
</ul>
</li>
<li>
<p><strong>RDD</strong> <strong>窄依赖</strong></p>
<p>​	<img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxla4veq7rj31730p9qdm.jpg" alt="QQ截图20211221111101.png"></p>
<ul>
<li>
<p>窄依赖表示每一个父(上游)RDD 的 Partition 最多被子（下游）RDD 的一个 Partition 使用，窄依赖我们形象的比喻为独生子女。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OneToOneDependency</span><span style="color:#f92672">[</span><span style="color:#66d9ef">T</span><span style="color:#f92672">]</span><span style="color:#f92672">(</span>rdd<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">T</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">NarrowDependency</span><span style="color:#f92672">[</span><span style="color:#66d9ef">T</span><span style="color:#f92672">]</span><span style="color:#f92672">(</span>rdd<span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>RDD</strong> <strong>宽依赖</strong></p>
<p>​	<img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxla87mym0j31180nh7fy.jpg" alt="QQ截图20211221111413.png"></p>
<ul>
<li>
<p>宽依赖表示同一个父（上游）RDD 的 Partition 被多个子（下游）RDD 的 Partition 依赖，会引起 Shuffle，总结：宽依赖我们形象的比喻为多生。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ShuffleDependency</span><span style="color:#f92672">[</span><span style="color:#66d9ef">K</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ClassTag</span>, <span style="color:#66d9ef">V</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ClassTag</span>, <span style="color:#66d9ef">C</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ClassTag</span><span style="color:#f92672">]</span><span style="color:#f92672">(</span>
 <span style="color:#a6e22e">@transient</span> <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> <span style="color:#a6e22e">_rdd</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">_</span> <span style="color:#66d9ef">&lt;:</span> <span style="color:#66d9ef">Product2</span><span style="color:#f92672">[</span><span style="color:#66d9ef">K</span>, <span style="color:#66d9ef">V</span><span style="color:#f92672">]</span><span style="color:#f92672">]</span><span style="color:#f92672">,</span>
 <span style="color:#66d9ef">val</span> partitioner<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Partitioner</span><span style="color:#f92672">,</span>
 <span style="color:#66d9ef">val</span> serializer<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Serializer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">SparkEnv</span><span style="color:#f92672">.</span>get<span style="color:#f92672">.</span>serializer<span style="color:#f92672">,</span>
 <span style="color:#66d9ef">val</span> keyOrdering<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Ordering</span><span style="color:#f92672">[</span><span style="color:#66d9ef">K</span><span style="color:#f92672">]</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">None</span><span style="color:#f92672">,</span>
 <span style="color:#66d9ef">val</span> aggregator<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Aggregator</span><span style="color:#f92672">[</span><span style="color:#66d9ef">K</span>, <span style="color:#66d9ef">V</span>, <span style="color:#66d9ef">C</span><span style="color:#f92672">]</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">None</span><span style="color:#f92672">,</span>
 <span style="color:#66d9ef">val</span> mapSideCombine<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Boolean</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>
 <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Dependency</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Product2</span><span style="color:#f92672">[</span><span style="color:#66d9ef">K</span>, <span style="color:#66d9ef">V</span><span style="color:#f92672">]</span><span style="color:#f92672">]</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>RDD</strong> <strong>阶段划分</strong></p>
<p>​	<img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxlah5o1yaj315i0hl7c0.jpg" alt="QQ截图20211221111856.png"></p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxlahi61ymj31cs0patmw.jpg" alt="QQ截图20211221112226.png"></p>
<ul>
<li>
<p>DAG（Directed Acyclic Graph）有向无环图是由点和线组成的拓扑图形，该图形具有方向，不会闭环。例如，DAG 记录了 RDD 的转换过程和任务的阶段。</p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxkffk4b2pj30nh08jq4s.jpg" alt="QQ截图20211220172807.png"></p>
</li>
</ul>
</li>
<li>
<p><strong>RDD</strong> <strong>阶段划分源码</strong></p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxkfh0vxyhj30or0ilwno.jpg" alt="QQ截图20211220172959.png"></p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxkfh7tkqwj30oh0k1n63.jpg" alt="QQ截图20211220173008.png"></p>
</li>
<li>
<p><strong>RDD</strong> <strong>任务划分</strong></p>
<ul>
<li>
<p>RDD 任务切分中间分为：Application、Job、Stage 和 Task</p>
<ul>
<li>Application：初始化一个 SparkContext 即生成一个 Application；</li>
<li>Job：一个 Action 算子就会生成一个 Job；</li>
<li>Stage：Stage 等于宽依赖(ShuffleDependency)的个数加 1；</li>
<li>Task：一个 Stage 阶段中，最后一个 RDD 的分区个数就是 Task 的个数。</li>
</ul>
</li>
<li>
<p><strong>注意：Application-&gt;Job-&gt;Stage-&gt;Task 每一层都是 1 对 n 的关系。</strong></p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxkfive9mvj30ok0cgq7m.jpg" alt="QQ截图20211220173153.png"></p>
</li>
</ul>
</li>
<li>
<p><strong>RDD</strong> <strong>任务划分源码</strong></p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxkfju0y9tj30on0m6qed.jpg" alt="QQ截图20211220173249.png"></p>
</li>
</ul>
<h3 id="rdd-持久化"><strong>RDD</strong> <strong>持久化</strong></h3>
<ul>
<li>
<p><strong>引入</strong></p>
<ul>
<li>
<p>需求：wordcount既要分组又要计算分组的大小</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> sparConf <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setMaster<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;local&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setAppName<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Persist&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> sc <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">(</span>sparConf<span style="color:#f92672">)</span>
    
        <span style="color:#66d9ef">val</span> list <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello Scala&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Hello Spark&#34;</span><span style="color:#f92672">)</span>
    
        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span>list<span style="color:#f92672">)</span>
    
        <span style="color:#66d9ef">val</span> flatRDD <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>flatMap<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>split<span style="color:#f92672">(</span><span style="color:#e6db74">&#34; &#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
    
        <span style="color:#66d9ef">val</span> mapRDD <span style="color:#66d9ef">=</span> flatRDD<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span>word<span style="color:#f92672">=&gt;</span><span style="color:#f92672">{</span>
            println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;@@@@@@@@@@@@&#34;</span><span style="color:#f92672">)</span>
            <span style="color:#f92672">(</span>word<span style="color:#f92672">,</span><span style="color:#ae81ff">1</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">}</span><span style="color:#f92672">)</span>
    
        <span style="color:#75715e">//mapRDD.cache() 默认存储在内存中
</span><span style="color:#75715e"></span>    
        <span style="color:#66d9ef">val</span> reduceRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> mapRDD<span style="color:#f92672">.</span>reduceByKey<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">+</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span>
        reduceRDD<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
        println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;**************************************&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> groupRDD <span style="color:#66d9ef">=</span> mapRDD<span style="color:#f92672">.</span>groupByKey<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        groupRDD<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
    
        sc<span style="color:#f92672">.</span>stop<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxlhb6bzbrj316i0du75v.jpg" alt="QQ截图20211221151910.jpg"></p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxlhc2gaq5j31440aa0td.jpg" alt="QQ截图20211221152005.jpg"></p>
</li>
<li>
<p><strong>RDD Cache</strong> <strong>缓存</strong></p>
<ul>
<li>
<p>RDD 通过 Cache 或者 Persist 方法将前面的计算结果缓存，默认情况下会把数据以缓存在 JVM 的堆内存中。但是并不是这两个方法被调用时立即缓存，而是触发后面的 action 算子时，该 RDD 将会被缓存在计算节点的内存中，并供后面重用。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#75715e">// cache 操作会增加血缘关系，不改变原有的血缘关系
</span><span style="color:#75715e"></span>    
println<span style="color:#f92672">(</span>wordToOneRdd<span style="color:#f92672">.</span>toDebugString<span style="color:#f92672">)</span>
<span style="color:#75715e">// 数据缓存。
</span><span style="color:#75715e"></span>    
wordToOneRdd<span style="color:#f92672">.</span>cache<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    
<span style="color:#75715e">// 可以更改存储级别
</span><span style="color:#75715e"></span>    
<span style="color:#75715e">//mapRdd.persist(StorageLevel.MEMORY_AND_DISK_2)
</span></code></pre></div></li>
<li>
<p><strong>存储级别</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">StorageLevel</span> <span style="color:#f92672">{</span>
 <span style="color:#66d9ef">val</span> <span style="color:#a6e22e">NONE</span> <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">StorageLevel</span><span style="color:#f92672">(</span><span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>
 <span style="color:#66d9ef">val</span> <span style="color:#a6e22e">DISK_ONLY</span> <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">StorageLevel</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>
 <span style="color:#66d9ef">val</span> <span style="color:#a6e22e">DISK_ONLY_2</span> <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">StorageLevel</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
 <span style="color:#66d9ef">val</span> <span style="color:#a6e22e">MEMORY_ONLY</span> <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">StorageLevel</span><span style="color:#f92672">(</span><span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
 <span style="color:#66d9ef">val</span> <span style="color:#a6e22e">MEMORY_ONLY_2</span> <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">StorageLevel</span><span style="color:#f92672">(</span><span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
 <span style="color:#66d9ef">val</span> <span style="color:#a6e22e">MEMORY_ONLY_SER</span> <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">StorageLevel</span><span style="color:#f92672">(</span><span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>
 <span style="color:#66d9ef">val</span> <span style="color:#a6e22e">MEMORY_ONLY_SER_2</span> <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">StorageLevel</span><span style="color:#f92672">(</span><span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
 <span style="color:#66d9ef">val</span> <span style="color:#a6e22e">MEMORY_AND_DISK</span> <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">StorageLevel</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
 <span style="color:#66d9ef">val</span> <span style="color:#a6e22e">MEMORY_AND_DISK_2</span> <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">StorageLevel</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
 <span style="color:#66d9ef">val</span> <span style="color:#a6e22e">MEMORY_AND_DISK_SER</span> <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">StorageLevel</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>
 <span style="color:#66d9ef">val</span> <span style="color:#a6e22e">MEMORY_AND_DISK_SER_2</span> <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">StorageLevel</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span>
 <span style="color:#66d9ef">val</span> <span style="color:#a6e22e">OFF_HEAP</span> <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">StorageLevel</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">}</span>
</code></pre></div><p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxkfpymvz2j30oj07ztd9.jpg" alt="QQ截图20211220173730.png"></p>
</li>
<li>
<p>缓存有可能丢失，或者存储于内存的数据由于内存不足而被删除，RDD 的缓存容错机制保证了即使缓存丢失也能保证计算的正确执行。通过基于 RDD 的一系列转换，丢失的数据会被重算，由于 RDD 的各个 Partition 是相对独立的，因此只需要计算丢失的部分即可，并不需要重算全部 Partition。</p>
</li>
<li>
<p>Spark 会自动对一些 Shuffle 操作的中间数据做持久化操作(比如：reduceByKey)。这样做的目的是为了当一个节点 Shuffle 失败了避免重新计算整个输入。但是，在实际使用的时候，如果想重用数据，仍然建议调用 persist 或 cache。</p>
</li>
</ul>
</li>
<li>
<p><strong>RDD CheckPoint</strong> <strong>检查点</strong></p>
<ul>
<li>检查点其实就是通过将 RDD 中间结果写入磁盘。由于血缘依赖过长会造成容错成本过高，这样就不如在中间阶段做检查点容错，如果检查点之后有节点出现问题，可以从检查点开始重做血缘，减少了开销。对 RDD 进行 checkpoint 操作并不会马上被执行，必须执行 Action 操作才能触发。</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#75715e">// 设置检查点路径
</span><span style="color:#75715e"></span>  
sc<span style="color:#f92672">.</span>setCheckpointDir<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;./checkpoint1&#34;</span><span style="color:#f92672">)</span>
<span style="color:#75715e">// 创建一个 RDD，读取指定位置文件:hello atguigu atguigu
</span><span style="color:#75715e"></span>  
<span style="color:#66d9ef">val</span> lineRdd<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>textFile<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;input/1.txt&#34;</span><span style="color:#f92672">)</span>
<span style="color:#75715e">// 业务逻辑
</span><span style="color:#75715e"></span>  
<span style="color:#66d9ef">val</span> wordRdd<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> lineRdd<span style="color:#f92672">.</span>flatMap<span style="color:#f92672">(</span>line <span style="color:#66d9ef">=&gt;</span> line<span style="color:#f92672">.</span>split<span style="color:#f92672">(</span><span style="color:#e6db74">&#34; &#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> wordToOneRdd<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Long</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> wordRdd<span style="color:#f92672">.</span>map <span style="color:#f92672">{</span>
 word <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
 <span style="color:#f92672">(</span>word<span style="color:#f92672">,</span> <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
 <span style="color:#f92672">}</span> <span style="color:#f92672">}</span>
<span style="color:#75715e">// 增加缓存,避免再重新跑一个 job 做 checkpoint
</span><span style="color:#75715e"></span>  
wordToOneRdd<span style="color:#f92672">.</span>cache<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#75715e">// 数据检查点：针对 wordToOneRdd 做检查点计算
</span><span style="color:#75715e"></span>  
wordToOneRdd<span style="color:#f92672">.</span>checkpoint<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#75715e">// 触发执行逻辑
</span><span style="color:#75715e"></span>  
wordToOneRdd<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
</code></pre></div></li>
<li>
<p><strong>缓存和检查点区别</strong></p>
<ul>
<li>Cache 缓存只是将数据保存起来，不切断血缘依赖，会在血缘关系中添加新的依赖。Checkpoint 检查点切断血缘依赖。</li>
<li>Cache 缓存的数据通常存储在磁盘、内存等地方，可靠性低。Checkpoint 的数据通常存储在 HDFS 等容错、高可用的文件系统，可靠性高。</li>
<li>建议对 checkpoint()的 RDD 使用 Cache 缓存，这样 checkpoint 的 job 只需从 Cache 缓存中读取数据即可，否则需要再从头计算一次 RDD。</li>
</ul>
</li>
</ul>
<h3 id="rdd分区器">RDD分区器</h3>
<ul>
<li>
<p>Spark 目前支持 Hash 分区和 Range 分区，和用户自定义分区。Hash 分区为当前的默认分区。分区器直接决定了 RDD 中分区的个数、RDD 中每条数据经过 Shuffle 后进入哪个分区，进而决定了 Reduce 的个数。</p>
<ul>
<li><strong>只有 Key-Value 类型的 RDD 才有分区器，非 Key-Value 类型的 RDD 分区的值是 None</strong></li>
<li><strong>每个 RDD 的分区 ID 范围：0 ~ (numPartitions - 1)，决定这个值是属于那个分区的。</strong></li>
</ul>
</li>
<li>
<p><strong>Hash</strong> <strong>分区</strong>：对于给定的 key，计算其 hashCode,并除以分区个数取余</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HashPartitioner</span><span style="color:#f92672">(</span>partitions<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Partitioner</span> <span style="color:#f92672">{</span>
 require<span style="color:#f92672">(</span>partitions <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">,</span> <span style="color:#e6db74">s&#34;</span><span style="color:#e6db74">Number of partitions (</span><span style="color:#e6db74">$partitions</span><span style="color:#e6db74">) cannot be negative.</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">)</span>
 <span style="color:#66d9ef">def</span> numPartitions<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span> <span style="color:#f92672">=</span> partitions
 <span style="color:#66d9ef">def</span> getPartition<span style="color:#f92672">(</span>key<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Any</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span> <span style="color:#f92672">=</span> key <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">null</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#ae81ff">0</span>
  <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">_</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Utils</span><span style="color:#f92672">.</span>nonNegativeMod<span style="color:#f92672">(</span>key<span style="color:#f92672">.</span>hashCode<span style="color:#f92672">,</span> numPartitions<span style="color:#f92672">)</span>
 <span style="color:#f92672">}</span>
 <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">def</span> equals<span style="color:#f92672">(</span>other<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Any</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Boolean</span> <span style="color:#f92672">=</span> other <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">case</span> h<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HashPartitioner</span> <span style="color:#f92672">=&gt;</span> h<span style="color:#f92672">.</span>numPartitions <span style="color:#f92672">==</span> numPartitions
  <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">_</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#66d9ef">false</span>
 <span style="color:#f92672">}</span>
 <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">def</span> hashCode<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span> <span style="color:#f92672">=</span> numPartitions
<span style="color:#f92672">}</span>
</code></pre></div></li>
<li>
<p><strong>Range</strong> <strong>分区</strong>：将一定范围内的数据映射到一个分区中，尽量保证每个分区数据均匀，而且分区间有序</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RangePartitioner</span><span style="color:#f92672">[</span><span style="color:#66d9ef">K</span> <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Ordering</span> <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ClassTag</span>, <span style="color:#66d9ef">V</span><span style="color:#f92672">]</span><span style="color:#f92672">(</span>
 partitions<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span><span style="color:#f92672">,</span>
 rdd<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">_</span> <span style="color:#66d9ef">&lt;:</span> <span style="color:#66d9ef">Product2</span><span style="color:#f92672">[</span><span style="color:#66d9ef">K</span>, <span style="color:#66d9ef">V</span><span style="color:#f92672">]</span><span style="color:#f92672">]</span><span style="color:#f92672">,</span>
 <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">var</span> ascending<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Boolean</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
 <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Partitioner</span> <span style="color:#f92672">{</span>
 <span style="color:#75715e">// We allow partitions = 0, which happens when sorting an empty RDD under the default settings.
</span><span style="color:#75715e"></span>       
 require<span style="color:#f92672">(</span>partitions <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">,</span> <span style="color:#e6db74">s&#34;</span><span style="color:#e6db74">Number of partitions cannot be negative but found 
</span><span style="color:#e6db74">   
</span><span style="color:#e6db74"></span><span style="color:#e6db74">$partitions</span><span style="color:#e6db74">.</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">)</span>
 <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">var</span> ordering <span style="color:#66d9ef">=</span> implicitly<span style="color:#f92672">[</span><span style="color:#66d9ef">Ordering</span><span style="color:#f92672">[</span><span style="color:#66d9ef">K</span><span style="color:#f92672">]</span><span style="color:#f92672">]</span>
 <span style="color:#75715e">// An array of upper bounds for the first (partitions - 1) partitions
</span><span style="color:#75715e"></span>       
 <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">var</span> rangeBounds<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Array</span><span style="color:#f92672">[</span><span style="color:#66d9ef">K</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">{</span>
 <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>
 <span style="color:#f92672">}</span>
 <span style="color:#66d9ef">def</span> numPartitions<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span> <span style="color:#f92672">=</span> rangeBounds<span style="color:#f92672">.</span>length <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
 <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">var</span> binarySearch<span style="color:#66d9ef">:</span> <span style="color:#f92672">(</span><span style="color:#f92672">(</span><span style="color:#66d9ef">Array</span><span style="color:#f92672">[</span><span style="color:#66d9ef">K</span><span style="color:#f92672">]</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">K</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Int</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">CollectionsUtils</span><span style="color:#f92672">.</span>makeBinarySearch<span style="color:#f92672">[</span><span style="color:#66d9ef">K</span><span style="color:#f92672">]</span>
 <span style="color:#66d9ef">def</span> getPartition<span style="color:#f92672">(</span>key<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Any</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
 <span style="color:#66d9ef">val</span> k <span style="color:#66d9ef">=</span> key<span style="color:#f92672">.</span>asInstanceOf<span style="color:#f92672">[</span><span style="color:#66d9ef">K</span><span style="color:#f92672">]</span>
 <span style="color:#66d9ef">var</span> partition <span style="color:#66d9ef">=</span> <span style="color:#ae81ff">0</span>
 <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>rangeBounds<span style="color:#f92672">.</span>length <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">128</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
 <span style="color:#75715e">// If we have less than 128 partitions naive search
</span><span style="color:#75715e"></span> <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>partition <span style="color:#f92672">&lt;</span> rangeBounds<span style="color:#f92672">.</span>length <span style="color:#f92672">&amp;&amp;</span> ordering<span style="color:#f92672">.</span>gt<span style="color:#f92672">(</span>k<span style="color:#f92672">,</span> 
rangeBounds<span style="color:#f92672">(</span>partition<span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
 partition <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
 <span style="color:#f92672">}</span>
 <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
 <span style="color:#75715e">// Determine which binary search method to use only once.
</span><span style="color:#75715e"></span>       
 partition <span style="color:#66d9ef">=</span> binarySearch<span style="color:#f92672">(</span>rangeBounds<span style="color:#f92672">,</span> k<span style="color:#f92672">)</span>
 <span style="color:#75715e">// binarySearch either returns the match location or -[insertion point]-1
</span><span style="color:#75715e"></span>       
 <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>partition <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
 partition <span style="color:#66d9ef">=</span> <span style="color:#f92672">-</span>partition<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
 <span style="color:#f92672">}</span>
 <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>partition <span style="color:#f92672">&gt;</span> rangeBounds<span style="color:#f92672">.</span>length<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
 partition <span style="color:#66d9ef">=</span> rangeBounds<span style="color:#f92672">.</span>length
 <span style="color:#f92672">}</span>
 <span style="color:#f92672">}</span>
 <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ascending<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
 partition
 <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
 rangeBounds<span style="color:#f92672">.</span>length <span style="color:#f92672">-</span> partition
 <span style="color:#f92672">}</span>
 <span style="color:#f92672">}</span>
 <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">def</span> equals<span style="color:#f92672">(</span>other<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Any</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Boolean</span> <span style="color:#f92672">=</span> other <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
 <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>
 <span style="color:#f92672">}</span>
 <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">def</span> hashCode<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
 <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>
 <span style="color:#f92672">}</span>
 <span style="color:#a6e22e">@throws</span><span style="color:#f92672">(</span>classOf<span style="color:#f92672">[</span><span style="color:#66d9ef">IOException</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span>
 <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">def</span> writeObject<span style="color:#f92672">(</span>out<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ObjectOutputStream</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> 
<span style="color:#a6e22e">Utils</span><span style="color:#f92672">.</span>tryOrIOException <span style="color:#f92672">{</span>
 <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>
 <span style="color:#f92672">}</span>
 <span style="color:#a6e22e">@throws</span><span style="color:#f92672">(</span>classOf<span style="color:#f92672">[</span><span style="color:#66d9ef">IOException</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span>
 <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">def</span> readObject<span style="color:#f92672">(</span>in<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ObjectInputStream</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Utils</span><span style="color:#f92672">.</span>tryOrIOException 
<span style="color:#f92672">{</span>
 <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>
 <span style="color:#f92672">}</span> <span style="color:#f92672">}</span>
</code></pre></div></li>
<li>
<p><strong>自定义分区器</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">package</span> com.atguigu.bigdata.spark.core.rdd.part
  
<span style="color:#66d9ef">import</span> org.apache.spark.rdd.RDD
<span style="color:#66d9ef">import</span> org.apache.spark.<span style="color:#f92672">{</span><span style="color:#a6e22e">HashPartitioner</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">Partitioner</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">}</span>
  
<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Spark01_RDD_Part</span> <span style="color:#f92672">{</span>
  
    <span style="color:#66d9ef">def</span> main<span style="color:#f92672">(</span>args<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Array</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">val</span> sparConf <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkConf</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setMaster<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;local&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>setAppName<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;WordCount&#34;</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> sc <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SparkContext</span><span style="color:#f92672">(</span>sparConf<span style="color:#f92672">)</span>
  
        <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span>
            <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;nba&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;xxxxxxxxx&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span>
            <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;cba&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;xxxxxxxxx&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span>
            <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;wnba&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;xxxxxxxxx&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span>
            <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;nba&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;xxxxxxxxx&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span>
        <span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">val</span> partRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#f92672">(</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>partitionBy<span style="color:#f92672">(</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">MyPartitioner</span> <span style="color:#f92672">)</span>
  
        partRDD<span style="color:#f92672">.</span>saveAsTextFile<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;output&#34;</span><span style="color:#f92672">)</span>
  
        sc<span style="color:#f92672">.</span>stop<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
  
    <span style="color:#75715e">/*</span><span style="color:#75715e">*</span><span style="color:#75715e">
</span><span style="color:#75715e">      
</span><span style="color:#75715e">      </span><span style="color:#75715e">*</span><span style="color:#75715e"> 自定义分区器
</span><span style="color:#75715e">        
</span><span style="color:#75715e">      </span><span style="color:#75715e">*</span><span style="color:#75715e"> 1. 继承Partitioner
</span><span style="color:#75715e">        
</span><span style="color:#75715e">      </span><span style="color:#75715e">*</span><span style="color:#75715e"> 2. 重写方法
</span><span style="color:#75715e">        
</span><span style="color:#75715e">      </span><span style="color:#75715e">*/</span>
      
    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyPartitioner</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Partitioner</span><span style="color:#f92672">{</span>
        <span style="color:#75715e">// 分区数量
</span><span style="color:#75715e"></span>          
        <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">def</span> numPartitions<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
  
        <span style="color:#75715e">// 根据数据的key值返回数据所在的分区索引（从0开始）
</span><span style="color:#75715e"></span>          
        <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">def</span> getPartition<span style="color:#f92672">(</span>key<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Any</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
            key <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;nba&#34;</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#ae81ff">0</span>
                <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;wnba&#34;</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#ae81ff">1</span>
                <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">_</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#ae81ff">2</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
  
</code></pre></div></li>
</ul>
<h3 id="rdd-文件读取与保存"><strong>RDD</strong> <strong>文件读取与保存</strong></h3>
<ul>
<li>
<p><strong>Spark 的数据读取及数据保存可以从两个维度来作区分：文件格式以及文件系统。</strong></p>
<ul>
<li>
<p>文件格式分为：text 文件、csv 文件、sequence 文件以及 Object 文件；</p>
</li>
<li>
<p>文件系统分为：本地文件系统、HDFS、HBASE 以及数据库。</p>
</li>
</ul>
</li>
<li>
<p><strong>text文件</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#75715e">// 读取输入文件
</span><span style="color:#75715e"></span>  
<span style="color:#66d9ef">val</span> inputRDD<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RDD</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>textFile<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;input/1.txt&#34;</span><span style="color:#f92672">)</span>
  
<span style="color:#75715e">// 保存数据
</span><span style="color:#75715e"></span>  
inputRDD<span style="color:#f92672">.</span>saveAsTextFile<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;output&#34;</span><span style="color:#f92672">)</span>
</code></pre></div></li>
<li>
<p><strong>sequence文件</strong></p>
<ul>
<li>SequenceFile 文件是 Hadoop 用来存储二进制形式的 key-value 对而设计的一种平面文件(Flat File)。在 SparkContext 中，可以调用 sequenceFile<code>[keyClass, valueClass](path)</code>。</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#75715e">// 保存数据为 SequenceFile
</span><span style="color:#75715e"></span>  
dataRDD<span style="color:#f92672">.</span>saveAsSequenceFile<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;output&#34;</span><span style="color:#f92672">)</span>
  
<span style="color:#75715e">// 读取 SequenceFile 文件
</span><span style="color:#75715e"></span>  
sc<span style="color:#f92672">.</span>sequenceFile<span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span>,<span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;output&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
</code></pre></div></li>
<li>
<p><strong>object</strong> <strong>对象文件</strong></p>
<ul>
<li>对象文件是将对象序列化后保存的文件，采用 Java 的序列化机制。可以通过 objectFile<code>[T: ClassTag](path)</code>函数接收一个路径，读取对象文件，返回对应的 RDD，也可以通过调用saveAsObjectFile()实现对对象文件的输出。因为是序列化所以要指定类型。</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#75715e">// 保存数据
</span><span style="color:#75715e"></span>  
dataRDD<span style="color:#f92672">.</span>saveAsObjectFile<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;output&#34;</span><span style="color:#f92672">)</span>
  
<span style="color:#75715e">// 读取数据
</span><span style="color:#75715e"></span>  
sc<span style="color:#f92672">.</span>objectFile<span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;output&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
<h3 id="累加器">累加器</h3>
<h4 id="实现原理">实现原理</h4>
<ul>
<li>
<p>累加器用来把 Executor 端变量信息聚合到 Driver 端。在 Driver 程序中定义的变量，在Executor 端的每个 Task 都会得到这个变量的一份新的副本，每个 task 更新这些副本的值后，传回 Driver 端进行 merge。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">var</span> sum <span style="color:#66d9ef">=</span> <span style="color:#ae81ff">0</span>
rdd<span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>
    num <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
        sum <span style="color:#f92672">+=</span> num
    <span style="color:#f92672">}</span>
<span style="color:#f92672">)</span>
println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;sum = &#34;</span> <span style="color:#f92672">+</span> sum<span style="color:#f92672">)</span><span style="color:#75715e">//结果为0
</span></code></pre></div><p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxsn5z1mmuj30vl0lht9u.jpg" alt="QQ截图20211227200048.jpg"></p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxsn6e1iytj30ug0k9ta4.jpg" alt="QQ截图20211227200036.jpg"></p>
</li>
</ul>
<h4 id="基础编程-1">基础编程</h4>
<ul>
<li>
<p>系统累加器</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">,</span><span style="color:#ae81ff">5</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
<span style="color:#75715e">// 获取系统累加器
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">//Spark默认就提供了简单聚合的累加器
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">//sc.doubleAccumulator
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">//sc.collectionAccumulator
</span><span style="color:#75715e"></span>  
<span style="color:#66d9ef">var</span> sum <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>longAccumulator<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;sum&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
rdd<span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>
  num <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
  <span style="color:#75715e">// 使用累加器
</span><span style="color:#75715e"></span>          
  sum<span style="color:#f92672">.</span>add<span style="color:#f92672">(</span>num<span style="color:#f92672">)</span>
 <span style="color:#f92672">}</span> <span style="color:#f92672">)</span>
  
<span style="color:#75715e">// 获取累加器的值
</span><span style="color:#75715e"></span>  
println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;sum = &#34;</span> <span style="color:#f92672">+</span> sum<span style="color:#f92672">.</span>value<span style="color:#f92672">)</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">    <span style="color:#66d9ef">val</span> rdd <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">,</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
  
        <span style="color:#75715e">// 获取系统累加器
</span><span style="color:#75715e"></span>  
        <span style="color:#75715e">// Spark默认就提供了简单数据聚合的累加器
</span><span style="color:#75715e"></span>  
        <span style="color:#66d9ef">val</span> sumAcc <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>longAccumulator<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;sum&#34;</span><span style="color:#f92672">)</span>
  
        <span style="color:#66d9ef">val</span> mapRDD <span style="color:#66d9ef">=</span> rdd<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span>
            num <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
                <span style="color:#75715e">// 使用累加器
</span><span style="color:#75715e"></span>                  
                sumAcc<span style="color:#f92672">.</span>add<span style="color:#f92672">(</span>num<span style="color:#f92672">)</span>
                num
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">)</span>
  
        <span style="color:#75715e">// 获取累加器的值
</span><span style="color:#75715e"></span>  
        <span style="color:#75715e">// 少加：转换算子中调用累加器，如果没有行动算子的话，那么不会执行
</span><span style="color:#75715e"></span>  
        <span style="color:#75715e">// 多加：转换算子中调用累加器，如果没有行动算子的话，那么不会执行
</span><span style="color:#75715e"></span>  
        <span style="color:#75715e">// 一般情况下，累加器会放置在行动算子进行操作
</span><span style="color:#75715e"></span>  
        mapRDD<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        mapRDD<span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        println<span style="color:#f92672">(</span>sumAcc<span style="color:#f92672">.</span>value<span style="color:#f92672">)</span><span style="color:#75715e">//20
</span></code></pre></div></li>
<li>
<p>自定义累加器</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#75715e">// 自定义累加器
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">// 1. 继承 AccumulatorV2，并设定泛型
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">// 2. 重写累加器的抽象方法
</span><span style="color:#75715e"></span>  
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">WordCountAccumulator</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">AccumulatorV2</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">mutable</span><span style="color:#66d9ef">.</span><span style="color:#66d9ef">Map</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span>,<span style="color:#66d9ef">Long</span><span style="color:#f92672">]</span><span style="color:#f92672">]</span><span style="color:#f92672">{</span>
    <span style="color:#66d9ef">var</span> map <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">mutable.Map</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Long</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> mutable<span style="color:#f92672">.</span><span style="color:#a6e22e">Map</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    <span style="color:#75715e">// 累加器是否为初始状态
</span><span style="color:#75715e"></span>      
    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">def</span> isZero<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Boolean</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
       map<span style="color:#f92672">.</span>isEmpty
    <span style="color:#f92672">}</span>
    <span style="color:#75715e">// 复制累加器
</span><span style="color:#75715e"></span>      
    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">def</span> copy<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">AccumulatorV2</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">mutable</span><span style="color:#66d9ef">.</span><span style="color:#66d9ef">Map</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Long</span><span style="color:#f92672">]</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">{</span>
       <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">WordCountAccumulator</span>
    <span style="color:#f92672">}</span>
    <span style="color:#75715e">// 重置累加器
</span><span style="color:#75715e"></span>      
    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">def</span> reset<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
       map<span style="color:#f92672">.</span>clear<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
    <span style="color:#75715e">// 向累加器中增加数据 (In)
</span><span style="color:#75715e"></span>      
    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">def</span> add<span style="color:#f92672">(</span>word<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
         <span style="color:#75715e">// 查询 map 中是否存在相同的单词
</span><span style="color:#75715e"></span>          
         <span style="color:#75715e">// 如果有相同的单词，那么单词的数量加 1
</span><span style="color:#75715e"></span>          
         <span style="color:#75715e">// 如果没有相同的单词，那么在 map 中增加这个单词
</span><span style="color:#75715e"></span>          
         map<span style="color:#f92672">(</span>word<span style="color:#f92672">)</span> <span style="color:#66d9ef">=</span> map<span style="color:#f92672">.</span>getOrElse<span style="color:#f92672">(</span>word<span style="color:#f92672">,</span> <span style="color:#ae81ff">0L</span><span style="color:#f92672">)</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1L</span>
    <span style="color:#f92672">}</span>
    <span style="color:#75715e">// 合并累加器
</span><span style="color:#75715e"></span>      
    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">def</span> merge<span style="color:#f92672">(</span>other<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">AccumulatorV2</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">mutable</span><span style="color:#66d9ef">.</span><span style="color:#66d9ef">Map</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Long</span><span style="color:#f92672">]</span><span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> 
    <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
         <span style="color:#66d9ef">val</span> map1 <span style="color:#66d9ef">=</span> map
         <span style="color:#66d9ef">val</span> map2 <span style="color:#66d9ef">=</span> other<span style="color:#f92672">.</span>value
         <span style="color:#75715e">// 两个 Map 的合并
</span><span style="color:#75715e"></span>         map <span style="color:#66d9ef">=</span> map1<span style="color:#f92672">.</span>foldLeft<span style="color:#f92672">(</span>map2<span style="color:#f92672">)</span><span style="color:#f92672">(</span>
         <span style="color:#f92672">(</span> innerMap<span style="color:#f92672">,</span> kv <span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
          innerMap<span style="color:#f92672">(</span>kv<span style="color:#f92672">.</span>_1<span style="color:#f92672">)</span> <span style="color:#66d9ef">=</span> innerMap<span style="color:#f92672">.</span>getOrElse<span style="color:#f92672">(</span>kv<span style="color:#f92672">.</span>_1<span style="color:#f92672">,</span> <span style="color:#ae81ff">0L</span><span style="color:#f92672">)</span> <span style="color:#f92672">+</span> kv<span style="color:#f92672">.</span>_2
          innerMap
         <span style="color:#f92672">}</span>
     <span style="color:#f92672">)</span><span style="color:#f92672">}</span>
    <span style="color:#75715e">// 返回累加器的结果 （Out）
</span><span style="color:#75715e"></span>      
    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">def</span> value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">mutable.Map</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Long</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> map
<span style="color:#f92672">}</span>
</code></pre></div></li>
</ul>
<h3 id="广播变量">广播变量</h3>
<h4 id="实现原理-1">实现原理</h4>
<ul>
<li>
<p>广播变量用来高效分发较大的对象。向所有工作节点发送一个较大的只读值，以供一个或多个 Spark 操作使用。比如，如果你的应用需要向所有节点发送一个较大的只读查询表，广播变量用起来都很顺手。在多个并行操作中使用同一个变量，但是 Spark 会为每个任务分别发送。</p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxsolib2ofj31bq0iujtk.jpg" alt="QQ截图20211227204956.jpg"></p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gxsom52k5vj31bk0adabv.jpg" alt="QQ截图20211227205018.jpg"></p>
</li>
<li>
<p>基础编程</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> rdd1 <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>makeRDD<span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span>
    <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;b&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;c&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">)</span>
<span style="color:#f92672">)</span><span style="color:#f92672">)</span>
  
<span style="color:#66d9ef">val</span> map <span style="color:#66d9ef">=</span> mutable<span style="color:#f92672">.</span><span style="color:#a6e22e">Map</span><span style="color:#f92672">(</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">4</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;b&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">5</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;c&#34;</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">6</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
  
  
  
<span style="color:#75715e">// join会导致数据量几何增长，并且会影响shuffle的性能，不推荐使用
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">//val joinRDD: RDD[(String, (Int, Int))] = rdd1.join(rdd2)
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">//joinRDD.collect().foreach(println)
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">// (a, 1),    (b, 2),    (c, 3)
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">// (a, (1,4)),(b, (2,5)),(c, (3,6))
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">// 封装广播变量
</span><span style="color:#75715e"></span><span style="color:#66d9ef">val</span> bc<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Broadcast</span><span style="color:#f92672">[</span><span style="color:#66d9ef">mutable</span><span style="color:#66d9ef">.</span><span style="color:#66d9ef">Map</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> sc<span style="color:#f92672">.</span>broadcast<span style="color:#f92672">(</span>map<span style="color:#f92672">)</span>
  
rdd1<span style="color:#f92672">.</span>map <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#f92672">(</span>w<span style="color:#f92672">,</span> c<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// 方法广播变量
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">val</span> l<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span> <span style="color:#f92672">=</span> bc<span style="color:#f92672">.</span>value<span style="color:#f92672">.</span>getOrElse<span style="color:#f92672">(</span>w<span style="color:#f92672">,</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">(</span>w<span style="color:#f92672">,</span> <span style="color:#f92672">(</span>c<span style="color:#f92672">,</span> l<span style="color:#f92672">)</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span><span style="color:#f92672">.</span>collect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>foreach<span style="color:#f92672">(</span>println<span style="color:#f92672">)</span>
</code></pre></div></li>
</ul>
<h2 id="工程化代码">工程化代码</h2>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gy4cbd6bxsj31dh0oe0v3.jpg" alt="QQ截图20220106224427.jpg"></p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gy4cbko6wtj31he0y20vv.jpg" alt="QQ截图20220106224532.jpg"></p>
<p><img src="http://ww1.sinaimg.cn/large/006QQPIfly1gy4cbqawxzj31bo0pmq5q.jpg" alt="QQ截图20220106224653.jpg"></p>


                

                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/post/941sparkcore/" data-toggle="tooltip" data-placement="top" title="1、SparkCore（Spark）">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/post/943sparksql/" data-toggle="tooltip" data-placement="top" title="3、SparkSql（Spark）">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>

                
<div id="disqus-comment"></div>



            </div>
            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">标签</a></h5>
                    <div class="tags">
                        
                        
                        
                        <a href="/tags/activemq" title="activemq">
                            activemq
                        </a>
                        
                        
                        
                        <a href="/tags/ajax" title="ajax">
                            ajax
                        </a>
                        
                        
                        
                        <a href="/tags/cookie" title="cookie">
                            cookie
                        </a>
                        
                        
                        
                        <a href="/tags/datax" title="datax">
                            datax
                        </a>
                        
                        
                        
                        <a href="/tags/docker" title="docker">
                            docker
                        </a>
                        
                        
                        
                        <a href="/tags/filter" title="filter">
                            filter
                        </a>
                        
                        
                        
                        <a href="/tags/hadoop" title="hadoop">
                            hadoop
                        </a>
                        
                        
                        
                        <a href="/tags/hbase" title="hbase">
                            hbase
                        </a>
                        
                        
                        
                        <a href="/tags/hive" title="hive">
                            hive
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/java" title="java">
                            java
                        </a>
                        
                        
                        
                        <a href="/tags/javascript" title="javascript">
                            javascript
                        </a>
                        
                        
                        
                        <a href="/tags/javaweb" title="javaweb">
                            javaweb
                        </a>
                        
                        
                        
                        <a href="/tags/jdbc" title="jdbc">
                            jdbc
                        </a>
                        
                        
                        
                        <a href="/tags/jquery" title="jquery">
                            jquery
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/jsp" title="jsp">
                            jsp
                        </a>
                        
                        
                        
                        <a href="/tags/juc" title="juc">
                            juc
                        </a>
                        
                        
                        
                        <a href="/tags/jwt" title="jwt">
                            jwt
                        </a>
                        
                        
                        
                        <a href="/tags/kafka" title="kafka">
                            kafka
                        </a>
                        
                        
                        
                        <a href="/tags/linux" title="linux">
                            linux
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/maven" title="maven">
                            maven
                        </a>
                        
                        
                        
                        <a href="/tags/minio" title="minio">
                            minio
                        </a>
                        
                        
                        
                        <a href="/tags/mongodb" title="mongodb">
                            mongodb
                        </a>
                        
                        
                        
                        <a href="/tags/mybatis" title="mybatis">
                            mybatis
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/mysql" title="mysql">
                            mysql
                        </a>
                        
                        
                        
                        <a href="/tags/netty" title="netty">
                            netty
                        </a>
                        
                        
                        
                        <a href="/tags/nginx" title="nginx">
                            nginx
                        </a>
                        
                        
                        
                        <a href="/tags/react" title="react">
                            react
                        </a>
                        
                        
                        
                        <a href="/tags/redis" title="redis">
                            redis
                        </a>
                        
                        
                        
                        <a href="/tags/scala" title="scala">
                            scala
                        </a>
                        
                        
                        
                        <a href="/tags/servlet" title="servlet">
                            servlet
                        </a>
                        
                        
                        
                        <a href="/tags/session" title="session">
                            session
                        </a>
                        
                        
                        
                        <a href="/tags/shiro" title="shiro">
                            shiro
                        </a>
                        
                        
                        
                        <a href="/tags/spark" title="spark">
                            spark
                        </a>
                        
                        
                        
                        <a href="/tags/spring" title="spring">
                            spring
                        </a>
                        
                        
                        
                        <a href="/tags/springboot" title="springboot">
                            springboot
                        </a>
                        
                        
                        
                        <a href="/tags/springcloud" title="springcloud">
                            springcloud
                        </a>
                        
                        
                        
                        <a href="/tags/springmvc" title="springmvc">
                            springmvc
                        </a>
                        
                        
                        
                        <a href="/tags/springsecurity" title="springsecurity">
                            springsecurity
                        </a>
                        
                        
                        
                        <a href="/tags/tomcat" title="tomcat">
                            tomcat
                        </a>
                        
                        
                        
                        <a href="/tags/vue" title="vue">
                            vue
                        </a>
                        
                        
                        
                        <a href="/tags/xml" title="xml">
                            xml
                        </a>
                        
                        
                        
                        <a href="/tags/zookeeper" title="zookeeper">
                            zookeeper
                        </a>
                        
                        
                        
                        <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95" title="数据结构与算法">
                            数据结构与算法
                        </a>
                        
                        
                        
                        <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F" title="设计模式">
                            设计模式
                        </a>
                        
                        
                        
                        <a href="/tags/%E9%A1%B9%E7%9B%AE" title="项目">
                            项目
                        </a>
                        
                        
                    </div>
                </section>
                

                
                
                <section>
                    <hr>
                    <h5>朋友</h5>
                    <ul class="list-inline">
                        
                        <li><a target="_blank" href=""></a></li>
                        
                    </ul>
                </section>
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                 
                   
                    
                    <li>
                        <a href="mailto:1424197205@qq.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    

                    

		    
                    
                    <li>
                        <a target="_blank" href="#">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-wechat fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    <li>
                        <a target="_blank" href="https://github.com/yiguan1573">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    
                    
                    
                    
                    
            
                </ul>
		<p class="copyright text-muted">
                    Copyright &copy; 亿观的博客 2022
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






</body>
</html>
