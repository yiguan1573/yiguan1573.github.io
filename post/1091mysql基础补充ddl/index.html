<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="referrer" content="never">

    
    <meta property="og:site_name" content="亿观的博客">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://yiguan1573.github.io//img/01.jpg">
    <meta property="twitter:image" content="https://yiguan1573.github.io//img/01.jpg" />
    

    
    <meta name="title" content="21、mysql基础补充(DDL和数据类型)" />
    <meta property="og:title" content="21、mysql基础补充(DDL和数据类型)" />
    <meta property="twitter:title" content="21、mysql基础补充(DDL和数据类型)" />
    

    
    <meta name="description" content="">
    <meta property="og:description" content="" />
    <meta property="twitter:description" content="" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>21、mysql基础补充(DDL和数据类型) | yiguan1573</title>

    <link rel="canonical" href="/post/1091mysql%E5%9F%BA%E7%A1%80%E8%A1%A5%E5%85%85ddl/">

    
    
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hugo-theme-cleanwhite.min.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link href="https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome@5.15.1/css/all.css" rel="stylesheet" type="text/css">

    
    

    
    <script src="/js/jquery.min.js"></script>

    
    <script src="/js/bootstrap.min.js"></script>

    
    <script src="/js/hux-blog.min.js"></script>

    
    

</head>




<nav class="navbar navbar-default navbar-custom navbar-fixed-top">

    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">亿观的博客</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">首页</a>
                    </li>
                    
                        
                        <li>
                            <a href="/categories/%E5%AD%A6%E4%B9%A0">学习</a>
                        </li>
                        
                    
                    
		    
                        <li><a href="/top/archive/">档案</a></li>
                    
                        <li><a href="/top/about/">关于</a></li>
                    

                    
		    <li>
                        <a href="/search"><i class="fa fa-search"></i></a>
		    </li>
                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/img/04.JPG')
    }
</style>

<header class="intro-header" >

    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/mysql" title="mysql">
                            mysql
                        </a>
                        
                    </div>
                    <h1>21、mysql基础补充(DDL和数据类型)</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        
                            Posted by 
                            
                                亿观
                             
                            on 
                            Monday, November 21, 2022
                            
                                <span id="/post/1091mysql%E5%9F%BA%E7%A1%80%E8%A1%A5%E5%85%85ddl/" class="leancloud_visitors meta_data_item" data-flag-title="">
    <span class="post-meta-item-icon">
      <span class="octicon octicon-eye"></span> 
    </span>
    <i class="fa fa-eye"></i>
    <span class="old-visitors-count" style="display: none;"></span>
    <span class="leancloud-visitors-count"></span>
</span>



<script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>

<script>
	AV.initialize("", "");
</script>

<script type="text/javascript">
function showTime(Counter) {
    var query = new AV.Query(Counter);
    var entries = [];
    var $visitors = $(".leancloud_visitors");

    $visitors.each(function() {
        entries.push($(this).attr("id").trim());
    });

    query.containedIn('url', entries);
    query.find()
        .done(function(results) {
            var COUNT_CONTAINER_REF = '.leancloud-visitors-count';
            var OLD_COUNT_CONTAINER_REF = '.old-visitors-count';

            
            
            
            

            for (var i = 0; i < results.length; i++) {
                var item = results[i];
                var url = item.get('url');
                var time = item.get('time');
                var element = document.getElementById(url);

                $(element).find(COUNT_CONTAINER_REF).text(time);
            }
            for (var i = 0; i < entries.length; i++) {
                var url = entries[i];
                var element = document.getElementById(url);
                var countSpan = $(element).find(COUNT_CONTAINER_REF);
                if (countSpan.text() == '') {
                    var oldCountSpan = $(element).find(OLD_COUNT_CONTAINER_REF).text();
                    if(oldCountSpan!=''){
                        countSpan.text(0+parseInt(oldCountSpan));
                    }else{
                        countSpan.text(0);          
                    }
                }
            }
        })
        .fail(function(object, error) {
            console.log("Error: " + error.code + " " + error.message);
        });
}

function addCount(Counter) {
    var $visitors = $(".leancloud_visitors");
    var url = $visitors.attr('id').trim();
    var title = $visitors.attr('data-flag-title').trim();
    var query = new AV.Query(Counter);

    query.equalTo("url", url);
    query.find({
        success: function(results) {
            if (results.length > 0) {
                var counter = results[0];
                counter.fetchWhenSave(true);
                counter.increment("time");
                counter.save(null, {
                    success: function(counter) {
                        var $element = $(document.getElementById(url));
                        $element.find('.leancloud-visitors-count').text(counter.get('time'));
                    },
                    error: function(counter, error) {
                        console.log('Failed to save Visitor num, with error message: ' + error.message);
                    }
                });
            } else {
                var newcounter = new Counter();
                 
                var acl = new AV.ACL();
                acl.setPublicReadAccess(true);
                acl.setPublicWriteAccess(true);
                newcounter.setACL(acl);
                 
                newcounter.set("title", title);
                newcounter.set("url", url);
                var OLD_COUNT_CONTAINER_REF = '.old-visitors-count';
                var $element = $(document.getElementById(url));
                var oldCountSpan = $element.find(OLD_COUNT_CONTAINER_REF).text();
                if(oldCountSpan!=''){
                    newcounter.set("time", parseInt(oldCountSpan)+1);
                }else{
 	                    newcounter.set("time",  1);
                }
                newcounter.save(null, {
                    success: function(newcounter) {
                        var $element = $(document.getElementById(url));
                        $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
                    },
                    error: function(newcounter, error) {
                        console.log('Failed to create');
                    }
                });
            }
        },
        error: function(error) {
            console.log('Error:' + error.code + " " + error.message);
        }
    });
}
$(function() {
    var Counter = AV.Object.extend("Counter");
    
    
    if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
    } else {
        showTime(Counter);
    }
});
</script>

                            
                            
                            
                            
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                <h1 id="第十章_创建和管理表">第十章_创建和管理表</h1>
<h2 id="1-基础知识">1. 基础知识</h2>
<h3 id="1-标识符命名规则">1) 标识符命名规则</h3>
<ul>
<li>数据库名、表名不得超过30个字符，变量名限制为29个</li>
<li>必须只能包含 A–Z, a–z, 0–9, _共63个字符</li>
<li>数据库名、表名、字段名等对象名中间不要包含空格</li>
<li>同一个MySQL软件中，数据库不能同名；同一个库中，表不能重名；同一个表中，字段不能重名</li>
<li>必须保证你的字段没有和保留字、数据库系统或常用方法冲突。如果坚持使用，请在SQL语句中使 用`（着重号）引起来</li>
<li>保持字段名和类型的一致性：在命名字段并为其指定数据类型的时候一定要保证一致性，假如数据 类型在一个表里是整数，那在另一个表里可就别变成字符型了</li>
</ul>
<h3 id="2-mysql中的数据类型">2) MySQL中的数据类型</h3>
<table>
<thead>
<tr>
<th>类型</th>
<th>数据变量</th>
</tr>
</thead>
<tbody>
<tr>
<td>整数类型</td>
<td>TINYINT、SMALLINT、MEDIUMINT、INT(或INTEGER)、BIGINT</td>
</tr>
<tr>
<td>浮点类型</td>
<td>FLOAT、DOUBLE</td>
</tr>
<tr>
<td>定点数类型</td>
<td>DECIMAL</td>
</tr>
<tr>
<td>位类型</td>
<td>BIT</td>
</tr>
<tr>
<td>日期时间类型</td>
<td>YEAR、TIME、DATE、DATETIME、TIMESTAMP</td>
</tr>
<tr>
<td>文本字符串类型</td>
<td>CHAR、VARCHAR、TINYTEXT、TEXT、MEDIUMTEXT、LONGTEXT</td>
</tr>
<tr>
<td>枚举类型</td>
<td>ENUM</td>
</tr>
<tr>
<td>集合类型</td>
<td>SET</td>
</tr>
<tr>
<td>二进制字符串类型</td>
<td>BINARY、VARBINARY、TINYBLOB、BLOB、MEDIUMBLOB、LONGBLOB</td>
</tr>
<tr>
<td>JSON类型</td>
<td>JSON对象、JSON数组</td>
</tr>
<tr>
<td>空间数据类型</td>
<td>单值：GEOMETRY、POINT、LINESTRING、POLYGON； 集合：MULTIPOINT、MULTILINESTRING、MULTIPOLYGON、 GEOMETRYCOLLECTION</td>
</tr>
</tbody>
</table>
<p>其中，常用的几类类型介绍如下：</p>
<table>
<thead>
<tr>
<th>数据类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>INT</td>
<td>从-2^31到2^31-1的整型数据。存储大小为 4个字节</td>
</tr>
<tr>
<td>CHAR(size)</td>
<td>FLOAT、DOUBLE</td>
</tr>
<tr>
<td>VARCHAR(size)</td>
<td>DECIMAL</td>
</tr>
<tr>
<td>FLOAT(M,D)</td>
<td>BIT</td>
</tr>
<tr>
<td>DOUBLE(M,D)</td>
<td>YEAR、TIME、DATE、DATETIME、TIMESTAMP</td>
</tr>
<tr>
<td>DECIMAL(M,D)</td>
<td>CHAR、VARCHAR、TINYTEXT、TEXT、MEDIUMTEXT、LONGTEXT</td>
</tr>
<tr>
<td>DATE</td>
<td>ENUM</td>
</tr>
<tr>
<td>BLOB</td>
<td>SET</td>
</tr>
<tr>
<td>TEXT</td>
<td>BINARY、VARBINARY、TINYBLOB、BLOB、MEDIUMBLOB、LONGBLOB</td>
</tr>
</tbody>
</table>
<h2 id="2-创建和管理数据库">2. 创建和管理数据库</h2>
<h3 id="1-创建数据库">1) 创建数据库</h3>
<ul>
<li>
<p>方式1：创建数据库</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">DATABASE</span> 数据库名;
</code></pre></div></li>
<li>
<p>方式2：创建数据库并指定字符集</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">DATABASE</span> 数据库名 <span style="color:#ff79c6">CHARACTER</span> <span style="color:#8be9fd">SET</span> 字符集;
</code></pre></div></li>
<li>
<p>方式3：判断数据库是否已经存在，不存在则创建数据库（ 推荐 ）</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">DATABASE</span> <span style="color:#ff79c6">IF</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">EXISTS</span> 数据库名;
</code></pre></div></li>
</ul>
<p>如果MySQL中已经存在相关的数据库，则忽略创建语句，不再创建数据库。</p>
<blockquote>
<p>注意：DATABASE 不能改名。一些可视化工具可以改名，它是建新库，把所有表复制到新库，再删 旧库完成的。</p>
</blockquote>
<h3 id="2-使用数据库">2) 使用数据库</h3>
<ul>
<li>
<p>查看当前所有的数据库</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">SHOW</span> <span style="color:#ff79c6">DATABASES</span>; <span style="color:#6272a4">#有一个S，代表多个数据库
</span></code></pre></div></li>
<li>
<p>查看当前正在使用的数据库</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">DATABASE</span>(); <span style="color:#6272a4">#使用的一个 mysql 中的全局函数
</span></code></pre></div></li>
<li>
<p>查看指定库下所有的表</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">SHOW</span> <span style="color:#ff79c6">TABLES</span> <span style="color:#ff79c6">FROM</span> 数据库名
</code></pre></div></li>
<li>
<p>查看数据库的创建信息</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">SHOW</span> <span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">DATABASE</span> 数据库名;
或者：
<span style="color:#ff79c6">SHOW</span> <span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">DATABASE</span> 数据库名\G
</code></pre></div></li>
<li>
<p>使用/切换数据库</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">USE</span> 数据库名;
</code></pre></div></li>
</ul>
<blockquote>
<p>注意：要操作表格和数据之前必须先说明是对哪个数据库进行操作，否则就要对所有对象加上“数 据库名.”。</p>
</blockquote>
<h3 id="3-修改数据库">3) 修改数据库</h3>
<ul>
<li>
<p>更改数据库字符集</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">DATABASE</span> 数据库名 <span style="color:#ff79c6">CHARACTER</span> <span style="color:#8be9fd">SET</span> 字符集; <span style="color:#6272a4">#比如：gbk、utf8等
</span></code></pre></div></li>
<li>
<p>方式1：删除指定的数据库</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">DROP</span> <span style="color:#ff79c6">DATABASE</span> 数据库名;
</code></pre></div></li>
<li>
<p>方式2：删除指定的数据库（ 推荐 ）</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">DROP</span> <span style="color:#ff79c6">DATABASE</span> <span style="color:#ff79c6">IF</span> <span style="color:#ff79c6">EXISTS</span> 数据库名;
</code></pre></div></li>
</ul>
<h2 id="3-创建表">3. 创建表</h2>
<h3 id="1-创建方式1">1) 创建方式1</h3>
<ul>
<li>语法格式：</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> [<span style="color:#ff79c6">IF</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">EXISTS</span>] 表名(
字段<span style="color:#bd93f9">1</span>, 数据类型 [约束条件] [默认值],
字段<span style="color:#bd93f9">2</span>, 数据类型 [约束条件] [默认值],
字段<span style="color:#bd93f9">3</span>, 数据类型 [约束条件] [默认值],
……
[表约束条件]
);
</code></pre></div><blockquote>
<p>加上了IF NOT EXISTS关键字，则表示：如果当前数据库中不存在要创建的数据表，则创建数据表； 如果当前数据库中已经存在要创建的数据表，则忽略建表语句，不再创建数据表。</p>
</blockquote>
<h3 id="2-创建方式2">2) 创建方式2</h3>
<ul>
<li>使用 AS subquery 选项，将创建表和插入数据结合起来</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> 表名
	[(<span style="color:#ff79c6">column</span>, <span style="color:#ff79c6">column</span>, ...)]
<span style="color:#ff79c6">AS</span> subquery;
</code></pre></div><ul>
<li>指定的列和子查询中的列要一一对应</li>
<li>通过列名和默认值定义列</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> dept80
<span style="color:#ff79c6">AS</span>
<span style="color:#ff79c6">SELECT</span> employee_id, last_name, salary<span style="color:#ff79c6">*</span><span style="color:#bd93f9">12</span> ANNSAL, hire_date
<span style="color:#ff79c6">FROM</span> employees
<span style="color:#ff79c6">WHERE</span> department_id <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">80</span>;
</code></pre></div><h3 id="3-查看数据表结构">3) 查看数据表结构</h3>
<p>在MySQL中创建好数据表之后，可以查看数据表的结构。MySQL支持使用 DESCRIBE/DESC 语句查看数据 表结构，也支持使用 SHOW CREATE TABLE 语句查看数据表结构。</p>
<p>语法格式如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">SHOW</span> <span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> 表名\G
</code></pre></div><p>使用SHOW CREATE TABLE语句不仅可以查看表创建时的详细语句，还可以查看存储引擎和字符编码。</p>
<h2 id="4-修改表">4. 修改表</h2>
<p>修改表指的是修改数据库中已经存在的数据表的结构。</p>
<p>使用 ALTER TABLE 语句可以实现：</p>
<ul>
<li>向已有的表中添加列</li>
<li>修改现有表中的列</li>
<li>删除现有表中的列</li>
<li>重命名现有表中的列</li>
</ul>
<h3 id="1-追加一个列">1) 追加一个列</h3>
<p>语法格式如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> 表名 <span style="color:#ff79c6">ADD</span> 【<span style="color:#ff79c6">COLUMN</span>】 字段名 字段类型 【FIRST<span style="color:#ff79c6">|</span>AFTER 字段名】;
</code></pre></div><p>举例：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> dept80
<span style="color:#ff79c6">ADD</span> job_id <span style="color:#8be9fd">varchar</span>(<span style="color:#bd93f9">15</span>);
</code></pre></div><h3 id="2-修改一个列">2) 修改一个列</h3>
<ul>
<li>可以修改列的数据类型，长度、默认值和位置</li>
<li>修改字段数据类型、长度、默认值、位置的语法格式如下：</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> 表名 MODIFY 【<span style="color:#ff79c6">COLUMN</span>】 字段名<span style="color:#bd93f9">1</span> 字段类型 【<span style="color:#ff79c6">DEFAULT</span> 默认值】【FIRST<span style="color:#ff79c6">|</span>AFTER 字段名<span style="color:#bd93f9">2</span>】;
</code></pre></div><ul>
<li>举例：</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> dept80
MODIFY salary <span style="color:#8be9fd">double</span>(<span style="color:#bd93f9">9</span>,<span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">default</span> <span style="color:#bd93f9">1000</span>;
</code></pre></div><ul>
<li>对默认值的修改只影响今后对表的修改</li>
<li>此外，还可以通过此种方式修改列的约束。</li>
</ul>
<h3 id="3-重命名一个列">3) 重命名一个列</h3>
<p>使用 CHANGE old_column new_column dataType子句重命名列。语法格式如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> 表名 <span style="color:#ff79c6">CHANGE</span> 【<span style="color:#ff79c6">column</span>】 列名 新列名 新数据类型;
</code></pre></div><p>举例：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> dept80
<span style="color:#ff79c6">CHANGE</span> department_name dept_name <span style="color:#8be9fd">varchar</span>(<span style="color:#bd93f9">15</span>);
</code></pre></div><h3 id="4-删除一个列">4) 删除一个列</h3>
<p>删除表中某个字段的语法格式如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> 表名 <span style="color:#ff79c6">DROP</span> 【<span style="color:#ff79c6">COLUMN</span>】字段名
</code></pre></div><h3 id="5-更改表名">5) 更改表名</h3>
<ul>
<li>方式一：使用RENAME</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">RENAME</span> <span style="color:#ff79c6">TABLE</span> emp
<span style="color:#ff79c6">TO</span> myemp;
</code></pre></div><ul>
<li>方式二：</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">table</span> dept
<span style="color:#ff79c6">RENAME</span> [<span style="color:#ff79c6">TO</span>] detail_dept; <span style="color:#6272a4">-- [TO]可以省略
</span></code></pre></div><ul>
<li>必须是对象的拥有者</li>
</ul>
<h2 id="5-删除表">5. 删除表</h2>
<ul>
<li>在MySQL中，当一张数据表 没有与其他任何数据表形成关联关系 时，可以将当前数据表直接删除。</li>
<li>数据和结构都被删除</li>
<li>所有正在运行的相关事务被提交</li>
<li>所有相关索引被删除</li>
<li>语法格式：</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">DROP</span> <span style="color:#ff79c6">TABLE</span> [<span style="color:#ff79c6">IF</span> <span style="color:#ff79c6">EXISTS</span>] 数据表<span style="color:#bd93f9">1</span> [, 数据表<span style="color:#bd93f9">2</span>, …, 数据表n];
</code></pre></div><p>IF EXISTS 的含义为：如果当前数据库中存在相应的数据表，则删除数据表；如果当前数据库中不存 在相应的数据表，则忽略删除语句，不再执行删除数据表的操作。</p>
<p>举例：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">DROP</span> <span style="color:#ff79c6">TABLE</span> dept80;
</code></pre></div><ul>
<li>DROP TABLE 语句不能回滚</li>
</ul>
<h2 id="6-清空表">6. 清空表</h2>
<ul>
<li>TRUNCATE TABLE语句：
<ul>
<li>删除表中所有的数据</li>
<li>释放表的存储空间</li>
</ul>
</li>
<li>举例：</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">TRUNCATE <span style="color:#ff79c6">TABLE</span> detail_dept;
</code></pre></div><ul>
<li>TRUNCATE语句不能回滚，而使用 DELETE 语句删除数据，可以回滚</li>
</ul>
<blockquote>
<p>阿里开发规范： 【参考】TRUNCATE TABLE 比 DELETE 速度快，且使用的系统和事务日志资源少，但 TRUNCATE 无 事务且不触发 TRIGGER，有可能造成事故，故不建议在开发代码中使用此语句。 说明：TRUNCATE TABLE 在功能上与不带 WHERE 子句的 DELETE 语句相同。</p>
</blockquote>
<h2 id="7-内容扩展">7. 内容扩展</h2>
<h3 id="拓展1阿里巴巴java开发手册之mysql字段命名">拓展1：阿里巴巴《Java开发手册》之MySQL字段命名</h3>
<ul>
<li>
<p>【 强制 】表名、字段名必须使用小写字母或数字，禁止出现数字开头，禁止两个下划线中间只出 现数字。数据库字段名的修改代价很大，因为无法进行预发布，所以字段名称需要慎重考虑。</p>
<ul>
<li>正例：aliyun_admin，rdc_config，level3_name</li>
<li>反例：AliyunAdmin，rdcConfig，level_3_name</li>
</ul>
</li>
<li>
<p>【 强制 】禁用保留字，如 desc、range、match、delayed 等，请参考 MySQL 官方保留字。</p>
</li>
<li>
<p>【 强制 】表必备三字段：id, gmt_create, gmt_modified。</p>
<ul>
<li>说明：其中 id 必为主键，类型为BIGINT UNSIGNED、单表时自增、步长为 1。gmt_create, gmt_modified 的类型均为 DATETIME 类型，前者现在时表示主动式创建，后者过去分词表示被 动式更新</li>
</ul>
</li>
<li>
<p>【 推荐 】表的命名最好是遵循 “业务名称_表的作用”。</p>
<ul>
<li>正例：alipay_task 、 force_project、 trade_config</li>
</ul>
</li>
<li>
<p>【 推荐 】库名与应用名称尽量一致。</p>
</li>
<li>
<p>【参考】合适的字符存储长度，不但节约数据库表空间、节约索引存储，更重要的是提升检索速度。</p>
<ul>
<li>正例：无符号值可以避免误存负数，且扩大了表示范围。</li>
</ul>
</li>
</ul>
<h3 id="扩展2操作注意要求">扩展2：操作注意要求</h3>
<ul>
<li>表删除 操作将把表的定义和表中的数据一起删除，并且MySQL在执行删除操作时，不会有任何的确认信 息提示，因此执行删除操时应当慎重。在删除表前，最好对表中的数据进行 备份 ，这样当操作失误时可 以对数据进行恢复，以免造成无法挽回的后果。</li>
<li>同样的，在使用 ALTER TABLE 进行表的基本修改操作时，在执行操作过程之前，也应该确保对数据进 行完整的 备份 ，因为数据库的改变是 无法撤销 的，如果添加了一个不需要的字段，可以将其删除；相 同的，如果删除了一个需要的列，该列下面的所有数据都将会丢失。</li>
</ul>
<h3 id="扩展3mysql8新特性ddl的原子化">扩展3：MySQL8新特性—DDL的原子化</h3>
<p>在MySQL 8.0版本中，InnoDB表的DDL支持事务完整性，即 DDL操作要么成功要么回滚 。DDL操作回滚日志 写入到data dictionary数据字典表mysql.innodb_ddl_log（该表是隐藏的表，通过show tables无法看到） 中，用于回滚操作。通过设置参数，可将DDL操作日志打印输出到MySQL错误日志中。</p>
<h1 id="第12章_mysql数据类型精讲">第12章_MySQL数据类型精讲</h1>
<h2 id="1-mysql中的数据类型">1. MySQL中的数据类型</h2>
<table>
<thead>
<tr>
<th>类型</th>
<th>举例</th>
</tr>
</thead>
<tbody>
<tr>
<td>整数类型</td>
<td>TINYINT、SMALLINT、MEDIUMINT、INT(或INTEGER)、BIGINT</td>
</tr>
<tr>
<td>浮点类型</td>
<td>FLOAT、DOUBLE</td>
</tr>
<tr>
<td>定点数类型</td>
<td>DECIMAL</td>
</tr>
<tr>
<td>位类型</td>
<td>BIT</td>
</tr>
<tr>
<td>日期时间类型</td>
<td>YEAR、TIME、DATE、DATETIME、TIMESTAMP</td>
</tr>
<tr>
<td>文本字符串类型</td>
<td>CHAR、VARCHAR、TINYTEXT、TEXT、MEDIUMTEXT、LONGTEXT</td>
</tr>
<tr>
<td>枚举类型</td>
<td>ENUM</td>
</tr>
<tr>
<td>集合类型</td>
<td>SET</td>
</tr>
<tr>
<td>二进制字符串类型</td>
<td>BINARY、VARBINARY、TINYBLOB、BLOB、MEDIUMBLOB、LONGBLOB</td>
</tr>
<tr>
<td>JSON类型</td>
<td>JSON对象、JSON数组</td>
</tr>
<tr>
<td>空间数据类型</td>
<td>单值类型：GEOMETRY、POINT、LINESTRING、POLYGON； 集合类型：MULTIPOINT、MULTILINESTRING、MULTIPOLYGON、 GEOMETRYCOLLECTION</td>
</tr>
</tbody>
</table>
<p>常见数据类型的属性，如下：</p>
<table>
<thead>
<tr>
<th>MySQL关键字</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>NULL</td>
<td>TINYINT、SMALLINT、MEDIUMINT、INT(或INTEGER)、BIGINT</td>
</tr>
<tr>
<td>NOT NULL</td>
<td>FLOAT、DOUBLE</td>
</tr>
<tr>
<td>DEFAULT</td>
<td>DECIMAL</td>
</tr>
<tr>
<td>PRIMARY KEY</td>
<td>BIT</td>
</tr>
<tr>
<td>AUTO_INCREMENT</td>
<td>YEAR、TIME、DATE、DATETIME、TIMESTAMP</td>
</tr>
<tr>
<td>UNSIGNED</td>
<td>CHAR、VARCHAR、TINYTEXT、TEXT、MEDIUMTEXT、LONGTEXT</td>
</tr>
<tr>
<td>CHARACTER SET name</td>
<td>ENUM</td>
</tr>
</tbody>
</table>
<h2 id="2-整数类型">2. 整数类型</h2>
<h3 id="1-类型介绍">1) 类型介绍</h3>
<p>整数类型一共有 5 种，包括 TINYINT、SMALLINT、MEDIUMINT、INT（INTEGER）和 BIGINT。</p>
<p>它们的区别如下表所示：</p>
<table>
<thead>
<tr>
<th>整数类型</th>
<th>字节</th>
<th>有符号数取值范围</th>
<th>无符号数取值范围</th>
</tr>
</thead>
<tbody>
<tr>
<td>TINYINT</td>
<td>1</td>
<td>-128~127</td>
<td>0~255</td>
</tr>
<tr>
<td>SMALLINT</td>
<td>2</td>
<td>-32768~32767</td>
<td>0~65535</td>
</tr>
<tr>
<td>MEDIUMINT</td>
<td>3</td>
<td>-8388608~8388607</td>
<td>0~16777215</td>
</tr>
<tr>
<td>INT、INTEGER</td>
<td>4</td>
<td>-2147483648~2147483647</td>
<td>0~4294967295</td>
</tr>
<tr>
<td>BIGINT</td>
<td>8</td>
<td>-9223372036854775808~9223372036854775807</td>
<td>0~18446744073709551615</td>
</tr>
</tbody>
</table>
<h3 id="2-可选属性">2) 可选属性</h3>
<p>整数类型的可选属性有三个：</p>
<ul>
<li>M</li>
</ul>
<p>M : 表示显示宽度，M的取值范围是(0, 255)。例如，int(5)：当数据宽度小于5位的时候在数字前面需要用 字符填满宽度。该项功能需要配合“ ZEROFILL ”使用，表示用“0”填满宽度，否则指定显示宽度无效。 如果设置了显示宽度，那么插入的数据宽度超过显示宽度限制，会不会截断或插入失败？</p>
<p>答案：不会对插入的数据有任何影响，还是按照类型的实际宽度进行保存，即 显示宽度与类型可以存储的 值范围无关 。从MySQL 8.0.17开始，整数数据类型不推荐使用显示宽度属性。 整型数据类型可以在定义表结构时指定所需要的显示宽度，如果不指定，则系统为每一种类型指定默认 的宽度值。</p>
<p>举例：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#50fa7b">test_int1</span> ( x <span style="color:#8be9fd">TINYINT</span>, y <span style="color:#8be9fd">SMALLINT</span>, z <span style="color:#8be9fd">MEDIUMINT</span>, m <span style="color:#8be9fd">INT</span>, n <span style="color:#8be9fd">BIGINT</span> );
</code></pre></div><p>查看表结构 （MySQL5.7中显式如下，MySQL8中不再显式范围）</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">desc</span> test_int1;
<span style="color:#ff79c6">+</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">+</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">+</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">+</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">+</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">+</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">+</span>
<span style="color:#ff79c6">|</span> Field <span style="color:#ff79c6">|</span> Type <span style="color:#ff79c6">|</span> Null <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Key</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Default</span> <span style="color:#ff79c6">|</span> Extra <span style="color:#ff79c6">|</span>
<span style="color:#ff79c6">+</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">+</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">+</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">+</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">+</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">+</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">+</span>
<span style="color:#ff79c6">|</span> x <span style="color:#ff79c6">|</span> <span style="color:#8be9fd">tinyint</span>(<span style="color:#bd93f9">4</span>) <span style="color:#ff79c6">|</span> YES <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span> NULL <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span>
<span style="color:#ff79c6">|</span> y <span style="color:#ff79c6">|</span> <span style="color:#8be9fd">smallint</span>(<span style="color:#bd93f9">6</span>) <span style="color:#ff79c6">|</span> YES <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span> NULL <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span>
<span style="color:#ff79c6">|</span> z <span style="color:#ff79c6">|</span> <span style="color:#8be9fd">mediumint</span>(<span style="color:#bd93f9">9</span>) <span style="color:#ff79c6">|</span> YES <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span> NULL <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span>
<span style="color:#ff79c6">|</span> m <span style="color:#ff79c6">|</span> <span style="color:#8be9fd">int</span>(<span style="color:#bd93f9">11</span>) <span style="color:#ff79c6">|</span> YES <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span> NULL <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span>
<span style="color:#ff79c6">|</span> n <span style="color:#ff79c6">|</span> <span style="color:#8be9fd">bigint</span>(<span style="color:#bd93f9">20</span>) <span style="color:#ff79c6">|</span> YES <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span> NULL <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span>
<span style="color:#ff79c6">+</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">+</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">+</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">+</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">+</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">+</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">+</span>
<span style="color:#bd93f9">5</span> rows <span style="color:#ff79c6">in</span> <span style="color:#8be9fd">set</span> (<span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">00</span> sec)
</code></pre></div><p>TINYINT有符号数和无符号数的取值范围分别为-128~127和0~255，由于负号占了一个数字位，因此 TINYINT默认的显示宽度为4。同理，其他整数类型的默认显示宽度与其有符号数的最小值的宽度相同。</p>
<ul>
<li>UNSIGNED</li>
</ul>
<p>UNSIGNED : 无符号类型（非负），所有的整数类型都有一个可选的属性UNSIGNED（无符号属性），无 符号整数类型的最小取值为0。所以，如果需要在MySQL数据库中保存非负整数值时，可以将整数类型设 置为无符号类型。 int类型默认显示宽度为int(11)，无符号int类型默认显示宽度为int(10)。</p>
<ul>
<li>ZEROFILL</li>
</ul>
<p>ZEROFILL : 0填充,（如果某列是ZEROFILL，那么MySQL会自动为当前列添加UNSIGNED属性），如果指 定了ZEROFILL只是表示不够M位时，用0在左边填充，如果超过M位，只要不超过数据存储范围即可。</p>
<p>原来，在 int(M) 中，M 的值跟 int(M) 所占多少存储空间并无任何关系。 int(3)、int(4)、int(8) 在磁盘上都 是占用 4 bytes 的存储空间。也就是说，int(M)，必须和UNSIGNED ZEROFILL一起使用才有意义。如果整 数值超过M位，就按照实际位数存储。只是无须再用字符 0 进行填充。</p>
<h3 id="3-适用场景">3) 适用场景</h3>
<p>TINYINT ：一般用于枚举数据，比如系统设定取值范围很小且固定的场景。</p>
<p>SMALLINT ：可以用于较小范围的统计数据，比如统计工厂的固定资产库存数量等。</p>
<p>MEDIUMINT ：用于较大整数的计算，比如车站每日的客流量等。</p>
<p>INT、INTEGER ：取值范围足够大，一般情况下不用考虑超限问题，用得最多。比如商品编号。</p>
<p>BIGINT ：只有当你处理特别巨大的整数时才会用到。比如双十一的交易量、大型门户网站点击量、证 券公司衍生产品持仓等。</p>
<h3 id="4-如何选择">4) 如何选择？</h3>
<p>在评估用哪种整数类型的时候，你需要考虑 存储空间 和 可靠性 的平衡问题：一方 面，用占用字节数少 的整数类型可以节省存储空间；另一方面，要是为了节省存储空间， 使用的整数类型取值范围太小，一 旦遇到超出取值范围的情况，就可能引起 系统错误 ，影响可靠性。</p>
<p>举个例子，商品编号采用的数据类型是 INT。原因就在于，客户门店中流通的商品种类较多，而且，每 天都有旧商品下架，新商品上架，这样不断迭代，日积月累。</p>
<p>如果使用 SMALLINT 类型，虽然占用字节数比 INT 类型的整数少，但是却不能保证数据不会超出范围 65535。相反，使用 INT，就能确保有足够大的取值范围，不用担心数据超出范围影响可靠性的问题。</p>
<p>你要注意的是，在实际工作中，系统故障产生的成本远远超过增加几个字段存储空间所产生的成本。因 此，我建议你首先确保数据不会超过取值范围，在这个前提之下，再去考虑如何节省存储空间。</p>
<h2 id="3-浮点类型">3. 浮点类型</h2>
<h3 id="1-类型介绍-1">1) 类型介绍</h3>
<p>浮点数和定点数类型的特点是可以 处理小数 ，你可以把整数看成小数的一个特例。因此，浮点数和定点 数的使用场景，比整数大多了。 MySQL支持的浮点数类型，分别是 FLOAT、DOUBLE、REAL。</p>
<ul>
<li>
<p>FLOAT 表示单精度浮点数；</p>
</li>
<li>
<p>DOUBLE 表示双精度浮点数；</p>
</li>
<li>
<p>REAL默认就是 DOUBLE。如果你把 SQL 模式设定为启用“ REAL_AS_FLOAT ”，那 么，MySQL 就认为 REAL 是 FLOAT。如果要启用“REAL_AS_FLOAT”，可以通过以下 SQL 语句实现：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#8be9fd">SET</span> sql_mode <span style="color:#ff79c6">=</span> “REAL_AS_FLOAT”;
</code></pre></div></li>
</ul>
<p><strong>问题：为什么浮点数类型的无符号数取值范围，只相当于有符号数取值范围的一半，也就是只相当于 有符号数取值范围大于等于零的部分呢？</strong></p>
<p>MySQL 存储浮点数的格式为： 符号(S) 、 尾数(M) 和 阶码(E) 。因此，无论有没有符号，MySQL 的浮 点数都会存储表示符号的部分。因此， 所谓的无符号数取值范围，其实就是有符号数取值范围大于等于 零的部分。</p>
<h3 id="2-数据精度说明">2) 数据精度说明</h3>
<p>对于浮点类型，在MySQL中单精度值使用 4 个字节，双精度值使用 8 个字节。</p>
<ul>
<li>
<p>MySQL允许使用 非标准语法 （其他数据库未必支持，因此如果涉及到数据迁移，则最好不要这么 用）： FLOAT(M,D) 或 DOUBLE(M,D) 。这里，M称为 精度 ，D称为 标度 。(M,D)中 M=整数位+小数 位，D=小数位。 D&lt;=M&lt;=255，0&lt;=D&lt;=30。</p>
<p>例如，定义为FLOAT(5,2)的一个列可以显示为-999.99-999.99。如果超过这个范围会报错。</p>
</li>
<li>
<p>FLOAT和DOUBLE类型在不指定(M,D)时，默认会按照实际的精度（由实际的硬件和操作系统决定） 来显示。</p>
</li>
<li>
<p>说明：浮点类型，也可以加 UNSIGNED ，但是不会改变数据范围，例如：FLOAT(3,2) UNSIGNED仍然 只能表示0-9.99的范围。</p>
</li>
<li>
<p>不管是否显式设置了精度(M,D)，这里MySQL的处理方案如下：</p>
<ul>
<li>如果存储时，整数部分超出了范围，MySQL就会报错，不允许存这样的值</li>
<li>如果存储时，小数点部分若超出范围，就分以下情况：
<ul>
<li>若四舍五入后，整数部分没有超出范围，则只警告，但能成功操作并四舍五入删除多余 的小数位后保存。例如在FLOAT(5,2)列内插入999.009，近似结果是999.01。</li>
<li>若四舍五入后，整数部分超出范围，则MySQL报错，并拒绝处理。如FLOAT(5,2)列内插入 999.995和-999.995都会报错。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>从MySQL 8.0.17开始，FLOAT(M,D) 和DOUBLE(M,D)用法在官方文档中已经明确不推荐使用，将来可 能被移除。另外，关于浮点型FLOAT和DOUBLE的UNSIGNED也不推荐使用了，将来也可能被移除。</p>
</li>
</ul>
<h3 id="3-精度误差说明">3) 精度误差说明</h3>
<p>浮点数类型有个缺陷，就是不精准。下面我来重点解释一下为什么 MySQL 的浮点数不够精准。比如，我 们设计一个表，有f1这个字段，插入值分别为0.47,0.44,0.19，我们期待的运行结果是：0.47 + 0.44 + 0.19 = 1.1。而使用sum之后查询：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#50fa7b">test_double2</span>(
f1 <span style="color:#8be9fd">DOUBLE</span>
);
<span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> test_double2
<span style="color:#ff79c6">VALUES</span>(<span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">47</span>),(<span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">44</span>),(<span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">19</span>);
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">SELECT</span> <span style="color:#50fa7b">SUM</span>(f1)
<span style="color:#ff79c6">-</span><span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">FROM</span> test_double2;
<span style="color:#ff79c6">+</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">+</span>
<span style="color:#ff79c6">|</span> <span style="color:#50fa7b">SUM</span>(f1) <span style="color:#ff79c6">|</span>
<span style="color:#ff79c6">+</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">+</span>
<span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1</span>.<span style="color:#bd93f9">0999999999999999</span> <span style="color:#ff79c6">|</span>
<span style="color:#ff79c6">+</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">+</span>
<span style="color:#bd93f9">1</span> row <span style="color:#ff79c6">in</span> <span style="color:#8be9fd">set</span> (<span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">00</span> sec)
</code></pre></div><p>查询结果是 1.0999999999999999。看到了吗？虽然误差很小，但确实有误差。 你也可以尝试把数据类型 改成 FLOAT，然后运行求和查询，得到的是， 1.0999999940395355。显然，误差更大了。</p>
<p>那么，为什么会存在这样的误差呢？问题还是出在 MySQL 对浮点类型数据的存储方式上。</p>
<p>MySQL 用 4 个字节存储 FLOAT 类型数据，用 8 个字节来存储 DOUBLE 类型数据。无论哪个，都是采用二 进制的方式来进行存储的。比如 9.625，用二进制来表达，就是 1001.101，或者表达成 1.001101×2^3。如 果尾数不是 0 或 5（比如 9.624），你就无法用一个二进制数来精确表达。进而，就只好在取值允许的范 围内进行四舍五入。</p>
<p>在编程中，如果用到浮点数，要特别注意误差问题，因为浮点数是不准确的，所以我们要避免使用“=”来 判断两个数是否相等。同时，在一些对精确度要求较高的项目中，千万不要使用浮点数，不然会导致结 果错误，甚至是造成不可挽回的损失。那么，MySQL 有没有精准的数据类型呢？当然有，这就是定点数 类型： DECIMAL 。</p>
<h2 id="4-定点数类型">4. 定点数类型</h2>
<h3 id="1-类型介绍-2">1) 类型介绍</h3>
<ul>
<li>MySQL中的定点数类型只有 DECIMAL 一种类型。</li>
</ul>
<table>
<thead>
<tr>
<th>类型</th>
<th>字节</th>
<th>有符号数取值范围</th>
</tr>
</thead>
<tbody>
<tr>
<td>DECIMAL(M,D),DEC,NUMERIC</td>
<td>M+2字节</td>
<td>有效范围由M和D决定</td>
</tr>
</tbody>
</table>
<p>使用 DECIMAL(M,D) 的方式表示高精度小数。其中，M被称为精度，D被称为标度。0&lt;=M&lt;=65， 0&lt;=D&lt;=30，D</p>
<ul>
<li>DECIMAL(M,D)的最大取值范围与DOUBLE类型一样，但是有效的数据范围是由M和D决定的。 DECIMAL 的存储空间并不是固定的，由精度值M决定，总共占用的存储空间为M+2个字节。也就是 说，在一些对精度要求不高的场景下，比起占用同样字节长度的定点数，浮点数表达的数值范围可 以更大一些。</li>
<li>定点数在MySQL内部是以 字符串 的形式进行存储，这就决定了它一定是精准的。</li>
<li>当DECIMAL类型不指定精度和标度时，其默认为DECIMAL(10,0)。当数据的精度超出了定点数类型的 精度范围时，则MySQL同样会进行四舍五入处理。</li>
<li>浮点数 vs 定点数
<ul>
<li>浮点数相对于定点数的优点是在长度一定的情况下，浮点类型取值范围大，但是不精准，适用 于需要取值范围大，又可以容忍微小误差的科学计算场景（比如计算化学、分子建模、流体动 力学等）</li>
<li>定点数类型取值范围相对小，但是精准，没有误差，适合于对精度要求极高的场景 （比如涉 及金额计算的场景）</li>
</ul>
</li>
</ul>
<h3 id="2-开发中的经验">2) 开发中的经验</h3>
<p>“由于 DECIMAL 数据类型的精准性，在我们的项目中，除了极少数（比如商品编号）用到整数类型 外，其他的数值都用的是 DECIMAL，原因就是这个项目所处的零售行业，要求精准，一分钱也不能 差。 ” ——来自某项目经理</p>
<h2 id="5-位类型bit">5. 位类型：BIT</h2>
<p>BIT类型中存储的是二进制值，类似010110。</p>
<table>
<thead>
<tr>
<th>二进制字符串类型</th>
<th>长度</th>
<th>长度范围</th>
<th>占用空间</th>
</tr>
</thead>
<tbody>
<tr>
<td>BIT(M)</td>
<td>M</td>
<td>1 &lt;= M &lt;= 64</td>
<td>约为(M + 7)/8个字节</td>
</tr>
</tbody>
</table>
<p>BIT类型，如果没有指定(M)，默认是1位。这个1位，表示只能存1位的二进制值。这里(M)是表示二进制的 位数，位数最小值为1，最大值为64。</p>
<h2 id="6-日期与时间类型">6. 日期与时间类型</h2>
<p>日期与时间是重要的信息，在我们的系统中，几乎所有的数据表都用得到。原因是客户需要知道数据的 时间标签，从而进行数据查询、统计和处理。</p>
<p>MySQL有多种表示日期和时间的数据类型，不同的版本可能有所差异，MySQL8.0版本支持的日期和时间 类型主要有：YEAR类型、TIME类型、DATE类型、DATETIME类型和TIMESTAMP类型。</p>
<ul>
<li>YEAR 类型通常用来表示年</li>
<li>DATE 类型通常用来表示年、月、日</li>
<li>TIME 类型通常用来表示时、分、秒</li>
<li>DATETIME 类型通常用来表示年、月、日、时、分、秒</li>
<li>TIMESTAMP 类型通常用来表示带时区的年、月、日、时、分、秒</li>
</ul>
<table>
<thead>
<tr>
<th>类型</th>
<th>名称</th>
<th>字节</th>
<th>日期格式</th>
<th>最小值</th>
<th>最大值</th>
</tr>
</thead>
<tbody>
<tr>
<td>YEAR</td>
<td>年</td>
<td>1</td>
<td>YYYY或YY</td>
<td>1901</td>
<td>2155</td>
</tr>
<tr>
<td>TIME</td>
<td>时间</td>
<td>3</td>
<td>HH:MM:SS</td>
<td>-838:59:59</td>
<td>838:59:59</td>
</tr>
<tr>
<td>DATE</td>
<td>日期</td>
<td>3</td>
<td>YYYY-MM-DD</td>
<td>1000-01-01</td>
<td>9999-12-03</td>
</tr>
<tr>
<td>DATETIME</td>
<td>日期时间</td>
<td>8</td>
<td>YYYY-MM-DD HH:MM:SS</td>
<td>1000-01-01 00:00:00</td>
<td>9999-12-31 23:59:59</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>日期时间</td>
<td>4</td>
<td>YYYY-MM-DD HH:MM:SS</td>
<td>1970-01-01 00:00:00 UTC</td>
<td>2038-01-19 03:14:07UTC</td>
</tr>
</tbody>
</table>
<p>可以看到，不同数据类型表示的时间内容不同、取值范围不同，而且占用的字节数也不一样，你要根据 实际需要灵活选取。</p>
<p>为什么时间类型 TIME 的取值范围不是 -23:59:59～23:59:59 呢？原因是 MySQL 设计的 TIME 类型，不光表 示一天之内的时间，而且可以用来表示一个时间间隔，这个时间间隔可以超过 24 小时。</p>
<h2 id="7-文本字符串类型">7. 文本字符串类型</h2>
<p>MySQL中，文本字符串总体上分为 CHAR 、 VARCHAR 、 TINYTEXT 、 TEXT 、 MEDIUMTEXT 、 LONGTEXT 、 ENUM 、 SET 等类型。</p>
<h2 id="8-enum类型">8. ENUM类型</h2>
<p>ENUM类型也叫作枚举类型，ENUM类型的取值范围需要在定义字段时进行指定。设置字段值时，ENUM 类型只允许从成员中选取单个值，不能一次选取多个值。 其所需要的存储空间由定义ENUM类型时指定的成员个数决定。</p>
<table>
<thead>
<tr>
<th>文本字符串类型</th>
<th>长度</th>
<th>长度范围</th>
<th>占用的存储空间</th>
</tr>
</thead>
<tbody>
<tr>
<td>ENUM</td>
<td>L</td>
<td>1 &lt;= L &lt;= 65535</td>
<td>1或2个字节</td>
</tr>
</tbody>
</table>
<ul>
<li>当ENUM类型包含1～255个成员时，需要1个字节的存储空间；</li>
<li>当ENUM类型包含256～65535个成员时，需要2个字节的存储空间。</li>
<li>ENUM类型的成员个数的上限为65535个。</li>
</ul>
<h2 id="9-set类型">9. SET类型</h2>
<p>当SET类型包含的成员个数不同时，其所占用的存储空间也是不同的，具体如下：</p>
<table>
<thead>
<tr>
<th>成员个数范围（L表示实际成员个数）</th>
<th>占用的存储空间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 &lt;= L &lt;= 8</td>
<td>1个字节</td>
</tr>
<tr>
<td>9 &lt;= L &lt;= 16</td>
<td>2个字节</td>
</tr>
<tr>
<td>17 &lt;= L &lt;= 24</td>
<td>3个字节</td>
</tr>
<tr>
<td>25 &lt;= L &lt;= 32</td>
<td>4个字节</td>
</tr>
<tr>
<td>33 &lt;= L &lt;= 64</td>
<td>8个字节</td>
</tr>
</tbody>
</table>
<p>SET类型在存储数据时成员个数越多，其占用的存储空间越大。注意：SET类型在选取成员时，可以一次 选择多个成员，这一点与ENUM类型不同。</p>
<h2 id="13-小结及选择建议">13. 小结及选择建议</h2>
<p>在定义数据类型时，如果确定是 整数 ，就用 INT ； 如果是 小数 ，一定用定点数类型 DECIMAL(M,D) ； 如果是日期与时间，就用 DATETIME 。 这样做的好处是，首先确保你的系统不会因为数据类型定义出错。不过，凡事都是有两面的，可靠性 好，并不意味着高效。比如，TEXT 虽然使用方便，但是效率不如 CHAR(M) 和 VARCHAR(M)。</p>
<p><strong>阿里巴巴《Java开发手册》之MySQL数据库：</strong></p>
<ul>
<li>
<p>任何字段如果为非负数，必须是 UNSIGNED</p>
</li>
<li>
<p>【 强制 】小数类型为 DECIMAL，禁止使用 FLOAT 和 DOUBLE。</p>
<p>说明：在存储的时候，FLOAT 和 DOUBLE 都存在精度损失的问题，很可能在比较值的时候，得到不正确的结果。如果存储的数据范围超过 DECIMAL 的范围，建议将数据拆成整数和小数并分开存储。</p>
</li>
<li>
<p>【 强制 】如果存储的字符串长度几乎相等，使用 CHAR 定长字符串类型。</p>
</li>
<li>
<p>【 强制 】VARCHAR 是可变长字符串，不预先分配存储空间，长度不要超过 5000。如果存储长度大于此值，定义字段类型为 TEXT，独立出来一张表，用主键来对应，避免影响其它字段索引效率。</p>
</li>
</ul>
<h1 id="第13章_约束">第13章_约束</h1>
<h2 id="1-约束的分类">1. 约束的分类</h2>
<ul>
<li>根据约束数据列的限制，约束可分为：
<ul>
<li>单列约束：每个约束只约束一列</li>
<li>多列约束：每个约束可约束多列数据</li>
</ul>
</li>
<li>根据约束的作用范围，约束可分为：
<ul>
<li>列级约束：只能作用在一个列上，跟在列的定义后面</li>
<li>表级约束：可以作用在多个列上，不与列一起，而是单独定义</li>
</ul>
</li>
<li>根据约束起的作用，约束可分为：
<ul>
<li>NOT NULL 非空约束，规定某个字段不能为空</li>
<li>UNIQUE 唯一约束，规定某个字段在整个表中是唯一的</li>
<li>PRIMARY KEY 主键(非空且唯一)约束</li>
<li>FOREIGN KEY 外键约束</li>
<li>CHECK 检查约束</li>
<li>DEFAULT 默认值约束</li>
</ul>
</li>
</ul>
<blockquote>
<p>注意： MySQL不支持check约束，但可以使用check约束，而没有任何效果</p>
</blockquote>
<ul>
<li>如何添加/ 删除约束？</li>
</ul>
<p>CREATE TABLE时添加约束</p>
<p>ALTER TABLE时增加约束、删除约束</p>
<ul>
<li>查看某个表已有的约束</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#6272a4">#information_schema数据库名（系统库）
</span><span style="color:#6272a4"></span><span style="color:#6272a4">#table_constraints表名称（专门存储各个表的约束）
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> information_schema.table_constraints
<span style="color:#ff79c6">WHERE</span> table_name <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">表名称</span><span style="color:#f1fa8c">&#39;</span>;
</code></pre></div><h2 id="2-非空约束">2. 非空约束</h2>
<h3 id="1-作用">1) 作用</h3>
<p>限定某个字段/ 某列的值不允许为空</p>
<h3 id="2-关键字">2) 关键字</h3>
<p>NOT NULL</p>
<h3 id="3-特点">3) 特点</h3>
<ul>
<li>默认，所有的类型的值都可以是NULL，包括INT、FLOAT等数据类型</li>
<li>非空约束只能出现在表对象的列上，只能某个列单独限定非空，不能组合非空</li>
<li>一个表可以有很多列都分别限定了非空</li>
<li>空字符串'&lsquo;不等于NULL，0也不等于NULL</li>
</ul>
<h3 id="4-添加非空约束">4) 添加非空约束</h3>
<p><strong>1. 建表时</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> 表名称(
字段名 数据类型,
字段名 数据类型 <span style="color:#ff79c6">NOT</span> NULL,
字段名 数据类型 <span style="color:#ff79c6">NOT</span> NULL
);
</code></pre></div><p><strong>2. 建表后</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">alter</span> <span style="color:#ff79c6">table</span> 表名称 modify 字段名 数据类型 <span style="color:#ff79c6">not</span> null;
</code></pre></div><h3 id="5-删除非空约束">5) 删除非空约束</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">alter</span> <span style="color:#ff79c6">table</span> 表名称 modify 字段名 数据类型 NULL;<span style="color:#6272a4">#去掉not null，相当于修改某个非注解字段，该字段允许为空
</span><span style="color:#6272a4"></span>或
<span style="color:#ff79c6">alter</span> <span style="color:#ff79c6">table</span> 表名称 modify 字段名 数据类型;<span style="color:#6272a4">#去掉not null，相当于修改某个非注解字段，该字段允许为空
</span></code></pre></div><h2 id="3-唯一性约束">3. 唯一性约束</h2>
<h3 id="1-作用-1">1) 作用</h3>
<p>用来限制某个字段/某列的值不能重复。</p>
<h3 id="2-关键字-1">2) 关键字</h3>
<p>UNIQUE</p>
<h3 id="3-特点-1">3) 特点</h3>
<ul>
<li>同一个表可以有多个唯一约束。</li>
<li>唯一约束可以是某一个列的值唯一，也可以多个列组合的值唯一。</li>
<li>唯一性约束允许列值为空。</li>
<li>在创建唯一约束的时候，如果不给唯一约束命名，就默认和列名相同。</li>
<li>MySQL会给唯一约束的列上默认创建一个唯一索引。</li>
</ul>
<h3 id="4-添加唯一约束">4) 添加唯一约束</h3>
<p><strong>1. 建表时</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> 表名称(
字段名 数据类型,
字段名 数据类型 <span style="color:#ff79c6">unique</span>,
字段名 数据类型 <span style="color:#ff79c6">unique</span> <span style="color:#ff79c6">key</span>,
字段名 数据类型
);

<span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> 表名称(
字段名 数据类型,
字段名 数据类型,
字段名 数据类型,
[<span style="color:#ff79c6">constraint</span> 约束名] <span style="color:#ff79c6">unique</span> <span style="color:#ff79c6">key</span>(字段名)
);
</code></pre></div><p>举例：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">USER</span>(
id <span style="color:#8be9fd">INT</span> <span style="color:#ff79c6">NOT</span> NULL,
NAME <span style="color:#8be9fd">VARCHAR</span>(<span style="color:#bd93f9">25</span>),
PASSWORD <span style="color:#8be9fd">VARCHAR</span>(<span style="color:#bd93f9">16</span>),
<span style="color:#6272a4">-- 使用表级约束语法
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">CONSTRAINT</span> uk_name_pwd <span style="color:#ff79c6">UNIQUE</span>(NAME,PASSWORD)
);
</code></pre></div><blockquote>
<p>表示用户名和密码组合不能重复</p>
</blockquote>
<p><strong>2. 建表后指定唯一键约束</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#6272a4">#字段列表中如果是一个字段，表示该列的值唯一。如果是两个或更多个字段，那么复合唯一，即多个字段的组合是唯
</span><span style="color:#6272a4"></span>一的
<span style="color:#6272a4">#方式1：
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">alter</span> <span style="color:#ff79c6">table</span> 表名称 <span style="color:#ff79c6">add</span> <span style="color:#ff79c6">unique</span> <span style="color:#ff79c6">key</span>(字段列表);
<span style="color:#6272a4">#方式2：
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">alter</span> <span style="color:#ff79c6">table</span> 表名称 modify 字段名 字段类型 <span style="color:#ff79c6">unique</span>;
</code></pre></div><h3 id="5-关于复合唯一约束">5) 关于复合唯一约束</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> 表名称(
字段名 数据类型,
字段名 数据类型,
字段名 数据类型,
<span style="color:#ff79c6">unique</span> <span style="color:#ff79c6">key</span>(字段列表) <span style="color:#6272a4">#字段列表中写的是多个字段名，多个字段名用逗号分隔，表示那么是复合唯一，即多
</span><span style="color:#6272a4"></span>个字段的组合是唯一的
);
</code></pre></div><h3 id="6-删除唯一约束">6) 删除唯一约束</h3>
<ul>
<li>添加唯一性约束的列上也会自动创建唯一索引。</li>
<li>删除唯一约束只能通过删除唯一索引的方式删除。</li>
<li>删除时需要指定唯一索引名，唯一索引名就和唯一约束名一样。</li>
<li>如果创建唯一约束时未指定名称，如果是单列，就默认和列名相同；</li>
<li>如果是组合列，那么默认和() 中排在第一个的列名相同。也可以自定义唯一性约束名。</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> information_schema.table_constraints <span style="color:#ff79c6">WHERE</span> table_name <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">表名</span><span style="color:#f1fa8c">&#39;</span>; <span style="color:#6272a4">#查看都有哪些约束
</span></code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">USER</span>
<span style="color:#ff79c6">DROP</span> <span style="color:#ff79c6">INDEX</span> uk_name_pwd;
</code></pre></div><blockquote>
<p>注意：可以通过 show index from 表名称;        #查看表的索引</p>
</blockquote>
<h2 id="4-primary-key-约束">4. PRIMARY KEY 约束</h2>
<h3 id="1-作用-2">1) 作用</h3>
<p>用来唯一标识表中的一行记录。</p>
<h3 id="2-关键字-2">2) 关键字</h3>
<p>primary key</p>
<h3 id="3-特点-2">3) 特点</h3>
<p>主键约束相当于唯一约束+非空约束的组合，主键约束列不允许重复，也不允许出现空值。</p>
<ul>
<li>一个表最多只能有一个主键约束，建立主键约束可以在列级别创建，也可以在表级别上创建。</li>
<li>主键约束对应着表中的一列或者多列（复合主键）</li>
<li>如果是多列组合的复合主键约束，那么这些列都不允许为空值，并且组合的值不允许重复。</li>
<li>MySQL的主键名总是PRIMARY，就算自己命名了主键约束名也没用。</li>
<li>当创建主键约束时，系统默认会在所在的列或列组合上建立对应的主键索引（能够根据主键查询的，就根据主键查询，效率更高。如果删除主键约束了，主键约束对应的索引就自动删除了。</li>
<li>需要注意的一点是，不要修改主键字段的值。因为主键是数据记录的唯一标识，如果修改了主键的值，就有可能会破坏数据的完整性。</li>
</ul>
<h3 id="4-添加主键约束">4) 添加主键约束</h3>
<p><strong>1. 建表时指定主键约束</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> 表名称(
字段名 数据类型 <span style="color:#ff79c6">primary</span> <span style="color:#ff79c6">key</span>, <span style="color:#6272a4">#列级模式
</span><span style="color:#6272a4"></span>字段名 数据类型,
字段名 数据类型
);

<span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> 表名称(
字段名 数据类型,
字段名 数据类型,
字段名 数据类型,
[<span style="color:#ff79c6">constraint</span> 约束名] <span style="color:#ff79c6">primary</span> <span style="color:#ff79c6">key</span>(字段名) <span style="color:#6272a4">#表级模式
</span><span style="color:#6272a4"></span>);
</code></pre></div><p><strong>2. 建表后增加主键约束</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> 表名称 <span style="color:#ff79c6">ADD</span> <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span>(字段列表); <span style="color:#6272a4">#字段列表可以是一个字段，也可以是多个字段，如果是多个字段的话，是复合主键
</span></code></pre></div><h3 id="5-关于复合主键">5) 关于复合主键</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> 表名称(
字段名 数据类型,
字段名 数据类型,
字段名 数据类型,
<span style="color:#ff79c6">primary</span> <span style="color:#ff79c6">key</span>(字段名<span style="color:#bd93f9">1</span>,字段名<span style="color:#bd93f9">2</span>) <span style="color:#6272a4">#表示字段1和字段2的组合是唯一的，也可以有更多个字段
</span><span style="color:#6272a4"></span>);
</code></pre></div><h3 id="6-删除主键约束">6) 删除主键约束</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">alter</span> <span style="color:#ff79c6">table</span> 表名称 <span style="color:#ff79c6">drop</span> <span style="color:#ff79c6">primary</span> <span style="color:#ff79c6">key</span>
</code></pre></div><blockquote>
<p>说明：删除主键约束，不需要指定主键名，因为一个表只有一个主键，删除主键约束后，非空还存在。</p>
</blockquote>
<h2 id="5-自增列auto_increment">5. 自增列：AUTO_INCREMENT</h2>
<h3 id="1-作用-3">1) 作用</h3>
<p>某个字段的值自增</p>
<h3 id="2-关键字-3">2) 关键字</h3>
<p>auto_increment</p>
<h3 id="3-特点-3">3) 特点</h3>
<p>（1）一个表最多只能有一个自增长列</p>
<p>（2）当需要产生唯一标识符或顺序值时，可设置自增长</p>
<p>（3）自增长列约束的列必须是键列（主键列，唯一键列）</p>
<p>（4）自增约束的列的数据类型必须是整数类型</p>
<p>（5）如果自增列指定了 0 和 null，会在当前最大值的基础上自增；如果自增列手动指定了具体值，直接赋值为具体值。</p>
<h3 id="4-如何指定自增约束">4) 如何指定自增约束</h3>
<p><strong>1. 建表时</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> 表名称(
字段名 数据类型 <span style="color:#ff79c6">primary</span> <span style="color:#ff79c6">key</span> <span style="color:#ff79c6">auto_increment</span>,
字段名 数据类型 <span style="color:#ff79c6">unique</span> <span style="color:#ff79c6">key</span> <span style="color:#ff79c6">not</span> null,
字段名 数据类型 <span style="color:#ff79c6">unique</span> <span style="color:#ff79c6">key</span>,
字段名 数据类型 <span style="color:#ff79c6">not</span> null <span style="color:#ff79c6">default</span> 默认值,
);
<span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> 表名称(
字段名 数据类型 <span style="color:#ff79c6">default</span> 默认值 ,
字段名 数据类型 <span style="color:#ff79c6">unique</span> <span style="color:#ff79c6">key</span> <span style="color:#ff79c6">auto_increment</span>,
字段名 数据类型 <span style="color:#ff79c6">not</span> null <span style="color:#ff79c6">default</span> 默认值,
<span style="color:#ff79c6">primary</span> <span style="color:#ff79c6">key</span>(字段名)
);
</code></pre></div><p><strong>2. 建表后</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">alter</span> <span style="color:#ff79c6">table</span> 表名称 modify 字段名 数据类型 <span style="color:#ff79c6">auto_increment</span>;
</code></pre></div><h3 id="5-删除自增约束">5) 删除自增约束</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#6272a4">#alter table 表名称 modify 字段名 数据类型 auto_increment;#给这个字段增加自增约束
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">alter</span> <span style="color:#ff79c6">table</span> 表名称 modify 字段名 数据类型; <span style="color:#6272a4">#去掉auto_increment相当于删除
</span></code></pre></div><h3 id="6-mysql-80新特性自增变量的持久化">6) MySQL 8.0新特性—自增变量的持久化</h3>
<p>在MySQL 8.0之前，自增主键AUTO_INCREMENT的值如果大于max(primary key)+1，在MySQL重启后，会重置AUTO_INCREMENT=max(primary key)+1，这种现象在某些情况下会导致业务主键冲突或者其他难以发现的问题。 下面通过案例来对比不同的版本中自增变量是否持久化。 在MySQL 5.7版本中，测试步骤如 下： 创建的数据表中包含自增主键的id字段，语句如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#50fa7b">test1</span>(
id <span style="color:#8be9fd">INT</span> <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span> <span style="color:#ff79c6">AUTO_INCREMENT</span>
);
</code></pre></div><p>在MySQL 5.7系统中，对于自增主键的分配规则，是由InnoDB数据字典 内部一个 计数器 来决定的，而该计数器只在 内存中维护 ，并不会持久化到磁盘中。当数据库重启时，该 计数器会被初始化。</p>
<p>在MySQL 8.0将自增主键的计数器持久化到 重做日志 中。每次计数器发生改变，都会将其写入重做日志 中。如果数据库重启，InnoDB会根据重做日志中的信息来初始化计数器的内存值。</p>
<h2 id="6-foreign-key-约束">6. FOREIGN KEY 约束</h2>
<h3 id="1-作用-4">1) 作用</h3>
<p>限定某个表的某个字段的引用完整性。</p>
<h3 id="2-关键字-4">2) 关键字</h3>
<p>FOREIGN KEY</p>
<h3 id="3-主表和从表父表和子表">3) 主表和从表/父表和子表</h3>
<p>主表（父表）：被引用的表，被参考的表</p>
<p>从表（子表）：引用别人的表，参考别人的表</p>
<h3 id="4-特点">4) 特点</h3>
<p>（1）从表的外键列，必须引用/参考主表的主键或唯一约束的列为什么？因为被依赖/被参考的值必须是唯一的</p>
<p>（2）在创建外键约束时，如果不给外键约束命名，默认名不是列名，而是自动产生一个外键名（例如 student_ibfk_1;），也可以指定外键约束名。</p>
<p>（3）创建(CREATE)表时就指定外键约束的话，<strong>先创建主表</strong>，再创建从表</p>
<p>（4）删表时，<strong>先删从表</strong>（或先删除外键约束），再删除主表</p>
<p>（5）当主表的记录被从表参照时，主表的记录将不允许删除，如果要删除数据，需要先删除从表中依赖该记录的数据，然后才可以删除主表的数据</p>
<p>（6）在“从表”中指定外键约束，并且一个表可以建立多个外键约束</p>
<p>（7）从表的外键列与主表被参照的列名字可以不相同，但是数据类型必须一样，逻辑意义一致。如果类型不一样，创建子表时，就会出现错误“ERROR 1005 (HY000): Can&rsquo;t create table&rsquo;database.tablename&rsquo;(errno: 150)”。 例如：都是表示部门编号，都是int类型。</p>
<p>（8）当创建外键约束时，系统默认会在所在的列上建立对应的普通索引。但是索引名是外键的约束名。（根据外键查询效率很高）</p>
<p>（9）删除外键约束后，必须手动删除对应的索引</p>
<h3 id="5-添加外键约束">5) 添加外键约束</h3>
<p><strong>1. 建表时</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> 主表名称(
字段<span style="color:#bd93f9">1</span> 数据类型 <span style="color:#ff79c6">primary</span> <span style="color:#ff79c6">key</span>,
字段<span style="color:#bd93f9">2</span> 数据类型
);

<span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> 从表名称(
字段<span style="color:#bd93f9">1</span> 数据类型 <span style="color:#ff79c6">primary</span> <span style="color:#ff79c6">key</span>,
字段<span style="color:#bd93f9">2</span> 数据类型,
[<span style="color:#ff79c6">CONSTRAINT</span> <span style="color:#ff79c6">&lt;</span>外键约束名称<span style="color:#ff79c6">&gt;</span>] <span style="color:#ff79c6">FOREIGN</span> <span style="color:#ff79c6">KEY</span>（从表的某个字段) <span style="color:#ff79c6">references</span> 主表名(被参考字段)
);
<span style="color:#6272a4">#(从表的某个字段)的数据类型必须与主表名(被参考字段)的数据类型一致，逻辑意义也一样
</span><span style="color:#6272a4"></span><span style="color:#6272a4">#(从表的某个字段)的字段名可以与主表名(被参考字段)的字段名一样，也可以不一样
</span><span style="color:#6272a4"></span><span style="color:#6272a4">-- FOREIGN KEY: 在表级指定子表中的列
</span><span style="color:#6272a4"></span><span style="color:#6272a4">-- REFERENCES: 标示在父表中的列
</span></code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> <span style="color:#50fa7b">dept</span>( <span style="color:#6272a4">#主表
</span><span style="color:#6272a4"></span>did <span style="color:#8be9fd">int</span> <span style="color:#ff79c6">primary</span> <span style="color:#ff79c6">key</span>, <span style="color:#6272a4">#部门编号
</span><span style="color:#6272a4"></span>dname <span style="color:#8be9fd">varchar</span>(<span style="color:#bd93f9">50</span>) <span style="color:#6272a4">#部门名称
</span><span style="color:#6272a4"></span>);
<span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> <span style="color:#50fa7b">emp</span>(<span style="color:#6272a4">#从表
</span><span style="color:#6272a4"></span>eid <span style="color:#8be9fd">int</span> <span style="color:#ff79c6">primary</span> <span style="color:#ff79c6">key</span>, <span style="color:#6272a4">#员工编号
</span><span style="color:#6272a4"></span>ename <span style="color:#8be9fd">varchar</span>(<span style="color:#bd93f9">5</span>), <span style="color:#6272a4">#员工姓名
</span><span style="color:#6272a4"></span>deptid <span style="color:#8be9fd">int</span>, <span style="color:#6272a4">#员工所在的部门
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">foreign</span> <span style="color:#ff79c6">key</span> (deptid) <span style="color:#ff79c6">references</span> <span style="color:#50fa7b">dept</span>(did) <span style="color:#6272a4">#在从表中指定外键约束
</span><span style="color:#6272a4"></span><span style="color:#6272a4">#emp表的deptid和和dept表的did的数据类型一致，意义都是表示部门的编号
</span><span style="color:#6272a4"></span>);
说明：
（<span style="color:#bd93f9">1</span>）主表dept必须先创建成功，然后才能创建emp表，指定外键成功。
（<span style="color:#bd93f9">2</span>）删除表时，先删除从表emp，再删除主表dept
</code></pre></div><p><strong>2. 建表后</strong></p>
<p>一般情况下，表与表的关联都是提前设计好了的，因此，会在创建表的时候就把外键约束定义好。不 过，如果需要修改表的设计（比如添加新的字段，增加新的关联关系），但没有预先定义外键约束，那 么，就要用修改表的方式来补充定义。</p>
<p>格式：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> 从表名 <span style="color:#ff79c6">ADD</span> [<span style="color:#ff79c6">CONSTRAINT</span> 约束名] <span style="color:#ff79c6">FOREIGN</span> <span style="color:#ff79c6">KEY</span> (从表的字段) <span style="color:#ff79c6">REFERENCES</span> 主表名(被引用字段) [<span style="color:#ff79c6">on</span> <span style="color:#ff79c6">update</span> xx][<span style="color:#ff79c6">on</span> <span style="color:#ff79c6">delete</span> xx];
</code></pre></div><p>举例：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> emp1
<span style="color:#ff79c6">ADD</span> [<span style="color:#ff79c6">CONSTRAINT</span> emp_dept_id_fk] <span style="color:#ff79c6">FOREIGN</span> <span style="color:#ff79c6">KEY</span>(dept_id) <span style="color:#ff79c6">REFERENCES</span> <span style="color:#50fa7b">dept</span>(dept_id);
</code></pre></div><h3 id="6-约束等级">6) 约束等级</h3>
<ul>
<li><code>Cascade方式 </code>：在父表上update/delete记录时，同步update/delete掉子表的匹配记录</li>
<li><code>Set null方式</code> ：在父表上update/delete记录时，将子表上匹配记录的列设为null，但是要注意子 表的外键列不能为not null</li>
<li><code>No action方式</code> ：如果子表中有匹配的记录，则不允许对父表对应候选键进行update/delete操作</li>
<li><code>Restrict方式</code> ：同no action， 都是立即检查外键约束</li>
<li><code>Set default方式</code> （在可视化工具SQLyog中可能显示空白）：父表有变更时，子表将外键列设置 成一个默认的值，但Innodb不能识别x</li>
</ul>
<p>如果没有指定等级，就相当于Restrict方式。 对于外键约束，最好是采用: ON UPDATE CASCADE ON DELETE RESTRICT 的方式。</p>
<h3 id="7-删除外键约束">7) 删除外键约束</h3>
<p>流程如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">(<span style="color:#bd93f9">1</span>)第一步先查看约束名和删除外键约束
<span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> information_schema.table_constraints <span style="color:#ff79c6">WHERE</span> table_name <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">表名称</span><span style="color:#f1fa8c">&#39;</span>;  <span style="color:#6272a4">#查看某个表的约束名
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> 从表名 <span style="color:#ff79c6">DROP</span> <span style="color:#ff79c6">FOREIGN</span> <span style="color:#ff79c6">KEY</span> 外键约束名;

（<span style="color:#bd93f9">2</span>）第二步查看索引名和删除索引。（注意，只能手动删除）
<span style="color:#ff79c6">SHOW</span> <span style="color:#ff79c6">INDEX</span> <span style="color:#ff79c6">FROM</span> 表名称; <span style="color:#6272a4">#查看某个表的索引名
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> 从表名 <span style="color:#ff79c6">DROP</span> <span style="color:#ff79c6">INDEX</span> 索引名;
</code></pre></div><h3 id="8-开发场景">8) 开发场景</h3>
<p><strong>问题1：如果两个表之间有关系（一对一、一对多），比如：员工表和部门表（一对多），它们之间是否 一定要建外键约束？</strong></p>
<p>答：不是的</p>
<p><strong>问题2：建和不建外键约束有什么区别？</strong></p>
<p>答：建外键约束，你的操作（创建表、删除表、添加、修改、删除）会受到限制，从语法层面受到限 制。例如：在员工表中不可能添加一个员工信息，它的部门的值在部门表中找不到。</p>
<p>不建外键约束，你的操作（创建表、删除表、添加、修改、删除）不受限制，要保证数据的 引用完整 性 ，只能依靠程序员的自觉 ，或者是 在Java程序中进行限定 。例如：在员工表中，可以添加一个员工的 信息，它的部门指定为一个完全不存在的部门。</p>
<p><strong>问题3：那么建和不建外键约束和查询有没有关系？</strong></p>
<p>答：没有</p>
<blockquote>
<p>在 MySQL 里，外键约束是有成本的，需要消耗系统资源。对于大并发的 SQL 操作，有可能会不适合。比如大型网站的中央数据库，可能会因为外键约束的系统开销而变得非常慢 。所以， MySQL 允许你不使用系统自带的外键约束，在 应用层面 完成检查数据一致性的逻辑。也就是说，即使你不 用外键约束，也要想办法通过应用层面的附加逻辑，来实现外键约束的功能，确保数据的一致性。</p>
</blockquote>
<h3 id="9--阿里开发规范">9)  阿里开发规范</h3>
<p>【 强制 】不得使用外键与级联，一切外键概念必须在应用层解决。</p>
<p>说明：（概念解释）学生表中的 student_id 是主键，那么成绩表中的 student_id 则为外键。如果更新学 生表中的 student_id，同时触发成绩表中的 student_id 更新，即为级联更新。外键与级联更新适用于 单 机低并发 ，不适合 分布式 、 高并发集群 ；级联更新是强阻塞，存在数据库 更新风暴 的风险；外键影响 数据库的 插入速度 。</p>
<h2 id="7-check-约束">7. CHECK 约束</h2>
<h3 id="1-作用-5">1) 作用</h3>
<p>检查某个字段的值是否符号xx要求，一般指的是值的范围</p>
<h3 id="2-关键字-5">2) 关键字</h3>
<p>CHECK</p>
<h3 id="3-说明">3) 说明</h3>
<p>MySQL5.7 可以使用check约束，但check约束对数据验证没有任何作用。添加数据时，没有任何错误或警告</p>
<p>但是<strong>MySQL 8.0中可以使用check约束了</strong>。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> <span style="color:#50fa7b">employee</span>(
eid <span style="color:#8be9fd">int</span> <span style="color:#ff79c6">primary</span> <span style="color:#ff79c6">key</span>,
ename <span style="color:#8be9fd">varchar</span>(<span style="color:#bd93f9">5</span>),
gender <span style="color:#8be9fd">char</span> <span style="color:#ff79c6">check</span> (<span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">男</span><span style="color:#f1fa8c">&#39;</span> <span style="color:#ff79c6">or</span> <span style="color:#f1fa8c"></span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">女</span><span style="color:#f1fa8c">&#39;</span>)
);
</code></pre></div><h2 id="8-default约束">8. DEFAULT约束</h2>
<h3 id="1-作用-6">1) 作用</h3>
<p>给某个字段/某列指定默认值，一旦设置默认值，在插入数据时，如果此字段没有显式赋值，则赋值为默认值。</p>
<h3 id="2-关键字-6">2) 关键字</h3>
<p>DEFAULT</p>
<h3 id="3-添加默认值">3) 添加默认值</h3>
<p><strong>1. 建表时</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> 表名称(
字段名 数据类型 <span style="color:#ff79c6">primary</span> <span style="color:#ff79c6">key</span>,
字段名 数据类型 <span style="color:#ff79c6">unique</span> <span style="color:#ff79c6">key</span> <span style="color:#ff79c6">not</span> null,
字段名 数据类型 <span style="color:#ff79c6">unique</span> <span style="color:#ff79c6">key</span>,
字段名 数据类型 <span style="color:#ff79c6">not</span> null <span style="color:#ff79c6">default</span> 默认值,
);
</code></pre></div><p><strong>2. 建表后</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">alter</span> <span style="color:#ff79c6">table</span> 表名称 modify 字段名 数据类型 <span style="color:#ff79c6">default</span> 默认值;
<span style="color:#6272a4">#如果这个字段原来有非空约束，你还保留非空约束，那么在加默认值约束时，还得保留非空约束，否则非空约束就被删除了
</span><span style="color:#6272a4"></span><span style="color:#6272a4">#同理，在给某个字段加非空约束也一样，如果这个字段原来有默认值约束，你想保留，也要在modify语句中保留默认值约束，否则就删除了
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">alter</span> <span style="color:#ff79c6">table</span> 表名称 modify 字段名 数据类型 <span style="color:#ff79c6">default</span> 默认值 <span style="color:#ff79c6">not</span> null;
</code></pre></div><p><strong>删除默认值</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#ff79c6">alter</span> <span style="color:#ff79c6">table</span> 表名称 modify 字段名 数据类型; <span style="color:#6272a4">#删除默认值约束，也不保留非空约束
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">alter</span> <span style="color:#ff79c6">table</span> 表名称 modify 字段名 数据类型 <span style="color:#ff79c6">not</span> null; <span style="color:#6272a4">#删除默认值约束，保留非空约束
</span></code></pre></div><h2 id="9-面试">9. 面试</h2>
<p><strong>面试1、为什么建表时，加 not null default '&rsquo; 或 default 0</strong></p>
<p>答：不想让表中出现null值。</p>
<p><strong>面试2、为什么不想要 null 的值</strong></p>
<p>答:</p>
<p>（1）不好比较。null是一种特殊值，比较时只能用专门的is null 和 is not null来比较。碰到运算符，通 常返回null。</p>
<p>（2）效率不高。影响提高索引效果。因此，我们往往在建表时 not null default '&rsquo; 或 default 0</p>
<p><strong>面试3、带AUTO_INCREMENT约束的字段值是从1开始的吗？</strong></p>
<p>在MySQL中，默认AUTO_INCREMENT的初始 值是1，每新增一条记录，字段值自动加1。设置自增属性（AUTO_INCREMENT）的时候，还可以指定第 一条插入记录的自增字段的值，这样新插入的记录的自增字段值从初始值开始递增，如在表中插入第一 条记录，同时指定id值为5，则以后插入的记录的id值就会从6开始往上增加。添加主键约束时，往往需要 设置字段自动增加属性。</p>
<p><strong>面试4、并不是每个表都可以任意选择存储引擎？</strong></p>
<p>外键约束（FOREIGN KEY）不能跨引擎使用。</p>
<p>MySQL支持多种存储引擎，每一个表都可以指定一个不同的存储引擎，需要注意的是：外键约束是用来 保证数据的参照完整性的，如果表之间需要关联外键，却指定了不同的存储引擎，那么这些表之间是不 能创建外键约束的。所以说，存储引擎的选择也不完全是随意的。</p>


                

                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/post/1090mysql%E5%9F%BA%E7%A1%80%E8%A1%A5%E5%85%85dml/" data-toggle="tooltip" data-placement="top" title="20、mysql基础补充(DML)">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/post/1092mysql%E5%9F%BA%E7%A1%80%E8%A1%A5%E5%85%85%E8%A7%86%E5%9B%BE/" data-toggle="tooltip" data-placement="top" title="22、mysql基础补充(视图)">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>
                

            </div>

            
            
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
            

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">标签</a></h5>
                    <div class="tags">
                        
                        
                        
                        <a href="/tags/activemq" title="activemq">
                            activemq
                        </a>
                        
                        
                        
                        <a href="/tags/ajax" title="ajax">
                            ajax
                        </a>
                        
                        
                        
                        <a href="/tags/cookie" title="cookie">
                            cookie
                        </a>
                        
                        
                        
                        <a href="/tags/datax" title="datax">
                            datax
                        </a>
                        
                        
                        
                        <a href="/tags/docker" title="docker">
                            docker
                        </a>
                        
                        
                        
                        <a href="/tags/dubbo" title="dubbo">
                            dubbo
                        </a>
                        
                        
                        
                        <a href="/tags/elasticsearch" title="elasticsearch">
                            elasticsearch
                        </a>
                        
                        
                        
                        <a href="/tags/filter" title="filter">
                            filter
                        </a>
                        
                        
                        
                        <a href="/tags/hadoop" title="hadoop">
                            hadoop
                        </a>
                        
                        
                        
                        <a href="/tags/hbase" title="hbase">
                            hbase
                        </a>
                        
                        
                        
                        <a href="/tags/hive" title="hive">
                            hive
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/java" title="java">
                            java
                        </a>
                        
                        
                        
                        <a href="/tags/javascript" title="javascript">
                            javascript
                        </a>
                        
                        
                        
                        <a href="/tags/javaweb" title="javaweb">
                            javaweb
                        </a>
                        
                        
                        
                        <a href="/tags/jdbc" title="jdbc">
                            jdbc
                        </a>
                        
                        
                        
                        <a href="/tags/jquery" title="jquery">
                            jquery
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/jsp" title="jsp">
                            jsp
                        </a>
                        
                        
                        
                        <a href="/tags/juc" title="juc">
                            juc
                        </a>
                        
                        
                        
                        <a href="/tags/jvm" title="jvm">
                            jvm
                        </a>
                        
                        
                        
                        <a href="/tags/jwt" title="jwt">
                            jwt
                        </a>
                        
                        
                        
                        <a href="/tags/kafka" title="kafka">
                            kafka
                        </a>
                        
                        
                        
                        <a href="/tags/linux" title="linux">
                            linux
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/maven" title="maven">
                            maven
                        </a>
                        
                        
                        
                        <a href="/tags/minio" title="minio">
                            minio
                        </a>
                        
                        
                        
                        <a href="/tags/mongodb" title="mongodb">
                            mongodb
                        </a>
                        
                        
                        
                        <a href="/tags/mybatis" title="mybatis">
                            mybatis
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/mysql" title="mysql">
                            mysql
                        </a>
                        
                        
                        
                        <a href="/tags/netty" title="netty">
                            netty
                        </a>
                        
                        
                        
                        <a href="/tags/nginx" title="nginx">
                            nginx
                        </a>
                        
                        
                        
                        <a href="/tags/react" title="react">
                            react
                        </a>
                        
                        
                        
                        <a href="/tags/redis" title="redis">
                            redis
                        </a>
                        
                        
                        
                        <a href="/tags/scala" title="scala">
                            scala
                        </a>
                        
                        
                        
                        <a href="/tags/servlet" title="servlet">
                            servlet
                        </a>
                        
                        
                        
                        <a href="/tags/session" title="session">
                            session
                        </a>
                        
                        
                        
                        <a href="/tags/shiro" title="shiro">
                            shiro
                        </a>
                        
                        
                        
                        <a href="/tags/spark" title="spark">
                            spark
                        </a>
                        
                        
                        
                        <a href="/tags/spring" title="spring">
                            spring
                        </a>
                        
                        
                        
                        <a href="/tags/springboot" title="springboot">
                            springboot
                        </a>
                        
                        
                        
                        <a href="/tags/springcloud" title="springcloud">
                            springcloud
                        </a>
                        
                        
                        
                        <a href="/tags/springmvc" title="springmvc">
                            springmvc
                        </a>
                        
                        
                        
                        <a href="/tags/springsecurity" title="springsecurity">
                            springsecurity
                        </a>
                        
                        
                        
                        <a href="/tags/tomcat" title="tomcat">
                            tomcat
                        </a>
                        
                        
                        
                        <a href="/tags/vue" title="vue">
                            vue
                        </a>
                        
                        
                        
                        <a href="/tags/xml" title="xml">
                            xml
                        </a>
                        
                        
                        
                        <a href="/tags/zookeeper" title="zookeeper">
                            zookeeper
                        </a>
                        
                        
                        
                        <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81" title="分布式锁">
                            分布式锁
                        </a>
                        
                        
                        
                        <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95" title="数据结构与算法">
                            数据结构与算法
                        </a>
                        
                        
                        
                        <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F" title="设计模式">
                            设计模式
                        </a>
                        
                        
                        
                        <a href="/tags/%E9%A1%B9%E7%9B%AE" title="项目">
                            项目
                        </a>
                        
                        
                    </div>
                </section>
                

                
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">                  
                    
                    <li>
                        <a href="mailto:1424197205@qq.com">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		           
                    
                    
                    
                    

		            
                    
                    <li>
                        <a target="_blank" href="/#">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-weixin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		            
                    
                    <li>
                        <a target="_blank" href="https://github.com/yiguan1573">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		            
                    
                    
                    
                    
                    
                    
                    
                    
                    
            
            
            
           
                   <li>
                       <a href='' rel="alternate" type="application/rss+xml" title="亿观的博客" >
                           <span class="fa-stack fa-lg">
                               <i class="fas fa-circle fa-stack-2x"></i>
                               <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
            
             </ul>
		<p class="copyright text-muted">
                    Copyright &copy; 亿观的博客 2022
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function loadAsync(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        loadAsync("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>









<script type="text/javascript">
    function generateCatalog(selector) {

        
        
        
        
            _containerSelector = 'div.post-container'
        

        
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        
        $(selector).html('')

        
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    


    loadAsync("\/js\/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>





</body>
</html>
